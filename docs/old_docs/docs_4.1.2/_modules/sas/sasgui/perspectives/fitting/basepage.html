<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sas.sasgui.perspectives.fitting.basepage &mdash; SasView 4.1.2 documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '4.1.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <link rel="top" title="SasView 4.1.2 documentation" href="../../../../../index.html" />
    <link rel="up" title="sas.sasgui.perspectives.fitting" href="../fitting.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">SasView 4.1.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../fitting.html" accesskey="U">sas.sasgui.perspectives.fitting</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sas.sasgui.perspectives.fitting.basepage</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Base Page for fitting</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">wx</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span> <span class="nn">wx.lib.scrolledpanel</span> <span class="kn">import</span> <span class="n">ScrolledPanel</span>

<span class="kn">from</span> <span class="nn">sasmodels.weights</span> <span class="kn">import</span> <span class="n">MODELS</span> <span class="k">as</span> <span class="n">POLYDISPERSITY_MODELS</span>

<span class="kn">from</span> <span class="nn">sas.sasgui.guiframe.panel_base</span> <span class="kn">import</span> <span class="n">PanelBase</span>
<span class="kn">from</span> <span class="nn">sas.sasgui.guiframe.utils</span> <span class="kn">import</span> <span class="n">format_number</span><span class="p">,</span> <span class="n">check_float</span><span class="p">,</span> <span class="n">IdList</span><span class="p">,</span> \
    <span class="n">check_int</span>
<span class="kn">from</span> <span class="nn">sas.sasgui.guiframe.events</span> <span class="kn">import</span> <span class="n">PanelOnFocusEvent</span>
<span class="kn">from</span> <span class="nn">sas.sasgui.guiframe.events</span> <span class="kn">import</span> <span class="n">StatusEvent</span>
<span class="kn">from</span> <span class="nn">sas.sasgui.guiframe.events</span> <span class="kn">import</span> <span class="n">AppendBookmarkEvent</span>
<span class="kn">from</span> <span class="nn">sas.sasgui.guiframe.dataFitting</span> <span class="kn">import</span> <span class="n">Data2D</span>
<span class="kn">from</span> <span class="nn">sas.sasgui.guiframe.dataFitting</span> <span class="kn">import</span> <span class="n">Data1D</span>
<span class="kn">from</span> <span class="nn">sas.sasgui.guiframe.dataFitting</span> <span class="kn">import</span> <span class="n">check_data_validity</span>
<span class="kn">from</span> <span class="nn">sas.sasgui.guiframe.gui_style</span> <span class="kn">import</span> <span class="n">GUIFRAME_ID</span>
<span class="kn">from</span> <span class="nn">sas.sascalc.dataloader.data_info</span> <span class="kn">import</span> <span class="n">Detector</span>
<span class="kn">from</span> <span class="nn">sas.sascalc.dataloader.data_info</span> <span class="kn">import</span> <span class="n">Source</span>
<span class="kn">from</span> <span class="nn">sas.sasgui.perspectives.fitting.pagestate</span> <span class="kn">import</span> <span class="n">PageState</span>
<span class="kn">from</span> <span class="nn">sas.sasgui.guiframe.CategoryInstaller</span> <span class="kn">import</span> <span class="n">CategoryInstaller</span>
<span class="kn">from</span> <span class="nn">sas.sasgui.guiframe.documentation_window</span> <span class="kn">import</span> <span class="n">DocumentationWindow</span>


<span class="p">(</span><span class="n">PageInfoEvent</span><span class="p">,</span> <span class="n">EVT_PAGE_INFO</span><span class="p">)</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">newevent</span><span class="o">.</span><span class="n">NewEvent</span><span class="p">()</span>
<span class="p">(</span><span class="n">PreviousStateEvent</span><span class="p">,</span> <span class="n">EVT_PREVIOUS_STATE</span><span class="p">)</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">newevent</span><span class="o">.</span><span class="n">NewEvent</span><span class="p">()</span>
<span class="p">(</span><span class="n">NextStateEvent</span><span class="p">,</span> <span class="n">EVT_NEXT_STATE</span><span class="p">)</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">newevent</span><span class="o">.</span><span class="n">NewEvent</span><span class="p">()</span>

<span class="n">_BOX_WIDTH</span> <span class="o">=</span> <span class="mi">76</span>
<span class="n">_QMIN_DEFAULT</span> <span class="o">=</span> <span class="mf">0.0005</span>
<span class="n">_QMAX_DEFAULT</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">_NPTS_DEFAULT</span> <span class="o">=</span> <span class="mi">50</span>
<span class="c1"># Control panel width</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;win32&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">PANEL_WIDTH</span> <span class="o">=</span> <span class="mi">450</span>
    <span class="n">FONT_VARIANT</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ON_MAC</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">PANEL_WIDTH</span> <span class="o">=</span> <span class="mi">500</span>
    <span class="n">FONT_VARIANT</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ON_MAC</span> <span class="o">=</span> <span class="bp">True</span>

<span class="n">CUSTOM_MODEL</span> <span class="o">=</span> <span class="s1">&#39;Plugin Models&#39;</span>

<div class="viewcode-block" id="BasicPage"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage">[docs]</a><span class="k">class</span> <span class="nc">BasicPage</span><span class="p">(</span><span class="n">ScrolledPanel</span><span class="p">,</span> <span class="n">PanelBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class provide general structure of the fitpanel page</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Internal name for the AUI manager</span>
    <span class="n">window_name</span> <span class="o">=</span> <span class="s2">&quot;Fit Page&quot;</span>
    <span class="c1"># Title to appear on top of the window</span>
    <span class="n">window_caption</span> <span class="o">=</span> <span class="s2">&quot;Fit Page &quot;</span>

    <span class="c1"># These two buttons have specific IDs since they seem to be created more</span>
    <span class="c1"># frequently than they need to.  In particular, set_dispers_sizer() is</span>
    <span class="c1"># called by _on_select_model</span>
    <span class="n">ID_BOOKMARK</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
    <span class="n">ID_DISPERSER_HELP</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
    <span class="n">_id_pool</span> <span class="o">=</span> <span class="n">IdList</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ScrolledPanel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">PanelBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetupScrolling</span><span class="p">()</span>
        <span class="c1"># Set window&#39;s font size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetWindowVariant</span><span class="p">(</span><span class="n">variant</span><span class="o">=</span><span class="n">FONT_VARIANT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ids</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id_pool</span><span class="p">)</span>
        <span class="c1"># parent of the page</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="c1"># manager is the fitting plugin</span>
        <span class="c1"># owner of the page (fitting plugin)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_owner</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># current model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">m_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_model</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># list of available data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph_id</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># Q range for data set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qmin_data_set</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qmax_data_set</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npts_data_set</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Q range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qmin</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qmax</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span> <span class="o">=</span> <span class="n">_QMAX_DEFAULT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span> <span class="o">=</span> <span class="n">_QMIN_DEFAULT</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npts_x</span> <span class="o">=</span> <span class="n">_NPTS_DEFAULT</span>
        <span class="c1"># total number of point: float</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npts</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># smear default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_smearer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># 2D smear accuracy default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">smear2d_accuracy</span> <span class="o">=</span> <span class="s1">&#39;Low&#39;</span>
        <span class="c1"># slit smear:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dxl</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dxw</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># pinhole smear</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx_percent</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># smear attrbs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_smearer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_smearer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinhole_smearer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slit_smearer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># weight attrbs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dI_noweight</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dI_didata</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dI_sqrdata</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dI_idata</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># other attrbs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dq_l</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dq_r</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcChi</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_box</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_disp</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Npts_fit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Npts_total</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theory_qmin</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theory_qmax</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theory_qmin_x</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">theory_qmax_x</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btEditMask</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">btFit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sld_axes</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multi_factor</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># self.state = PageState(parent=parent)</span>
        <span class="c1"># dictionary containing list of models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_list_box</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Data member to store the dispersion object created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disp_obj_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># selected parameters to apply dispersion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># smearer object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable2D</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_magnetic</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magnetic_on</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_mac</span> <span class="o">=</span> <span class="n">ON_MAC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># list of model parameters. each item must have same length</span>
        <span class="c1"># each item related to a given parameters</span>
        <span class="c1"># [cb state, name, value, &quot;+/-&quot;, error of fit, min, max , units]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># non-fittable parameter whose value is astring</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">str_parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># list of parameters to fit , must be like self.parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_toFit</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># list of looking like parameters but with non fittable parameters info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># list of looking like parameters but with  fittable parameters info</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># list of dispersion parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># list of orientation parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params_disp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="c1">#       Self.model should ALWAYS be None here.  It was set to none above in</span>
<span class="c1">#       this long init setting.  no obvious function call in between setting</span>
<span class="c1">#       and this - commenting out on 4/8/2014 by PDB.  Remove once clear</span>
<span class="c1">#       it is pointless.</span>
<span class="c1">#        if self.model is not None:</span>
<span class="c1">#            self.disp_list = self.model.getDispParamList()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_multi_functional</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1"># enable model 2D draw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable2D</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1"># check that the fit range is correct to plot the model again</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitrange</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># Create memento to save the current state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">PageState</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                               <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="c1"># flag to determine if state has change</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_change</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1"># save customized array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1"># type: Dict[str, List[float, ...]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>   <span class="c1"># type: Dict[str, List[float, ...]]</span>
        <span class="c1"># retrieve saved state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_saved_state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># dictionary of saved state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_states</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># Create context menu for page</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popUpMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>

        <span class="n">wx_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ids</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keep</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">popUpMenu</span><span class="p">,</span> <span class="n">wx_id</span><span class="p">,</span> <span class="s2">&quot;Add bookmark&quot;</span><span class="p">,</span>
                                 <span class="s2">&quot; Keep the panel status to recall it later&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popUpMenu</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keep</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keep</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_bookmark_flag</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_save_flag</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_bookmark</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">popUpMenu</span><span class="o">.</span><span class="n">AppendSeparator</span><span class="p">()</span>

        <span class="c1"># Default locations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_save_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
        <span class="c1"># save initial state on context menu</span>
        <span class="c1"># self.onSave(event=None)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CONTEXT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onContextMenu</span><span class="p">)</span>

        <span class="c1"># bind key event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_LEFT_DOWN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_left_down</span><span class="p">)</span>

        <span class="c1"># create the basic structure of the panel with empty sizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">define_page_structure</span><span class="p">()</span>
        <span class="c1"># drawing Initial dispersion parameters sizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_dispers_sizer</span><span class="p">()</span>

        <span class="c1"># layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_layout</span><span class="p">()</span>

<div class="viewcode-block" id="BasicPage.set_index_model"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.set_index_model">[docs]</a>    <span class="k">def</span> <span class="nf">set_index_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Index related to this page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_model</span> <span class="o">=</span> <span class="n">index</span></div>

<div class="viewcode-block" id="BasicPage.create_default_data"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.create_default_data">[docs]</a>    <span class="k">def</span> <span class="nf">create_default_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given the user selection, creates a 1D or 2D data</span>
<span class="sd">        Only when the page is on theory mode.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;model_view&quot;</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="n">toggle_mode_on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_view</span><span class="o">.</span><span class="n">IsEnabled</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">toggle_mode_on</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable2D</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">check_data_validity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_create_default_2d_data</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointsbox</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_create_log_1d_data</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_create_default_1d_data</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_data</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">page_finder</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">set_fit_data</span><span class="p">(</span>
                        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_smear_helper</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">enable_smearer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disable_smearer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">pinhole_smearer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pinhole_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">slit_smearer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slit_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_create_default_1d_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create default data for fitting perspective</span>
<span class="sd">        Only when the page is on theory mode.</span>
<span class="sd">        :warning: This data is never plotted.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span><span class="p">,</span>
                           <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">npts_x</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Data1D</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xaxis</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">rm{Q}&#39;</span><span class="p">,</span> <span class="s2">&quot;A^{-1}&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">yaxis</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">rm{Intensity}&#39;</span><span class="p">,</span> <span class="s2">&quot;cm^{-1}&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_data</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; data&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">group_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Model1D&quot;</span>

    <span class="k">def</span> <span class="nf">_create_log_1d_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create log-spaced data for fitting perspective</span>
<span class="sd">        Only when the page is on theory mode.</span>
<span class="sd">        :warning: This data is never plotted.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span> <span class="o">&gt;=</span> <span class="mf">1.e-10</span><span class="p">:</span>
            <span class="n">qmin</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">10.</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span> <span class="o">&lt;=</span> <span class="mf">1.e10</span><span class="p">:</span>
            <span class="n">qmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qmax</span> <span class="o">=</span> <span class="mf">10.</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">qmin</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">qmax</span><span class="p">,</span>
                           <span class="n">num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">npts_x</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Data1D</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xaxis</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">rm{Q}&#39;</span><span class="p">,</span> <span class="s2">&quot;A^{-1}&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">yaxis</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">rm{Intensity}&#39;</span><span class="p">,</span> <span class="s2">&quot;cm^{-1}&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_data</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; data&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">group_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Model1D&quot;</span>

    <span class="k">def</span> <span class="nf">_create_default_2d_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create 2D data by default</span>
<span class="sd">        Only when the page is on theory mode.</span>
<span class="sd">        :warning: This data is never plotted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">Data2D</span><span class="p">()</span>
        <span class="n">qmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xaxis</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">rm{Q_{x}}&#39;</span><span class="p">,</span> <span class="s1">&#39;A^{-1}&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">yaxis</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">rm{Q_{y}}&#39;</span><span class="p">,</span> <span class="s1">&#39;A^{-1}&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_data</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; data&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">group_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; Model2D&quot;</span>
        <span class="c1"># Default values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Detector</span><span class="p">())</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">detector</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">detector</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">distance</span> <span class="o">=</span> <span class="mi">8000</span>   <span class="c1"># mm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="mi">6</span>             <span class="c1"># A</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">detector</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">pixel_size</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># mm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">detector</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">pixel_size</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># mm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">detector</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">beam_center</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">qmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">detector</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">beam_center</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">qmax</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">qmax</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">qmax</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">qmax</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="o">-</span><span class="n">qmax</span>
        <span class="n">qstep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts_x</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">qstep</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">qstep</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c1"># use data info instead</span>
        <span class="n">new_x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">new_y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">new_y</span> <span class="o">=</span> <span class="n">new_y</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># all data reuire now in 1d array</span>
        <span class="n">qx_data</span> <span class="o">=</span> <span class="n">new_x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">qy_data</span> <span class="o">=</span> <span class="n">new_y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">q_data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">qx_data</span> <span class="o">*</span> <span class="n">qx_data</span> <span class="o">+</span> <span class="n">qy_data</span> <span class="o">*</span> <span class="n">qy_data</span><span class="p">)</span>
        <span class="c1"># set all True (standing for unmasked) as default</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qx_data</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="c1"># store x and y bin centers in q space</span>
        <span class="n">x_bins</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">y_bins</span> <span class="o">=</span> <span class="n">y</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">Source</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">err_data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">qx_data</span> <span class="o">=</span> <span class="n">qx_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">qy_data</span> <span class="o">=</span> <span class="n">qy_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">q_data</span> <span class="o">=</span> <span class="n">q_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">x_bins</span> <span class="o">=</span> <span class="n">x_bins</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">y_bins</span> <span class="o">=</span> <span class="n">y_bins</span>
        <span class="c1"># max and min taking account of the bin sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span>

<div class="viewcode-block" id="BasicPage.on_set_focus"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.on_set_focus">[docs]</a>    <span class="k">def</span> <span class="nf">on_set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        On Set Focus, update guimanger and menu</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">PanelOnFocusEvent</span><span class="p">(</span><span class="n">panel</span><span class="o">=</span><span class="bp">self</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_tap_focus</span><span class="p">()</span></div>

<div class="viewcode-block" id="BasicPage.on_tap_focus"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.on_tap_focus">[docs]</a>    <span class="k">def</span> <span class="nf">on_tap_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update menu1 on cliking the page tap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">menu1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">chain_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">menu1</span><span class="o">.</span><span class="n">FindItemById</span><span class="p">(</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">id_reset_flag</span><span class="p">)</span>
            <span class="n">chain_menu</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_on</span><span class="p">)</span>
            <span class="n">sim_menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">menu1</span><span class="o">.</span><span class="n">FindItemById</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">id_simfit</span><span class="p">)</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_data</span>\
                            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
            <span class="n">sim_menu</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_on</span> <span class="ow">and</span> <span class="n">flag</span><span class="p">)</span>
            <span class="n">batch_menu</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">menu1</span><span class="o">.</span><span class="n">FindItemById</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">id_batchfit</span><span class="p">)</span>
            <span class="n">batch_menu</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_on</span> <span class="ow">and</span> <span class="n">flag</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasicPage.onContextMenu"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.onContextMenu">[docs]</a>    <span class="k">def</span> <span class="nf">onContextMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve the state selected state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">()</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ScreenToClient</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopupMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">popUpMenu</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasicPage.onUndo"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.onUndo">[docs]</a>    <span class="k">def</span> <span class="nf">onUndo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cancel the previous action</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">PreviousStateEvent</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasicPage.onRedo"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.onRedo">[docs]</a>    <span class="k">def</span> <span class="nf">onRedo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore the previous action cancelled</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">NextStateEvent</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasicPage.define_page_structure"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.define_page_structure">[docs]</a>    <span class="k">def</span> <span class="nf">define_page_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create empty sizer for a panel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer0</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer3</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer5</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer6</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sizer0</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="n">PANEL_WIDTH</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer1</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="n">PANEL_WIDTH</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer2</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="n">PANEL_WIDTH</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer3</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="n">PANEL_WIDTH</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="n">PANEL_WIDTH</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer5</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="n">PANEL_WIDTH</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer6</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="n">PANEL_WIDTH</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sizer0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sizer1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sizer2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sizer3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sizer4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sizer5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sizer6</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasicPage.set_layout"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.set_layout">[docs]</a>    <span class="k">def</span> <span class="nf">set_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        layout</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vbox</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Centre</span><span class="p">()</span></div>

<div class="viewcode-block" id="BasicPage.set_owner"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.set_owner">[docs]</a>    <span class="k">def</span> <span class="nf">set_owner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">owner</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set owner of fitpage</span>

<span class="sd">        :param owner: the class responsible of plotting</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_owner</span> <span class="o">=</span> <span class="n">owner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">event_owner</span> <span class="o">=</span> <span class="n">owner</span></div>

<div class="viewcode-block" id="BasicPage.get_state"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the current page state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span></div>

<div class="viewcode-block" id="BasicPage.get_data"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the current data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="BasicPage.get_data_list"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_data_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_data_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the current data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span></div>

<div class="viewcode-block" id="BasicPage.set_manager"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.set_manager">[docs]</a>    <span class="k">def</span> <span class="nf">set_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">manager</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set panel manager</span>

<span class="sd">        :param manager: instance of plugin fitting</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span> <span class="o">=</span> <span class="n">manager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">manager</span> <span class="o">=</span> <span class="n">manager</span></div>

<div class="viewcode-block" id="BasicPage.populate_box"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.populate_box">[docs]</a>    <span class="k">def</span> <span class="nf">populate_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store list of model</span>

<span class="sd">        :param model_dict: dictionary containing list of models</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_list_box</span> <span class="o">=</span> <span class="n">model_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">model_list_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_list_box</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_combox</span><span class="p">()</span></div>

<div class="viewcode-block" id="BasicPage.set_model_dictionary"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.set_model_dictionary">[docs]</a>    <span class="k">def</span> <span class="nf">set_model_dictionary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a dictionary linking model name -&gt; model object</span>

<span class="sd">        :param model_dict: dictionary containing list of models</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_dict</span> <span class="o">=</span> <span class="n">model_dict</span></div>

<div class="viewcode-block" id="BasicPage.initialize_combox"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.initialize_combox">[docs]</a>    <span class="k">def</span> <span class="nf">initialize_combox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        put default value in the combo box</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_list_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_list_box</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_box</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="p">,</span>
                               <span class="bp">self</span><span class="o">.</span><span class="n">model_list_box</span><span class="p">[</span><span class="s2">&quot;Structure Factors&quot;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">Insert</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text2</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text2</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span></div>

<div class="viewcode-block" id="BasicPage.set_dispers_sizer"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.set_dispers_sizer">[docs]</a>    <span class="k">def</span> <span class="nf">set_dispers_sizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fill sizer containing dispersity info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># print &quot;==== entering set_dispers_sizer ===&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4</span><span class="o">.</span><span class="n">Clear</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Polydispersity and Orientational Distribution&quot;</span>
        <span class="n">box_description</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">box_description</span><span class="o">.</span><span class="n">SetForegroundColour</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">BLUE</span><span class="p">)</span>
        <span class="n">boxsizer1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticBoxSizer</span><span class="p">(</span><span class="n">box_description</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="c1"># ----------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_disp</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s1">&#39;Off&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                                           <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">RB_GROUP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_disp</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s1">&#39;On&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>
        <span class="c1"># best size for MAC and PC</span>
        <span class="k">if</span> <span class="n">ON_MAC</span><span class="p">:</span>
            <span class="n">size_q</span> <span class="o">=</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">size_q</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_help_bt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID_DISPERSER_HELP</span><span class="p">,</span> <span class="s1">&#39;?&#39;</span><span class="p">,</span>
                                      <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">BU_EXACTFIT</span><span class="p">,</span>
                                      <span class="n">size</span><span class="o">=</span><span class="n">size_q</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_help_bt</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_pd_help_clicked</span><span class="p">,</span>
                               <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">disp_help_bt</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_help_bt</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Help for polydispersion.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_RADIOBUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_dipers_Param</span><span class="p">,</span>
                  <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">disable_disp</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_RADIOBUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_dipers_Param</span><span class="p">,</span>
                  <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">enable_disp</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="c1"># MAC needs SetValue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_disp</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">sizer_dispersion</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">sizer_dispersion</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># Polydispersity and \nOrientational Distribution &quot;</span>
        <span class="n">sizer_dispersion</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
        <span class="n">sizer_dispersion</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enable_disp</span><span class="p">)</span>
        <span class="n">sizer_dispersion</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
        <span class="n">sizer_dispersion</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disable_disp</span><span class="p">)</span>
        <span class="n">sizer_dispersion</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">25</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
        <span class="n">sizer_dispersion</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disp_help_bt</span><span class="p">)</span>

        <span class="c1"># fill a sizer for dispersion</span>
        <span class="n">boxsizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sizer_dispersion</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ADJUST_MINSIZE</span><span class="p">,</span>
                      <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4_4</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">GridBagSizer</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">boxsizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sizer4_4</span><span class="p">)</span>
        <span class="c1"># -----------------------------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">boxsizer1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4_4</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
        <span class="c1"># saving the state of enable dispersity button</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">enable_disp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_disp</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disable_disp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_disp</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetupScrolling</span><span class="p">()</span></div>

<div class="viewcode-block" id="BasicPage.onResetModel"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.onResetModel">[docs]</a>    <span class="k">def</span> <span class="nf">onResetModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset model state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
        <span class="c1"># post help message for the selected model</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">GetHelpString</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; reloaded&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">GetLabel</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_on_select_model_helper</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">m_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_states</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">previous_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">saved_states</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="c1"># reset state of checkbox,textcrtl  and  regular parameters value</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">reset_page</span><span class="p">(</span><span class="n">previous_state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">m_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasicPage.on_preview"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.on_preview">[docs]</a>    <span class="k">def</span> <span class="nf">on_preview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Report the current fit results</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get plot image from plotpanel</span>
        <span class="n">images</span><span class="p">,</span> <span class="n">canvases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_images</span><span class="p">()</span>
        <span class="c1"># get the report dialog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">canvases</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasicPage.on_save"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.on_save">[docs]</a>    <span class="k">def</span> <span class="nf">on_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the current state into file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_current_state</span><span class="p">()</span>
        <span class="n">new_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="c1"># Ask the user the location of the file to write to.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_default_save_location</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_default_save_location</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Choose a file&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_save_location</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">window_caption</span><span class="p">,</span> <span class="s2">&quot;*.fitv&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">SAVE</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_default_save_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_default_save_location</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_default_save_location</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="c1"># MAC always needs the extension for saving</span>
        <span class="n">extens</span> <span class="o">=</span> <span class="s2">&quot;.fitv&quot;</span>
        <span class="c1"># Make sure the ext included in the file name</span>
        <span class="n">fName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">extens</span>
        <span class="c1"># the manager write the state into file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">save_fit_state</span><span class="p">(</span><span class="n">filepath</span><span class="o">=</span><span class="n">fName</span><span class="p">,</span> <span class="n">fitstate</span><span class="o">=</span><span class="n">new_state</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_state</span></div>

<div class="viewcode-block" id="BasicPage.on_copy"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.on_copy">[docs]</a>    <span class="k">def</span> <span class="nf">on_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy Parameter values to the clipboad</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="c1"># It seems MAC needs wxCallAfter</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span> <span class="o">==</span> <span class="n">GUIFRAME_ID</span><span class="o">.</span><span class="n">COPYEX_ID</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;copy excel&quot;</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_copy_excel</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span> <span class="o">==</span> <span class="n">GUIFRAME_ID</span><span class="o">.</span><span class="n">COPYLAT_ID</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;copy latex&quot;</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_copy_latex</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_copy</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasicPage.on_paste"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.on_paste">[docs]</a>    <span class="k">def</span> <span class="nf">on_paste</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paste Parameter values to the panel if possible</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if event is not None:</span>
        <span class="c1">#    event.Skip()</span>
        <span class="c1"># It seems MAC needs wxCallAfter for the setvalues</span>
        <span class="c1"># for multiple textctrl items, otherwise it tends to crash once a while</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_paste</span><span class="p">)</span></div>
        <span class="c1"># messages depending on the flag</span>
        <span class="c1"># self._copy_info(True)</span>

    <span class="k">def</span> <span class="nf">_copy_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send event depending on flag</span>

<span class="sd">        : Param flag: flag that distinguishes the event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># messages depending on the flag</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot; Parameter values are copied to the clipboard...&quot;</span>
            <span class="n">infor</span> <span class="o">=</span> <span class="s1">&#39;warning&#39;</span>
        <span class="k">elif</span> <span class="n">flag</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot; Parameter values are pasted from the clipboard...&quot;</span>
            <span class="n">infor</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error occurred: &quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;No valid parameter values to paste from the clipboard...&quot;</span>
            <span class="n">infor</span> <span class="o">=</span> <span class="s2">&quot;warning&quot;</span>
        <span class="c1"># inform msg to wx</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                     <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">infor</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_time_stamp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return time and date stings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># date and time</span>
        <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">hour</span><span class="p">,</span> <span class="n">minute</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">minute</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
        <span class="n">current_date</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">month</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">day</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">current_time</span><span class="p">,</span> <span class="n">current_date</span>

<div class="viewcode-block" id="BasicPage.on_bookmark"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.on_bookmark">[docs]</a>    <span class="k">def</span> <span class="nf">on_bookmark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save history of the data and model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Can not bookmark; Please select Data and Model first...&quot;</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s1">&#39;Info&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_current_state</span><span class="p">()</span>
        <span class="n">new_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="c1"># Add model state on context menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_saved_state</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">current_time</span><span class="p">,</span> <span class="n">current_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_time_stamp</span><span class="p">()</span>
        <span class="c1"># name= self.model.name+&quot;[%g]&quot;%self.number_saved_state</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Fitting: </span><span class="si">%g</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_saved_state</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span>
        <span class="n">name</span> <span class="o">+=</span> <span class="s2">&quot;bookmarked at </span><span class="si">%s</span><span class="s2"> on </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">current_time</span><span class="p">,</span> <span class="n">current_date</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_states</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_state</span>

        <span class="c1"># Add item in the context menu</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Model saved at </span><span class="si">%s</span><span class="s2"> on </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">current_time</span><span class="p">,</span> <span class="n">current_date</span><span class="p">)</span>
        <span class="c1"># post help message for the selected model</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; Saved! right click on this page to retrieve this model&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">popUpMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ID_BOOKMARK</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ID_BOOKMARK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onResetModel</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                     <span class="n">AppendBookmarkEvent</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                         <span class="n">hint</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span>
                                         <span class="n">handler</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_back_to_bookmark</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">_back_to_bookmark</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Back to bookmark</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">on_perspective</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onResetModel</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_model</span><span class="p">()</span>

<div class="viewcode-block" id="BasicPage.onSetFocus"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.onSetFocus">[docs]</a>    <span class="k">def</span> <span class="nf">onSetFocus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        highlight the current textcrtl and hide the error text control shown</span>
<span class="sd">        after fitting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="BasicPage.read_file"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.read_file">[docs]</a>    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read two columns file</span>

<span class="sd">        :param path: the path to the file to read</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot; Selected Distribution was not loaded: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">path</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                             <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span>
            <span class="n">input_f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">buff</span> <span class="o">=</span> <span class="n">input_f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">buff</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">input_f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
                <span class="n">toks</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">angle</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">weight</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">angles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                    <span class="n">weights</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="c1"># Skip non-data lines</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">angles</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="BasicPage.createMemento"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.createMemento">[docs]</a>    <span class="k">def</span> <span class="nf">createMemento</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the current state of the page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span></div>

<div class="viewcode-block" id="BasicPage.save_current_state"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.save_current_state">[docs]</a>    <span class="k">def</span> <span class="nf">save_current_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store current state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># save model option</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disp_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getDispParamList</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disp_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disp_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

            <span class="c1"># model combobox: complex code because of mac&#39;s silent error</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">IsShown</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">structurecombobox</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
                    <span class="n">s_select</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">s_select</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">structurecombobox</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">s_select</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">f_select</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">f_select</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">formfactorcombobox</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">f_select</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cb_select</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">cb_select</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">categorycombobox</span> <span class="o">=</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">cb_select</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">enable2D</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enable2D</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
        <span class="c1"># save data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">qmax_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">qmin_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dI_noweight</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dI_noweight</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dI_didata</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dI_didata</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dI_sqrdata</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dI_sqrdata</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dI_idata</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dI_idata</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dq_l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dq_l</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dq_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dq_r</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;enable_disp&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">enable_disp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_disp</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disable_disp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_disp</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">smearer</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_smearer</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;enable_smearer&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">enable_smearer</span> <span class="o">=</span> \
                                <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enable_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disable_smearer</span> <span class="o">=</span> \
                                <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disable_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">pinhole_smearer</span> <span class="o">=</span> \
                                <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pinhole_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dx_percent</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx_percent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dxl</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dxw</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">slit_smearer</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slit_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">type</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
        <span class="c1"># save plotting range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_plotting_range</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">orientation_params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">orientation_params_disp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">fittable_param</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">fixed_param</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">str_parameters</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># save checkbutton state and txtcrtl values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str_parameters</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">str_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">,</span>
                                     <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation_params_disp</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">orientation_params_disp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">)</span>
        <span class="c1"># save chisqr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">tcChi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcChi</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span></div>

<div class="viewcode-block" id="BasicPage.save_current_state_fit"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.save_current_state_fit">[docs]</a>    <span class="k">def</span> <span class="nf">save_current_state_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store current state for fit_page</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># save model option</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disp_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getDispParamList</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disp_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disp_list</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">enable2D</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enable2D</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
        <span class="c1"># save data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;enable_disp&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">enable_disp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_disp</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disable_disp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_disp</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">smearer</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_smearer</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;enable_smearer&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">enable_smearer</span> <span class="o">=</span> \
                                <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">enable_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disable_smearer</span> <span class="o">=</span> \
                                <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disable_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">pinhole_smearer</span> <span class="o">=</span> \
                                <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pinhole_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">slit_smearer</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slit_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dI_noweight</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dI_noweight</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dI_didata</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dI_didata</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dI_sqrdata</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dI_sqrdata</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">dI_idata</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dI_idata</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;disp_box&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disp_box</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_box</span><span class="o">.</span><span class="n">GetCurrentSelection</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">type</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>

        <span class="c1"># save plotting range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_plotting_range</span><span class="p">()</span>

        <span class="c1"># save checkbutton state and txtcrtl values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation_params_disp</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">orientation_params_disp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasicPage.check_invalid_panel"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.check_invalid_panel">[docs]</a>    <span class="k">def</span> <span class="nf">check_invalid_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check if the user can already perform some action with this panel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_smearer</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_disp</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please load Data and select Model to start...&quot;</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s1">&#39;Info&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span></div>

<div class="viewcode-block" id="BasicPage.set_model_state"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.set_model_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_model_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset page given a model state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">disp_cb_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_list</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">disp_list</span>

        <span class="c1"># fill model combobox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_combox_helper</span><span class="p">()</span>
        <span class="c1"># select the current model</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># to support older version</span>
            <span class="n">category_pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">categorycombobox</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">category_pos</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ind_cat</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">GetCount</span><span class="p">()):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorycombobox</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">ind_cat</span><span class="p">)</span> <span class="o">==</span> \
                                        <span class="n">state</span><span class="o">.</span><span class="n">categorycombobox</span><span class="p">:</span>
                    <span class="n">category_pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ind_cat</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">category_pos</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># to support older version</span>
            <span class="n">formfactor_pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">formfactorcombobox</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">formfactor_pos</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ind_form</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">GetCount</span><span class="p">()):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">ind_form</span><span class="p">)</span> <span class="o">==</span> \
                                        <span class="n">state</span><span class="o">.</span><span class="n">formfactorcombobox</span><span class="p">:</span>
                    <span class="n">formfactor_pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ind_form</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">formfactor_pos</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># to support older version</span>
            <span class="n">structfactor_pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">structurecombobox</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">structfactor_pos</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">ind_struct</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">GetCount</span><span class="p">()):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">ind_struct</span><span class="p">)</span> <span class="o">==</span> \
                                        <span class="n">state</span><span class="o">.</span><span class="n">structurecombobox</span><span class="p">:</span>
                    <span class="n">structfactor_pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ind_struct</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="n">structfactor_pos</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">multi_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">multi_factor</span><span class="p">)</span>

        <span class="c1"># reset state of checkbox,textcrtl  and  regular parameters value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation_params_disp</span><span class="p">,</span>
                                     <span class="n">state</span><span class="o">.</span><span class="n">orientation_params_disp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">,</span>
                                     <span class="n">state</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str_parameters</span><span class="p">,</span>
                                     <span class="n">state</span><span class="o">.</span><span class="n">str_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="c1"># display dispersion info layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_disp</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">enable_disp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_disp</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">disable_disp</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;disp_box&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_box</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disp_box</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">disp_box</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_box</span><span class="o">.</span><span class="n">GetCurrentSelection</span><span class="p">()</span>
            <span class="n">dispersity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_box</span><span class="o">.</span><span class="n">GetClientData</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">dispersity</span><span class="o">.</span><span class="n">__name__</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_dipers_Param</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;ArrayDispersion&quot;</span><span class="p">:</span>

                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">[</span><span class="n">item</span><span class="p">],</span> <span class="s2">&quot;SetValue&quot;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span>
                                                    <span class="n">state</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                        <span class="c1"># Create the dispersion objects</span>
                        <span class="n">disp_model</span> <span class="o">=</span> <span class="n">POLYDISPERSITY_MODELS</span><span class="p">[</span><span class="s1">&#39;array&#39;</span><span class="p">]()</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="s2">&quot;values&quot;</span><span class="p">)</span> <span class="ow">and</span> \
                                 <span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">values</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">weights</span>
                                <span class="n">disp_model</span><span class="o">.</span><span class="n">set_weights</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                                                       <span class="n">state</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_reset_dispersity</span><span class="p">()</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp_model</span>
                        <span class="c1"># Set the new model as the dispersion object</span>
                        <span class="c1"># for the selected parameter</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_dispersion</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">disp_model</span><span class="p">)</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_persistency_dict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> \
                                                <span class="p">[</span><span class="n">state</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">weights</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getParamList</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_list</span> <span class="ow">and</span> \
                            <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">details</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disp_cb_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">)</span>
        <span class="c1"># smearing info  restore</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;enable_smearer&quot;</span><span class="p">):</span>
            <span class="c1"># set smearing value whether or not the data</span>
            <span class="c1"># contain the smearing info</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_smearer</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">enable_smearer</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_smearer</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">disable_smearer</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onSmear</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinhole_smearer</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">pinhole_smearer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slit_smearer</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">slit_smearer</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dI_noweight</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">dI_noweight</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dI_didata</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">dI_didata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dI_sqrdata</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">dI_sqrdata</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dI_idata</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">dI_idata</span><span class="p">)</span>

        <span class="c1"># we have two more options for smearing</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pinhole_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onPinholeSmear</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">slit_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onSlitSmear</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

        <span class="c1"># reset state of checkbox,textcrtl  and dispersity parameters value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">)</span>

        <span class="c1"># draw the model with previous parameters value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_onparamEnter_helper</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select_param</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="c1"># Save state_fit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_current_state_fit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lay_out</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span></div>

<div class="viewcode-block" id="BasicPage.get_cat_combo_box_pos"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_cat_combo_box_pos">[docs]</a>    <span class="k">def</span> <span class="nf">get_cat_combo_box_pos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterate through the categories to find the structurefactor</span>
<span class="sd">        :return: combo_box_position</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">formfactor</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">formfactorcombobox</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">formfactor</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">formfactor</span> <span class="o">=</span> <span class="n">formfactor</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">list_item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">formfactor</span> <span class="ow">in</span> <span class="n">list_item</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">Items</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="BasicPage.reset_page_helper"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.reset_page_helper">[docs]</a>    <span class="k">def</span> <span class="nf">reset_page_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use page_state and change the state of existing page</span>

<span class="sd">        :precondition: the page is already drawn or created</span>

<span class="sd">        :postcondition: the state of the underlying data changes as well as the</span>
<span class="sd">            state of the graphic interface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="c1"># set data, etc. from the state</span>
        <span class="c1"># reset page between theory and fitting from bookmarking</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">data</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">data_min</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">qmin</span>
            <span class="n">data_max</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">qmax</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span> <span class="o">=</span> <span class="n">data_min</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span> <span class="o">=</span> <span class="n">data_max</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data_min</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data_max</span><span class="p">))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">qmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">qmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">enable2D</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">enable2D</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magnetic_on</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">magnetic_on</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># Backward compatibility (for older state files)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magnetic_on</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">disp_cb_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_list</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">disp_list</span>

        <span class="c1"># fill model combobox</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_combox_helper</span><span class="p">()</span>
        <span class="c1"># select the current model</span>
        <span class="n">state</span><span class="o">.</span><span class="n">_convert_to_sasmodels</span><span class="p">()</span>
        <span class="n">state</span><span class="o">.</span><span class="n">categorycombobox</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">categorycombobox</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">categorycombobox</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">Items</span><span class="p">:</span>
            <span class="n">category_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">Items</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
                <span class="n">state</span><span class="o">.</span><span class="n">categorycombobox</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Look in master list for model name (model.lower)</span>
            <span class="n">category_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cat_combo_box_pos</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">category_pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_combox</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="n">PLUGIN_NAME_BASE</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span> <span class="o">==</span> <span class="n">CUSTOM_MODEL</span> \
                <span class="ow">and</span> <span class="n">PLUGIN_NAME_BASE</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">formfactorcombobox</span><span class="p">:</span>
            <span class="n">state</span><span class="o">.</span><span class="n">formfactorcombobox</span> <span class="o">=</span> \
                <span class="n">PLUGIN_NAME_BASE</span> <span class="o">+</span> <span class="n">state</span><span class="o">.</span><span class="n">formfactorcombobox</span>
        <span class="n">formfactor_pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">ind_form</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">GetCount</span><span class="p">()):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">ind_form</span><span class="p">)</span> <span class="o">==</span> \
                                                <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">formfactorcombobox</span><span class="p">):</span>
                <span class="n">formfactor_pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ind_form</span><span class="p">)</span>
                <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">Select</span><span class="p">(</span><span class="n">formfactor_pos</span><span class="p">)</span>

        <span class="n">structfactor_pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">structurecombobox</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">state</span><span class="o">.</span><span class="n">structurecombobox</span> <span class="o">=</span> <span class="nb">unicode</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">structurecombobox</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ind_struct</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">GetCount</span><span class="p">()):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">GetString</span><span class="p">(</span><span class="n">ind_struct</span><span class="p">)</span> <span class="o">==</span> \
                                                <span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">structurecombobox</span><span class="p">):</span>
                    <span class="n">structfactor_pos</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ind_struct</span><span class="p">)</span>
                    <span class="k">break</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="n">structfactor_pos</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">multi_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">multi_factor</span><span class="p">)</span>

        <span class="c1"># draw the panel according to the new model parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_on_select_model</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

        <span class="c1"># take care of 2D button</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_view</span><span class="o">.</span><span class="n">IsEnabled</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable2D</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_view</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;2D Mode&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_view</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;1D Mode&quot;</span><span class="p">)</span>

        <span class="c1"># reset state of checkbox,textcrtl  and  regular parameters value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation_params_disp</span><span class="p">,</span>
                                     <span class="n">state</span><span class="o">.</span><span class="n">orientation_params_disp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">,</span>
                                     <span class="n">state</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str_parameters</span><span class="p">,</span>
                                     <span class="n">state</span><span class="o">.</span><span class="n">str_parameters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
        <span class="c1"># display dispersion info layer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_disp</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">enable_disp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disable_disp</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">disable_disp</span><span class="p">)</span>
        <span class="c1"># If the polydispersion is ON</span>
        <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">enable_disp</span><span class="p">:</span>
            <span class="c1"># reset dispersion according the state</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_dipers_Param</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_reset_page_disp_helper</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="c1"># plotting range restore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_plotting_range</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="c1"># smearing info  restore</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;enable_smearer&quot;</span><span class="p">):</span>
            <span class="c1"># set smearing value whether or not the data</span>
            <span class="c1"># contain the smearing info</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable_smearer</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">enable_smearer</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_smearer</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">disable_smearer</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onSmear</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pinhole_smearer</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">pinhole_smearer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slit_smearer</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">slit_smearer</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dI_noweight</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">dI_noweight</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dI_didata</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">dI_didata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dI_sqrdata</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">dI_sqrdata</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dI_idata</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">dI_idata</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># to support older state file formats</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dI_noweight</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dI_didata</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dI_sqrdata</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dI_idata</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="c1"># we have two more options for smearing</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pinhole_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dx_percent</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">dx_percent</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx_percent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">dx_old</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dx_percent</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx_percent</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smear_pinhole_percent</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx_percent</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onPinholeSmear</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">slit_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dxl</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">dxl</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dxw</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">dxw</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smear_slit_height</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxl</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dxw</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smear_slit_width</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dxw</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">smear_slit_width</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onSlitSmear</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

        <span class="c1"># reset state of checkbox,textcrtl  and dispersity parameters value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">)</span>

        <span class="c1"># draw the model with previous parameters value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_onparamEnter_helper</span><span class="p">()</span>
        <span class="c1"># reset the value of chisqr when not consistent with the value computed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcChi</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">tcChi</span><span class="p">))</span>
        <span class="c1"># reset context menu items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_context_menu</span><span class="p">()</span>

        <span class="c1"># set the value of the current state to the state given as parameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">m_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">m_name</span></div>

    <span class="k">def</span> <span class="nf">_reset_page_disp_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Help to rest page for dispersions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getParamList</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_list</span> <span class="ow">and</span> \
                            <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">details</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="c1"># for k,v in self.state.disp_cb_dict.iteritems():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disp_cb_dict</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">disp_type</span> <span class="ow">in</span> <span class="n">state</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="c1"># disp_model = disp</span>
            <span class="n">disp_model</span> <span class="o">=</span> <span class="n">POLYDISPERSITY_MODELS</span><span class="p">[</span><span class="n">disp_type</span><span class="p">]()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp_model</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1"># Try to set dispersion only when available</span>
            <span class="c1"># for eg., pass the orient. angles for 1D Cal</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_dispersion</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">disp_model</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_persistency_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="p">[</span><span class="n">state</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">state</span><span class="o">.</span><span class="n">weights</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_polyfunc_selection</span><span class="p">(</span><span class="n">disp_model</span><span class="p">)</span>
            <span class="k">for</span> <span class="nb">list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span> <span class="ow">and</span> <span class="nb">list</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="nb">list</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
                    <span class="c1"># For the array disp_model, set the values and weights</span>
                    <span class="k">if</span> <span class="n">selection</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">disp_model</span><span class="o">.</span><span class="n">set_weights</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">],</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Diables all fittable params for array</span>
                            <span class="nb">list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                            <span class="nb">list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
                            <span class="nb">list</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
                            <span class="nb">list</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
                            <span class="nb">list</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="c1"># For array, disable all fixed params</span>
            <span class="k">if</span> <span class="n">selection</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="c1"># try it and pass it for the orientation for 1D</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_selectDlg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        open a dialog file to select the customized polydispersity function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_default_save_location</span> <span class="o">=</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_save_location</span><span class="p">()</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Choose a weight file&quot;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_default_save_location</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;*.*&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OPEN</span><span class="p">)</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">path</span>

    <span class="k">def</span> <span class="nf">_reset_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset the context menu</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_id_pool</span><span class="p">)</span>  <span class="c1"># Reusing ids for context menu</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">saved_states</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_saved_state</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1"># Add item in the context menu</span>
            <span class="n">wx_id</span> <span class="o">=</span> <span class="n">ids</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Save model and state </span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_saved_state</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">popUpMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx_id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onResetModel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_reset_plotting_range</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the plotting range to a given state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">qmin</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">qmax</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_save_typeOfmodel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save radiobutton containing the type model that can be selected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.state.shape_rbutton = self.shape_rbutton.GetValue()</span>
        <span class="c1"># self.state.shape_indep_rbutton = self.shape_indep_rbutton.GetValue()</span>
        <span class="c1"># self.state.struct_rbutton = self.struct_rbutton.GetValue()</span>
        <span class="c1"># self.state.plugin_rbutton = self.plugin_rbutton.GetValue()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">structurecombobox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">formfactorcombobox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">categorycombobox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

        <span class="c1"># post state to fit panel</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">PageInfoEvent</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_save_plotting_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        save the state of plotting range</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">qmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">qmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">npts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts_x</span>

    <span class="k">def</span> <span class="nf">_onparamEnter_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_modified</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check if values entered by the user are changed and valid to replot</span>
<span class="sd">        model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Flag to register when a parameter has changed.</span>
        <span class="c1"># is_modified = False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitrange</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">is_2Ddata</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1"># self._undo.Enable(True)</span>
        <span class="c1"># check if 2d data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;Data2D&quot;</span><span class="p">:</span>
            <span class="n">is_2Ddata</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># Either we get a is_modified = True passed in because</span>
            <span class="c1"># _update_paramv_on_fit() has been called already or</span>
            <span class="c1"># we need to check here ourselves.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_modified</span><span class="p">:</span>
                <span class="n">is_modified</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_value_enter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">)</span>
                               <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_value_enter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">)</span>
                               <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_value_enter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">))</span>

            <span class="c1"># Here we should check whether the boundaries have been modified.</span>
            <span class="c1"># If qmin and qmax have been modified, update qmin and qmax and</span>
            <span class="c1"># set the is_modified flag to True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_qrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="p">):</span>
                <span class="n">tempmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">tempmin</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span> <span class="o">=</span> <span class="n">tempmin</span>
                    <span class="n">is_modified</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">tempmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">tempmax</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span> <span class="o">=</span> <span class="n">tempmax</span>
                    <span class="n">is_modified</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="n">is_2Ddata</span><span class="p">:</span>
                    <span class="n">is_modified</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_Npts</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">is_modified</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_Npts_1D</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fitrange</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="c1"># if any value is modify draw model with new value</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitrange</span><span class="p">:</span>
                <span class="c1"># self.btFit.Disable()</span>
                <span class="k">if</span> <span class="n">is_2Ddata</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">btEditMask</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_2Ddata</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_on</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">btEditMask</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">is_modified</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitrange</span><span class="p">:</span>
                <span class="c1"># Theory case: need to get npts value to draw</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">npts_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Npts_total</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Npts_fit</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Npts_total</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_save_plotting_range</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_default_data</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_change</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_draw_model</span><span class="p">()</span>
                <span class="c1"># Time delay has been introduced to prevent _handle error</span>
                <span class="c1"># on Windows</span>
                <span class="c1"># This part of code is executed when model is selected and</span>
                <span class="c1"># it&#39;s parameters are changed (with respect to previously</span>
                <span class="c1"># selected model). There are two Iq evaluations occuring one</span>
                <span class="c1"># after another and therefore there may be compilation error</span>
                <span class="c1"># if model is calculated for the first time.</span>
                <span class="c1"># This seems to be Windows only issue - haven&#39;t tested on Linux</span>
                <span class="c1"># though.The proper solution (other than time delay) requires</span>
                <span class="c1"># more fundemental code refatoring</span>
                <span class="c1"># Wojtek P. Nov 7, 2016</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">ON_MAC</span><span class="p">:</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>

        <span class="c1"># logging.info(&quot;is_modified flag set to %g&quot;,is_modified)</span>
        <span class="k">return</span> <span class="n">is_modified</span>

    <span class="k">def</span> <span class="nf">_update_paramv_on_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        make sure that update param values just before the fitting</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># flag for qmin qmax check values</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fitrange</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">is_modified</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c1"># wx.PostEvent(self._manager.parent, StatusEvent(status=&quot; \</span>
        <span class="c1"># updating ... &quot;,type=&quot;update&quot;))</span>

        <span class="c1"># So make sure that update param values on_Fit.</span>
        <span class="c1"># self._undo.Enable(True)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Npts_total</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Npts_fit</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_data</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">page_finder</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span><span class="o">.</span><span class="n">set_fit_data</span><span class="p">(</span>
                        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
            <span class="c1"># Check the values</span>
            <span class="n">is_modified</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_check_value_enter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">)</span>
                           <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_value_enter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">)</span>
                           <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_value_enter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">))</span>

            <span class="c1"># If qmin and qmax have been modified, update qmin and qmax and</span>
            <span class="c1"># Here we should check whether the boundaries have been modified.</span>
            <span class="c1"># If qmin and qmax have been modified, update qmin and qmax and</span>
            <span class="c1"># set the is_modified flag to True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fitrange</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_qrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitrange</span><span class="p">:</span>
                <span class="n">tempmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">tempmin</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span> <span class="o">=</span> <span class="n">tempmin</span>
                <span class="n">tempmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">tempmax</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span> <span class="o">=</span> <span class="n">tempmax</span>
                <span class="k">if</span> <span class="n">tempmax</span> <span class="o">==</span> <span class="n">tempmin</span><span class="p">:</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">temp_smearer</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                    <span class="n">temp_smearer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_smearer</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slit_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                        <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_slit_smear</span><span class="p">()</span>
                    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pinhole_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                        <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_pinhole_smear</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">enable_smearer</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">set_smearer</span><span class="p">(</span><span class="n">smearer</span><span class="o">=</span><span class="n">temp_smearer</span><span class="p">,</span>
                                                  <span class="n">uid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
                                                  <span class="n">fid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                                  <span class="n">qmin</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span><span class="p">),</span>
                                                  <span class="n">qmax</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span><span class="p">),</span>
                                                  <span class="n">enable_smearer</span><span class="o">=</span><span class="n">enable_smearer</span><span class="p">,</span>
                                                  <span class="n">draw</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_2D</span><span class="p">():</span>
                    <span class="n">enable_smearer</span> <span class="o">=</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">set_smearer</span><span class="p">(</span><span class="n">smearer</span><span class="o">=</span><span class="n">temp_smearer</span><span class="p">,</span>
                                              <span class="n">qmin</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span><span class="p">),</span>
                                              <span class="n">uid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
                                              <span class="n">fid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                              <span class="n">qmax</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span><span class="p">),</span>
                                              <span class="n">enable_smearer</span><span class="o">=</span><span class="n">enable_smearer</span><span class="p">,</span>
                                              <span class="n">draw</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">index_data</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span>
                                      <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span><span class="p">))</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">index_data</span><span class="p">]))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Npts_fit</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># No data in the panel</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">npts_x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Npts_total</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="k">return</span> <span class="n">flag</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_2D</span><span class="p">():</span>
                    <span class="c1"># only 2D case set mask</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_Npts</span><span class="p">()</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">flag</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c1"># For invalid q range, disable the mask editor and fit button, vs.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitrange</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_2D</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">btEditMask</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_2D</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_on</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">btEditMask</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">flag</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Cannot Plot or Fit :Must select a &quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; model or Fitting range is not valid!!!  &quot;</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_current_state</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

        <span class="k">return</span> <span class="n">flag</span><span class="p">,</span> <span class="n">is_modified</span>

    <span class="k">def</span> <span class="nf">_reset_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listtorestore</span><span class="p">,</span> <span class="n">statelist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the parameters at the given state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">statelist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">listtorestore</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listtorestore</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">statelist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">listtorestore</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">item_page</span> <span class="o">=</span> <span class="n">listtorestore</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">item_page_info</span> <span class="o">=</span> <span class="n">param</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">item_page_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;theta&quot;</span> <span class="ow">or</span> <span class="n">item_page_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span>
                            <span class="s2">&quot;phi&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_2D</span><span class="p">():</span>
                        <span class="k">break</span>
                    <span class="c1"># change the state of the check box for simple parameters</span>
                    <span class="k">if</span> <span class="n">item_page</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">item_page</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">item_page_info</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">item_page</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">item_page</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">item_page_info</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">item_page</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;ComboBox&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">item_page_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fun_list</span><span class="p">:</span>
                                <span class="n">fun_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fun_list</span><span class="p">[</span><span class="n">item_page_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">item_page_info</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fun_val</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">item_page</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="c1"># show or hide text +/-</span>
                        <span class="k">if</span> <span class="n">item_page_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                            <span class="n">item_page</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">item_page</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">item_page</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="c1"># show of hide the text crtl for fitting error</span>
                        <span class="k">if</span> <span class="n">item_page_info</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">item_page</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                            <span class="n">item_page</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item_page_info</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">item_page</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">item_page</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="c1"># show of hide the text crtl for fitting error</span>
                        <span class="n">item_page</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">item_page</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item_page_info</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">item_page</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="c1"># show of hide the text crtl for fitting error</span>
                        <span class="n">item_page</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">item_page</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item_page_info</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">break</span>

    <span class="k">def</span> <span class="nf">_reset_strparam_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listtorestore</span><span class="p">,</span> <span class="n">statelist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the string parameters at the given state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">statelist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">listtorestore</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">statelist</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">listtorestore</span><span class="p">)):</span>
            <span class="n">item_page</span> <span class="o">=</span> <span class="n">listtorestore</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">item_page_info</span> <span class="o">=</span> <span class="n">statelist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="c1"># change the state of the check box for simple parameters</span>

            <span class="k">if</span> <span class="n">item_page</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">item_page</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">format_number</span><span class="p">(</span><span class="n">item_page_info</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">True</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">item_page</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">param_name</span> <span class="o">=</span> <span class="n">item_page_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">item_page_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">selection</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fun_list</span><span class="p">:</span>
                    <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fun_list</span><span class="p">[</span><span class="n">value</span><span class="p">]</span>
                <span class="n">item_page</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">selection</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_copy_parameters_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listtocopy</span><span class="p">,</span> <span class="n">statelist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        copy the state of button</span>

<span class="sd">        :param listtocopy: the list of check button to copy</span>
<span class="sd">        :param statelist: list of state object to store the current state</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">listtocopy</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">listtocopy</span><span class="p">:</span>

            <span class="n">checkbox_state</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">checkbox_state</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="n">parameter_name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">parameter_value</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">parameter_value</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="n">static_text</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">static_text</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">IsShown</span><span class="p">()</span>
            <span class="n">error_value</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">error_state</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">error_value</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                <span class="n">error_state</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">IsShown</span><span class="p">()</span>

            <span class="n">min_value</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">min_state</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">min_value</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                <span class="n">min_state</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">IsShown</span><span class="p">()</span>

            <span class="n">max_value</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">max_state</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">max_value</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                <span class="n">max_state</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">IsShown</span><span class="p">()</span>
            <span class="n">unit</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">GetLabel</span><span class="p">()</span>

            <span class="n">statelist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">checkbox_state</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">,</span> <span class="n">parameter_value</span><span class="p">,</span>
                              <span class="n">static_text</span><span class="p">,</span> <span class="p">[</span><span class="n">error_state</span><span class="p">,</span> <span class="n">error_value</span><span class="p">],</span>
                              <span class="p">[</span><span class="n">min_state</span><span class="p">,</span> <span class="n">min_value</span><span class="p">],</span>
                              <span class="p">[</span><span class="n">max_state</span><span class="p">,</span> <span class="n">max_value</span><span class="p">],</span> <span class="n">unit</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_draw_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_chisqr</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to draw or refresh a plotted model.</span>
<span class="sd">        The method will use the data member from the model page</span>
<span class="sd">        to build a call to the fitting perspective manager.</span>

<span class="sd">        :param chisqr: update chisqr value [bool]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_draw_model_after</span><span class="p">,</span> <span class="n">update_chisqr</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_draw_model_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update_chisqr</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method to draw or refresh a plotted model.</span>
<span class="sd">        The method will use the data member from the model page</span>
<span class="sd">        to build a call to the fitting perspective manager.</span>

<span class="sd">        :param chisqr: update chisqr value [bool]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if self.check_invalid_panel():</span>
        <span class="c1">#    return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">temp_smear</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;enable_smearer&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                    <span class="n">temp_smear</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_smearer</span>
            <span class="c1"># compute weight for the current data</span>
            <span class="kn">from</span> <span class="nn">sas.sasgui.perspectives.fitting.utils</span> <span class="kn">import</span> <span class="n">get_weight</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_weight_flag</span><span class="p">()</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="n">get_weight</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">is2d</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_2D</span><span class="p">(),</span> <span class="n">flag</span><span class="o">=</span><span class="n">flag</span><span class="p">)</span>
            <span class="n">toggle_mode_on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_view</span><span class="o">.</span><span class="n">IsEnabled</span><span class="p">()</span>
            <span class="n">is_2d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_2D</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">draw_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                                     <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
                                     <span class="n">smearer</span><span class="o">=</span><span class="n">temp_smear</span><span class="p">,</span>
                                     <span class="n">qmin</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span><span class="p">),</span>
                                     <span class="n">qmax</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span><span class="p">),</span>
                                     <span class="n">page_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
                                     <span class="n">toggle_mode_on</span><span class="o">=</span><span class="n">toggle_mode_on</span><span class="p">,</span>
                                     <span class="n">state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
                                     <span class="n">enable2D</span><span class="o">=</span><span class="n">is_2d</span><span class="p">,</span>
                                     <span class="n">update_chisqr</span><span class="o">=</span><span class="n">update_chisqr</span><span class="p">,</span>
                                     <span class="n">source</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">,</span>
                                     <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_show_sld</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot SLD profile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get profile data</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getProfile</span><span class="p">()</span>

        <span class="kn">from</span> <span class="nn">sas.sasgui.plottools</span> <span class="kn">import</span> <span class="n">Data1D</span> <span class="k">as</span> <span class="n">pf_data1d</span>
        <span class="c1"># from sas.sasgui.perspectives.theory.profile_dialog import SLDPanel</span>
        <span class="kn">from</span> <span class="nn">sas.sasgui.guiframe.local_perspectives.plotting.profile_dialog</span> \
            <span class="kn">import</span> <span class="n">SLDPanel</span>
        <span class="n">sld_data</span> <span class="o">=</span> <span class="n">pf_data1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">sld_data</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;SLD&#39;</span>
        <span class="n">sld_data</span><span class="o">.</span><span class="n">axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sld_axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="n">SLDPanel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">sld_data</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sld_axes</span><span class="p">,</span>
                              <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_set_multfactor_combobox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">multiplicity</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set comboBox for multitfactor of CoreMultiShellModel</span>
<span class="sd">        :param multiplicit: no. of multi-functionality</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># build content of the combobox</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">multiplicity</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_hide_multfactor_combobox</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_show_multfactor_combobox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show the comboBox of muitfactor of CoreMultiShellModel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutifactor_text</span><span class="o">.</span><span class="n">IsShown</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mutifactor_text</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mutifactor_text1</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="o">.</span><span class="n">IsShown</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_hide_multfactor_combobox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hide the comboBox of muitfactor of CoreMultiShellModel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutifactor_text</span><span class="o">.</span><span class="n">IsShown</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mutifactor_text</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mutifactor_text1</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="o">.</span><span class="n">IsShown</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>

<div class="viewcode-block" id="BasicPage.formfactor_combo_init"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.formfactor_combo_init">[docs]</a>    <span class="k">def</span> <span class="nf">formfactor_combo_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        First time calls _show_combox_helper</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_combox</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_show_combox_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fill panel&#39;s combo box according to the type of model selected</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mod_cat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">GetStringSelection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mod_cat</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">m_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mod_cat</span> <span class="o">==</span> <span class="n">CUSTOM_MODEL</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_list_box</span><span class="p">[</span><span class="n">mod_cat</span><span class="p">]:</span>
                    <span class="n">m_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cat_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span><span class="p">[</span><span class="n">mod_cat</span><span class="p">]</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span> <span class="ow">in</span> <span class="n">cat_dic</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">enabled</span><span class="p">:</span>
                        <span class="n">m_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                         <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_box</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="p">,</span> <span class="n">m_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_modify_cat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when category manager is opened</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">on_category_panel</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_show_combox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show combox box associate with type of model selected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_combox_helper</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_on_select_model</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_typeOfmodel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4_4</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_populate_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">combobox</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fill combox box with dict item</span>

<span class="sd">        :param list: contains item to fill the combox</span>
<span class="sd">            item must model class</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">models</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">models</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;NoStructure&quot;</span><span class="p">:</span>
                <span class="n">mlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">models</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">models</span><span class="p">))</span>

        <span class="c1"># Sort the models</span>
        <span class="n">mlist_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">mlist</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">mlist_sorted</span><span class="p">:</span>
            <span class="n">combobox</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">_onQrangeEnter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check validity of value enter in the Q range field</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tcrtl</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
        <span class="c1"># Clear msg if previously shown.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
        <span class="c1"># Flag to register when a parameter has changed.</span>
        <span class="k">if</span> <span class="n">tcrtl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">tcrtl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="n">tcrtl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">WHITE</span><span class="p">)</span>
                <span class="c1"># If qmin and qmax have been modified, update qmin and qmax</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_qrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="p">):</span>
                    <span class="n">tempmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">tempmin</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span> <span class="o">=</span> <span class="n">tempmin</span>
                    <span class="n">tempmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">tempmax</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span> <span class="o">=</span> <span class="n">tempmax</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tcrtl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Model Error: wrong value entered: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                          <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
                    <span class="k">return</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">tcrtl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Model Error: wrong value entered: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
                <span class="k">return</span>
            <span class="c1"># Check if # of points for theory model are valid(&gt;0).</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">npts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">check_float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="p">):</span>
                    <span class="n">temp_npts</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npts</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">temp_npts</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span> <span class="o">=</span> <span class="n">temp_npts</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Cannot plot: No points in Q range!!!  &quot;</span>
                    <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tcrtl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Model Error: wrong value entered!!!&quot;</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_current_state</span><span class="p">()</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">PageInfoEvent</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_change</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1"># Draw the model for a different range</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">is_data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_default_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_model</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_theory_qrange_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check validity of value enter in the Q range field</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">tcrtl</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
        <span class="c1"># Clear msg if previously shown.</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
        <span class="c1"># Flag to register when a parameter has changed.</span>
        <span class="n">is_modified</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">tcrtl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tcrtl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="n">tcrtl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">WHITE</span><span class="p">)</span>

                <span class="c1"># If qmin and qmax have been modified, update qmin and qmax</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_qrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theory_qmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">theory_qmax</span><span class="p">):</span>
                    <span class="n">tempmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theory_qmin</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">tempmin</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">theory_qmin_x</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">theory_qmin_x</span> <span class="o">=</span> <span class="n">tempmin</span>
                    <span class="n">tempmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theory_qmax</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">tempmax</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">theory_qmax_x</span> <span class="o">=</span> <span class="n">tempmax</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tcrtl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Model Error: wrong value entered: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                          <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
                    <span class="k">return</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">tcrtl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Model Error: wrong value entered: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
                <span class="k">return</span>
            <span class="c1"># Check if # of points for theory model are valid(&gt;0).</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Npts_total</span><span class="o">.</span><span class="n">IsEditable</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">check_float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Npts_total</span><span class="p">):</span>
                    <span class="n">temp_npts</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Npts_total</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">temp_npts</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span> <span class="o">=</span> <span class="n">temp_npts</span>
                        <span class="n">is_modified</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Cannot Plot: No points in Q range!!!  &quot;</span>
                    <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tcrtl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Model Error: wrong value entered!!!&quot;</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_current_state</span><span class="p">()</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">PageInfoEvent</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_change</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1"># Draw the model for a different range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_default_data</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_model</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_select_model_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        call back for model selection</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># reset dictionary containing reference to dispersion</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disp_obj_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temp_multi_functional</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">f_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">GetCurrentSelection</span><span class="p">()</span>
        <span class="c1"># For MAC</span>
        <span class="n">form_factor</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">f_id</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">form_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">GetClientData</span><span class="p">(</span><span class="n">f_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">form_factor</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> \
            <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">form_factor</span><span class="p">,</span> <span class="s1">&#39;is_form_factor&#39;</span><span class="p">)</span> <span class="ow">or</span> \
                <span class="ow">not</span> <span class="n">form_factor</span><span class="o">.</span><span class="n">is_form_factor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text2</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text2</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text2</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">text2</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">form_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># set multifactor for Mutifunctional models</span>
            <span class="k">if</span> <span class="n">form_factor</span><span class="o">.</span><span class="n">is_multiplicity_model</span><span class="p">:</span>
                <span class="n">m_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="o">.</span><span class="n">GetCurrentSelection</span><span class="p">()</span>
                <span class="n">multiplicity</span> <span class="o">=</span> <span class="n">form_factor</span><span class="o">.</span><span class="n">multiplicity_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_multfactor_combobox</span><span class="p">(</span><span class="n">multiplicity</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_show_multfactor_combobox</span><span class="p">()</span>
                <span class="c1"># ToDo: this info should be called directly from the model</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">form_factor</span><span class="o">.</span><span class="n">multiplicity_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># &#39;No. of Shells: &#39;</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">mutifactor_text</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m_id</span> <span class="o">&gt;</span> <span class="n">multiplicity</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># default value</span>
                    <span class="n">m_id</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">multi_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="o">.</span><span class="n">GetClientData</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi_factor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">multi_factor</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="n">m_id</span><span class="p">)</span>
                <span class="c1"># Check len of the text1 and max_multiplicity</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">if</span> <span class="n">form_factor</span><span class="o">.</span><span class="n">multiplicity_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> \
                        <span class="nb">len</span><span class="p">(</span><span class="n">form_factor</span><span class="o">.</span><span class="n">multiplicity_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">form_factor</span><span class="o">.</span><span class="n">multiplicity_info</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">multi_factor</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mutifactor_text1</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="c1"># Check if model has  get sld profile.</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">form_factor</span><span class="o">.</span><span class="n">multiplicity_info</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sld_axes</span> <span class="o">=</span> <span class="n">form_factor</span><span class="o">.</span><span class="n">multiplicity_info</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">show_sld_button</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">sld_axes</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_hide_multfactor_combobox</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_sld_button</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">multi_factor</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_hide_multfactor_combobox</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_sld_button</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">multi_factor</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">s_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">GetCurrentSelection</span><span class="p">()</span>
        <span class="n">struct_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="o">.</span><span class="n">GetClientData</span><span class="p">(</span><span class="n">s_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">struct_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">sasmodels.sasview_model</span> <span class="kn">import</span> <span class="n">MultiplicationModel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">MultiplicationModel</span><span class="p">(</span><span class="n">form_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multi_factor</span><span class="p">),</span>
                                             <span class="n">struct_factor</span><span class="p">())</span>
            <span class="c1"># multifunctional form factor</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">form_factor</span><span class="o">.</span><span class="n">non_fittable</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">temp_multi_functional</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">form_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi_factor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">form_factor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multi_factor</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># old style plugin models do not accept a multiplicity argument</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">form_factor</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span>

        <span class="c1"># check if model has magnetic parameters</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">magnetic_params</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_has_magnetic</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_has_magnetic</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1"># post state to fit panel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">qmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">multi_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">multi_factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">disp_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getDispParamList</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">disp_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_set_focus</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_validate_qrange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qmin_ctrl</span><span class="p">,</span> <span class="n">qmax_ctrl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Verify that the Q range controls have valid values</span>
<span class="sd">        and that Qmin &lt; Qmax.</span>

<span class="sd">        :param qmin_ctrl: text control for Qmin</span>
<span class="sd">        :param qmax_ctrl: text control for Qmax</span>

<span class="sd">        :return: True is the Q range is value, False otherwise</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">qmin_validity</span> <span class="o">=</span> <span class="n">check_float</span><span class="p">(</span><span class="n">qmin_ctrl</span><span class="p">)</span>
        <span class="n">qmax_validity</span> <span class="o">=</span> <span class="n">check_float</span><span class="p">(</span><span class="n">qmax_ctrl</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">qmin_validity</span> <span class="ow">and</span> <span class="n">qmax_validity</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">qmin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">qmin_ctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="n">qmax</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">qmax_ctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">qmin</span> <span class="o">&lt;</span> <span class="n">qmax</span><span class="p">:</span>
                <span class="c1"># Make sure to set both colours white.</span>
                <span class="n">qmin_ctrl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">WHITE</span><span class="p">)</span>
                <span class="n">qmin_ctrl</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
                <span class="n">qmax_ctrl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">WHITE</span><span class="p">)</span>
                <span class="n">qmax_ctrl</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">qmin_ctrl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
                <span class="n">qmin_ctrl</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
                <span class="n">qmax_ctrl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
                <span class="n">qmax_ctrl</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid Q range: Q min must be smaller than Q max&quot;</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">_validate_Npts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the number of points for fitting is more than 10 points.</span>
<span class="sd">        If valid, setvalues Npts_fit otherwise post msg.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># default flag</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># Theory</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable2D</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">flag</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">:</span>
            <span class="c1"># q value from qx and qy</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">qx_data</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">qx_data</span> <span class="o">+</span>
                                <span class="n">data</span><span class="o">.</span><span class="n">qy_data</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">qy_data</span><span class="p">)</span>
            <span class="c1"># get unmasked index</span>
            <span class="n">index_data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">)</span> <span class="o">&amp;</span> \
                         <span class="p">(</span><span class="n">radius</span> <span class="o">&lt;=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()))</span>
            <span class="n">index_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">index_data</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
            <span class="n">index_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">index_data</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_data</span><span class="p">[</span><span class="n">index_data</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="c1"># change the color pink.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Data Error: &quot;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Too few points in </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fitrange</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Npts_fit</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index_data</span><span class="p">[</span><span class="n">index_data</span><span class="p">])))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fitrange</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="n">flag</span>

    <span class="k">def</span> <span class="nf">_validate_Npts_1D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the number of points for fitting is more than 5 points.</span>
<span class="sd">        If valid, setvalues Npts_fit otherwise post msg.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># default flag</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># Theory</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">flag</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">:</span>
            <span class="c1"># q value from qx and qy</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">x</span>
            <span class="c1"># get unmasked index</span>
            <span class="n">index_data</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">)</span> <span class="o">&amp;</span> \
                         <span class="p">(</span><span class="n">radius</span> <span class="o">&lt;=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()))</span>
            <span class="n">index_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">index_data</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index_data</span><span class="p">[</span><span class="n">index_data</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="c1"># change the color pink.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Data Error: &quot;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Too few points in </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">data</span><span class="o">.</span><span class="n">name</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fitrange</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Npts_fit</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">index_data</span><span class="p">[</span><span class="n">index_data</span><span class="p">])))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fitrange</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="n">flag</span>

    <span class="k">def</span> <span class="nf">_check_value_enter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param list: model parameter and panel info</span>
<span class="sd">        :Note: each item of the list should be as follow:</span>
<span class="sd">            item=[check button state, parameter&#39;s name,</span>
<span class="sd">                paramater&#39;s value, string=&quot;+/-&quot;,</span>
<span class="sd">                parameter&#39;s error of fit,</span>
<span class="sd">                parameter&#39;s minimum value,</span>
<span class="sd">                parameter&#39;s maximum value ,</span>
<span class="sd">                parameter&#39;s units]</span>

<span class="sd">        Returns True if the model parameters have changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_modified</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">:</span>
            <span class="c1"># skip angle parameters for 1D</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable2D</span> <span class="ow">and</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">value_ctrl</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value_ctrl</span><span class="o">.</span><span class="n">IsEnabled</span><span class="p">():</span>
                <span class="c1"># ArrayDispersion disables PD, Min, Max, Npts, Nsigs</span>
                <span class="k">continue</span>

            <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">value_str</span> <span class="o">=</span> <span class="n">value_ctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.npts&quot;</span><span class="p">):</span>
                <span class="n">validity</span> <span class="o">=</span> <span class="n">check_int</span><span class="p">(</span><span class="n">value_ctrl</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">validity</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value_str</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.nsigmas&quot;</span><span class="p">):</span>
                <span class="n">validity</span> <span class="o">=</span> <span class="n">check_float</span><span class="p">(</span><span class="n">value_ctrl</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">validity</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_str</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># value or polydispersity</span>

                <span class="c1"># Check that min, max and value are floats</span>
                <span class="n">min_ctrl</span><span class="p">,</span> <span class="n">max_ctrl</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">min_str</span> <span class="o">=</span> <span class="n">min_ctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">max_str</span> <span class="o">=</span> <span class="n">max_ctrl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">validity</span> <span class="o">=</span> <span class="n">check_float</span><span class="p">(</span><span class="n">value_ctrl</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">min_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">validity</span> <span class="o">=</span> <span class="n">validity</span> <span class="ow">and</span> <span class="n">check_float</span><span class="p">(</span><span class="n">min_ctrl</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">max_str</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">validity</span> <span class="o">=</span> <span class="n">validity</span> <span class="ow">and</span> <span class="n">check_float</span><span class="p">(</span><span class="n">max_ctrl</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">validity</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Check that min is less than max</span>
                <span class="n">low</span> <span class="o">=</span> <span class="o">-</span><span class="n">numpy</span><span class="o">.</span><span class="n">inf</span> <span class="k">if</span> <span class="n">min_str</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">min_str</span><span class="p">)</span>
                <span class="n">high</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">inf</span> <span class="k">if</span> <span class="n">max_str</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">max_str</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">high</span> <span class="o">&lt;</span> <span class="n">low</span><span class="p">:</span>
                    <span class="n">min_ctrl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
                    <span class="n">min_ctrl</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
                    <span class="n">max_ctrl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
                    <span class="n">max_ctrl</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
                    <span class="c1"># msg = &quot;Invalid fit range for %s: min must be smaller</span>
                    <span class="c1"># than max&quot;%name</span>
                    <span class="c1"># wx.PostEvent(self._manager.parent,</span>
                    <span class="c1"># StatusEvent(status=msg))</span>
                    <span class="k">continue</span>

                <span class="c1"># Force value between min and max</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value_str</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="n">low</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">low</span>
                    <span class="n">value_ctrl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">format_number</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">high</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">high</span>
                    <span class="n">value_ctrl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">format_number</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">details</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
                <span class="n">old_low</span><span class="p">,</span> <span class="n">old_high</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">old_low</span> <span class="o">!=</span> <span class="n">low</span> <span class="ow">or</span> <span class="n">old_high</span> <span class="o">!=</span> <span class="n">high</span><span class="p">:</span>
                    <span class="c1"># The configuration has changed but it won&#39;t change the</span>
                    <span class="c1"># computed curve so no need to set is_modified to True</span>
                    <span class="c1"># is_modified = True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">details</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span>

            <span class="c1"># Update value in model if it has changed</span>
            <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getParam</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">is_modified</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="n">is_modified</span>

    <span class="k">def</span> <span class="nf">_set_dipers_Param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        respond to self.enable_disp and self.disable_disp radio box.</span>
<span class="sd">        The dispersity object is reset inside the model into Gaussian.</span>
<span class="sd">        When the user select yes , this method display a combo box for</span>
<span class="sd">        more selection when the user selects No,the combo box disappears.</span>
<span class="sd">        Redraw the model with the default dispersity (Gaussian)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># On selction if no model exists.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable_disp</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please select a Model first...&quot;</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s1">&#39;Info&#39;</span><span class="p">)</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                         <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s2">&quot;Polydispersion: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_dispersity</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_disp</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sizer4_4</span><span class="o">.</span><span class="n">Clear</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_disp</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
            <span class="c1"># layout for model containing no dispersity parameters</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">disp_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getDispParamList</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disp_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_layout_sizer_noDipers</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># set gaussian sizer</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_on_select_Disp</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sizer4_4</span><span class="o">.</span><span class="n">Clear</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

        <span class="c1"># post state to fit panel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_current_state</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">event</span> <span class="o">=</span> <span class="n">PageInfoEvent</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="c1"># draw the model with the current dispersity</span>

        <span class="c1"># Wojtek P, Oct 8, 2016: Calling draw_model seems to be unessecary.</span>
        <span class="c1"># By comenting it we save an extra Iq calculation</span>
        <span class="c1"># self._draw_model()</span>

        <span class="c1"># Need to use FitInside again here to replace the next four lines.</span>
        <span class="c1"># Otherwised polydispersity off does not resize the scrollwindow.</span>
        <span class="c1"># PDB Nov 28, 2015</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FitInside</span><span class="p">()</span>
<span class="c1">#        self.sizer4_4.Layout()</span>
<span class="c1">#        self.sizer5.Layout()</span>
<span class="c1">#        self.Layout()</span>
<span class="c1">#        self.Refresh()</span>

    <span class="k">def</span> <span class="nf">_layout_sizer_noDipers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw a sizer with no dispersity info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ix</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iy</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params_disp</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4_4</span><span class="o">.</span><span class="n">Clear</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;No polydispersity available for this model&quot;</span>
        <span class="n">model_disp</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4_4</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">model_disp</span><span class="p">,</span> <span class="p">(</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                          <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ADJUST_MINSIZE</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4_4</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_reset_dispersity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        put gaussian dispersity into current model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_toFit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_toFit</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">param_toFit</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params_disp</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_toFit</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">param_toFit</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params_disp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># from sas.models.dispersion_models import GaussianDispersion</span>
        <span class="kn">from</span> <span class="nn">sasmodels.weights</span> <span class="kn">import</span> <span class="n">GaussianDispersion</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_current_state</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sizer4_4</span><span class="o">.</span><span class="n">Clear</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">:</span>
                <span class="c1"># The parameter was un-selected.</span>
                <span class="c1"># Go back to Gaussian model (with 0 pts)</span>
                <span class="n">disp_model</span> <span class="o">=</span> <span class="n">GaussianDispersion</span><span class="p">()</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp_model</span>
                <span class="c1"># Set the new model as the dispersion object</span>
                <span class="c1"># for the selected parameter</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_dispersion</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">disp_model</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

        <span class="c1"># save state into</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_current_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_select_Disp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        allow selecting different dispersion</span>
<span class="sd">        self.disp_list should change type later .now only gaussian</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_sizer_dispersion</span><span class="p">()</span>

        <span class="c1"># Redraw the model</span>
        <span class="c1">#  Wojtek P. Nov 7, 2016: Redrawing seems to be unnecessary here</span>
        <span class="c1"># self._draw_model()</span>
        <span class="c1"># self._undo.Enable(True)</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">PageInfoEvent</span><span class="p">(</span><span class="n">page</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4_4</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer4</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetupScrolling</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_disp_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select a distribution function for the polydispersion</span>

<span class="sd">        :Param event: ComboBox event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get ready for new event</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="c1"># Get event object</span>
        <span class="n">disp_box</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>

        <span class="c1"># Try to select a Distr. function</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">disp_box</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">disp_box</span><span class="o">.</span><span class="n">GetCurrentSelection</span><span class="p">()</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="n">disp_box</span><span class="o">.</span><span class="n">Name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">disp_name</span> <span class="o">=</span> <span class="n">disp_box</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="n">dispersity</span> <span class="o">=</span> <span class="n">disp_box</span><span class="o">.</span><span class="n">GetClientData</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>

            <span class="c1"># disp_model =  GaussianDispersion()</span>
            <span class="n">disp_model</span> <span class="o">=</span> <span class="n">dispersity</span><span class="p">()</span>
            <span class="c1"># Get param names to reset the values of the param</span>
            <span class="n">name1</span> <span class="o">=</span> <span class="n">param_name</span> <span class="o">+</span> <span class="s2">&quot;.width&quot;</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="n">param_name</span> <span class="o">+</span> <span class="s2">&quot;.npts&quot;</span>
            <span class="n">name3</span> <span class="o">=</span> <span class="n">param_name</span> <span class="o">+</span> <span class="s2">&quot;.nsigmas&quot;</span>
            <span class="c1"># Check Disp. function whether or not it is &#39;array&#39;</span>
            <span class="k">if</span> <span class="n">disp_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;array&quot;</span><span class="p">:</span>
                <span class="n">value2</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">value3</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">value1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_array_disp</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name1</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="n">disp_model</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_del_array_values</span><span class="p">(</span><span class="n">name1</span><span class="p">)</span>
                <span class="c1"># self._reset_array_disp(param_name)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="p">[</span><span class="n">name1</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp_model</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_dispersion</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">disp_model</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="p">[</span><span class="n">name1</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp_model</span><span class="o">.</span><span class="n">type</span>

                <span class="n">value1</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">format_number</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getParam</span><span class="p">(</span><span class="n">name1</span><span class="p">),</span> <span class="bp">True</span><span class="p">))</span>
                <span class="n">value2</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">format_number</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getParam</span><span class="p">(</span><span class="n">name2</span><span class="p">)))</span>
                <span class="n">value3</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">format_number</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getParam</span><span class="p">(</span><span class="n">name3</span><span class="p">)))</span>
            <span class="c1"># Reset fittable polydispersin parameter value</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">name1</span><span class="p">:</span>
                    <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">value1</span><span class="p">)</span>
                    <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="c1"># Disable for array</span>
                    <span class="k">if</span> <span class="n">disp_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;array&quot;</span><span class="p">:</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
                    <span class="k">break</span>
            <span class="c1"># Reset fixed polydispersion params</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">name2</span><span class="p">:</span>
                    <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">value2</span><span class="p">)</span>
                    <span class="c1"># Disable Npts for array</span>
                    <span class="k">if</span> <span class="n">disp_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;array&quot;</span><span class="p">:</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">name3</span><span class="p">:</span>
                    <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">value3</span><span class="p">)</span>
                    <span class="c1"># Disable Nsigs for array</span>
                    <span class="k">if</span> <span class="n">disp_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;array&quot;</span><span class="p">:</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>

            <span class="c1"># Make sure the check box updated</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_all_checked_params</span><span class="p">()</span>

            <span class="c1"># update params</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_paramv_on_fit</span><span class="p">()</span>
            <span class="c1"># draw</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_draw_model</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="c1"># Error msg</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Error occurred:&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; Could not select the distribution function...&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; Please select another distribution function.&quot;</span>
            <span class="n">disp_box</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s2">&quot;pink&quot;</span><span class="p">)</span>
            <span class="c1"># Focus on Fit button so that users can see the pinky box</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">btFit</span><span class="o">.</span><span class="n">SetFocus</span><span class="p">()</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
                         <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="s2">&quot;error&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_set_array_disp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set array dispersion</span>

<span class="sd">        :param name: name of the parameter for the dispersion to be set</span>
<span class="sd">        :param disp: the polydisperion object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># The user wants this parameter to be averaged.</span>
        <span class="c1"># Pop up the file selection dialog.</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_selectDlg</span><span class="p">()</span>
        <span class="c1"># Array data</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># If nothing was selected, just return</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disp_cb_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="c1"># self.noDisper_rbox.SetValue(True)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_save_location</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_default_save_location</span> <span class="o">=</span> \
                             <span class="bp">self</span><span class="o">.</span><span class="n">_default_save_location</span>

        <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">values</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

        <span class="c1"># If any of the two arrays is empty, notify the user that we won&#39;t</span>
        <span class="c1"># proceed</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_toFit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_toFit</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param_toFit</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Tell the user that we are about to apply the distribution</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Applying loaded </span><span class="si">%s</span><span class="s2"> distribution: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_array_disp_model</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="n">disp</span><span class="p">,</span>
                                   <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">basename</span>

    <span class="k">def</span> <span class="nf">_set_array_disp_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">disp</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                              <span class="n">values</span><span class="o">=</span><span class="p">[],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set array dispersion model</span>

<span class="sd">        :param name: name of the parameter for the dispersion to be set</span>
<span class="sd">        :param disp: the polydisperion object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">disp</span><span class="o">.</span><span class="n">set_weights</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_dispersion</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">disp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp</span><span class="o">.</span><span class="n">type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span>
        <span class="c1"># Store the object to make it persist outside the</span>
        <span class="c1"># scope of this method</span>
        <span class="c1"># TODO: refactor model to clean this up?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>

        <span class="c1"># Set the new model as the dispersion object for the</span>
        <span class="c1"># selected parameter</span>
        <span class="c1"># self.model.set_dispersion(p, disp_model)</span>
        <span class="c1"># Store a reference to the weights in the model object</span>
        <span class="c1"># so that</span>
        <span class="c1"># it&#39;s not lost when we use the model within another thread.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_persistency_dict</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="p">[</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_persistency_dict</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> \
            <span class="p">[</span><span class="n">values</span><span class="p">,</span> <span class="n">weights</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_del_array_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset array dispersion</span>

<span class="sd">        :param name: name of the parameter for the dispersion to be set</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Try to delete values and weight of the names array dic if exists</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="c1"># delete all other dic</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_persistency_dict</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_persistency_dict</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_lay_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns self.Layout</span>

<span class="sd">        :Note: Mac seems to like this better when self.</span>
<span class="sd">            Layout is called after fitting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sleep4sec</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">_sleep4sec</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            sleep for 1 sec only applied on Mac</span>
<span class="sd">            Note: This 1sec helps for Mac not to crash on self.</span>
<span class="sd">            Layout after self._draw_model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ON_MAC</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_find_polyfunc_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disp_func</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        FInd Comboox selection from disp_func</span>

<span class="sd">        :param disp_function: dispersion distr. function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find the selection</span>
        <span class="k">if</span> <span class="n">disp_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">POLYDISPERSITY_MODELS</span><span class="o">.</span><span class="n">values</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">disp_func</span><span class="o">.</span><span class="n">__class__</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>  <span class="c1"># Fall through to default class</span>
        <span class="k">return</span> <span class="n">POLYDISPERSITY_MODELS</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;gaussian&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="BasicPage.on_reset_clicked"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.on_reset_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_reset_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        On &#39;Reset&#39; button  for Q range clicked</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># For 3 different cases: Data2D, Data1D, and theory</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Please select a model first...&quot;</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s1">&#39;Info&#39;</span><span class="p">)</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">return</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;Data2D&quot;</span><span class="p">:</span>
            <span class="n">data_min</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xmin</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">xmax</span><span class="p">))</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ymin</span><span class="p">),</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ymax</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span> <span class="o">=</span> <span class="n">data_min</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
            <span class="c1"># self.data.mask = numpy.ones(len(self.data.data),dtype=bool)</span>
            <span class="c1"># check smearing</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                <span class="c1"># set smearing value whether or</span>
                <span class="c1"># not the data contain the smearing info</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pinhole_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_pinhole_smear</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span> <span class="o">=</span> <span class="n">_QMIN_DEFAULT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span> <span class="o">=</span> <span class="n">_QMAX_DEFAULT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span> <span class="o">=</span> <span class="n">_NPTS_DEFAULT</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">npts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">!=</span> <span class="s2">&quot;Data2D&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
            <span class="c1"># check smearing</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disable_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                <span class="c1"># set smearing value whether or</span>
                <span class="c1"># not the data contain the smearing info</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slit_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_slit_smear</span><span class="p">()</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">pinhole_smearer</span><span class="o">.</span><span class="n">GetValue</span><span class="p">():</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_pinhole_smear</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flag</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="k">if</span> <span class="n">flag</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Cannot Plot :Must enter a number!!!  &quot;</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># set relative text ctrs.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmin</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qmax</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_npts2fit</span><span class="p">()</span>
            <span class="c1"># At this point, some button and variables satatus (disabled?)</span>
            <span class="c1"># should be checked such as color that should be reset to</span>
            <span class="c1"># white in case that it was pink.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_onparamEnter_helper</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_current_state</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">qmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmin_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">qmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qmax_x</span>

        <span class="c1"># reset the q range values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reset_plotting_range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_draw_model</span><span class="p">()</span></div>

<div class="viewcode-block" id="BasicPage.select_log"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.select_log">[docs]</a>    <span class="k">def</span> <span class="nf">select_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log checked to generate log spaced points for theory model</span>
<span class="sd">        &quot;&quot;&quot;</span></div>

<div class="viewcode-block" id="BasicPage.get_images"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_images">[docs]</a>    <span class="k">def</span> <span class="nf">get_images</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the images of the plots corresponding this panel for report</span>

<span class="sd">        : return graphs: list of figures</span>
<span class="sd">        : Need Move to guiframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># set list of graphs</span>
        <span class="n">graphs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">canvases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">res_item</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c1"># call gui_manager</span>
        <span class="n">gui_manager</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_manager</span><span class="o">.</span><span class="n">parent</span>
        <span class="c1"># loops through the panels [dic]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">item2</span> <span class="ow">in</span> <span class="n">gui_manager</span><span class="o">.</span><span class="n">plot_panels</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">data_title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">group_id</span>
            <span class="c1"># try to get all plots belonging to this control panel</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">g_id</span> <span class="o">=</span> <span class="n">item2</span><span class="o">.</span><span class="n">group_id</span>
                <span class="k">if</span> <span class="n">g_id</span> <span class="o">==</span> <span class="n">data_title</span> <span class="ow">or</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">g_id</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;res&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_id</span><span class="p">))</span> <span class="ow">or</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">g_id</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">g_id</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;res&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph_id</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">res_item</span> <span class="o">=</span> <span class="p">[</span><span class="n">item2</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">item2</span><span class="o">.</span><span class="n">canvas</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># append to the list</span>
                        <span class="n">graphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item2</span><span class="o">.</span><span class="n">figure</span><span class="p">)</span>
                        <span class="n">canvases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item2</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># Not for control panels</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
        <span class="c1"># Make sure the resduals plot goes to the last</span>
        <span class="k">if</span> <span class="n">res_item</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">graphs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">canvases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res_item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="c1"># return the list of graphs</span>
        <span class="k">return</span> <span class="n">graphs</span><span class="p">,</span> <span class="n">canvases</span></div>

<div class="viewcode-block" id="BasicPage.on_function_help_clicked"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.on_function_help_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_function_help_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called when &#39;Help&#39; button is pressed next to model</span>
<span class="sd">        of interest.  This calls DocumentationWindow from</span>
<span class="sd">        documentation_window.py. It will load the top level of the model</span>
<span class="sd">        help documenation sphinx generated html if no model is presented.</span>
<span class="sd">        If a model IS present then if documention for that model exists</span>
<span class="sd">        it will load to that  point otherwise again it will go to the top.</span>
<span class="sd">        For Wx2.8 and below is used (i.e. non-released through installer)</span>
<span class="sd">        a browser is loaded and the top of the model documentation only is</span>
<span class="sd">        accessible because webbrowser module does not pass anything after</span>
<span class="sd">        the # to the browser.</span>

<span class="sd">        :param event: on Help Button pressed event</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="n">_TreeLocation</span> <span class="o">=</span> <span class="s1">&#39;user/models/&#39;</span> <span class="o">+</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;.html&#39;</span>
            <span class="n">_doc_viewer</span> <span class="o">=</span> <span class="n">DocumentationWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">_TreeLocation</span><span class="p">,</span>
                                              <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; Help&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_TreeLocation</span> <span class="o">=</span> <span class="s1">&#39;user/index.html&#39;</span>
            <span class="n">_doc_viewer</span> <span class="o">=</span> <span class="n">DocumentationWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">_TreeLocation</span><span class="p">,</span>
                                              <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;General Model Help&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasicPage.on_model_help_clicked"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.on_model_help_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_model_help_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function called when &#39;Description&#39; button is pressed next to model</span>
<span class="sd">        of interest.  This calls the Description embedded in the model. This</span>
<span class="sd">        should work with either Wx2.8 and lower or higher. If no model is</span>
<span class="sd">        selected it will give the message that a model must be chosen first</span>
<span class="sd">        in the box that would normally contain the description.  If a badly</span>
<span class="sd">        behaved model is encountered which has no description then it will</span>
<span class="sd">        give the message that none is available.</span>

<span class="sd">        :param event: on Description Button pressed event</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;index.html&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Model description:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s2">&quot;Info&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># frame.Destroy()</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">description</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;Sorry, no information is available for this model.&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">description</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot;You must select a model to get information on this&quot;</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_on_mag_angle_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bring up Magnetic Angle definition bmp image whenever the ? button</span>
<span class="sd">        is clicked. Calls DocumentationWindow with the path of the location</span>
<span class="sd">        within the documentation tree (after /doc/ ....&quot;. When using old</span>
<span class="sd">        versions of Wx (i.e. before 2.9 and therefore not part of release</span>
<span class="sd">        versions distributed via installer) it brings up an image viewer</span>
<span class="sd">        box which allows the user to click through the rest of the images in</span>
<span class="sd">        the directory.  Not ideal but probably better than alternative which</span>
<span class="sd">        would bring up the entire discussion of how magnetic models work?</span>
<span class="sd">        Specially since it is not likely to be accessed.  The normal release</span>
<span class="sd">        versions bring up the normal image box.</span>

<span class="sd">        :param evt: Triggers on clicking ? in Magnetic Angles? box</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_TreeLocation</span> <span class="o">=</span> <span class="s2">&quot;_images/M_angles_pic.bmp&quot;</span>
        <span class="n">_doc_viewer</span> <span class="o">=</span> <span class="n">DocumentationWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">_TreeLocation</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;Magnetic Angle Defintions&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_mag_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bring up Magnetic Angle definition bmp image whenever the ? button</span>
<span class="sd">        is clicked. Calls DocumentationWindow with the path of the location</span>
<span class="sd">        within the documentation tree (after /doc/ ....&quot;. When using old</span>
<span class="sd">        versions of Wx (i.e. before 2.9 and therefore not part of release</span>
<span class="sd">        versions distributed via installer) it brings up an image viewer</span>
<span class="sd">        box which allows the user to click through the rest of the images in</span>
<span class="sd">        the directory.  Not ideal but probably better than alternative which</span>
<span class="sd">        would bring up the entire discussion of how magnetic models work?</span>
<span class="sd">        Specially since it is not likely to be accessed.  The normal release</span>
<span class="sd">        versions bring up the normal image box.</span>

<span class="sd">        :param evt: Triggers on clicking ? in Magnetic Angles? box</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_TreeLocation</span> <span class="o">=</span> <span class="s2">&quot;user/magnetism.html&quot;</span>
        <span class="n">_doc_viewer</span> <span class="o">=</span> <span class="n">DocumentationWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">_TreeLocation</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                                          <span class="s2">&quot;Polarized Beam/Magnetc Help&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_mag_on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Magnetic Parameters ON/OFF</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">button</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">button</span><span class="o">.</span><span class="n">GetLabel</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;ON&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magnetic_on</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">button</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Magnetic OFF&quot;</span><span class="p">)</span>
            <span class="n">m_value</span> <span class="o">=</span> <span class="mf">1.0e-06</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">magnetic_params</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;M0&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">m_value</span><span class="p">)</span>
                    <span class="n">m_value</span> <span class="o">+=</span> <span class="mf">0.5e-06</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">magnetic_on</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">button</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Magnetic ON&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">magnetic_params</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;M0&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># reset mag value to zero fo safety</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_model_param_sizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="c1"># self._set_sizer_dispersion()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">magnetic_on</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnetic_on</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetupScrolling</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

<div class="viewcode-block" id="BasicPage.on_pd_help_clicked"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.on_pd_help_clicked">[docs]</a>    <span class="k">def</span> <span class="nf">on_pd_help_clicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bring up Polydispersity Documentation whenever the ? button is clicked.</span>
<span class="sd">        Calls DocumentationWindow with the path of the location within the</span>
<span class="sd">        documentation tree (after /doc/ ....&quot;.  Note that when using old</span>
<span class="sd">        versions of Wx (before 2.9) and thus not the release version of</span>
<span class="sd">        istallers, the help comes up at the top level of the file as</span>
<span class="sd">        webbrowser does not pass anything past the # to the browser when it is</span>
<span class="sd">        running &quot;file:///....&quot;</span>

<span class="sd">        :param event: Triggers on clicking ? in polydispersity box</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">_TreeLocation</span> <span class="o">=</span> <span class="s2">&quot;user/sasgui/perspectives/fitting/pd_help.html&quot;</span>
        <span class="n">_PageAnchor</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">_doc_viewer</span> <span class="o">=</span> <span class="n">DocumentationWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">_TreeLocation</span><span class="p">,</span>
                                          <span class="n">_PageAnchor</span><span class="p">,</span> <span class="s2">&quot;Polydispersity Help&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="BasicPage.on_left_down"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.on_left_down">[docs]</a>    <span class="k">def</span> <span class="nf">on_left_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get key stroke event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Figuring out key combo: Cmd for copy, Alt for paste</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">CmdDown</span><span class="p">()</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">ShiftDown</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_paste</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">event</span><span class="o">.</span><span class="n">CmdDown</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="c1"># make event free</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span></div>

<div class="viewcode-block" id="BasicPage.get_copy"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_copy">[docs]</a>    <span class="k">def</span> <span class="nf">get_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get copy params to clipboard</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_copy_params</span><span class="p">()</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_clipboard</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_info</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flag</span></div>

<div class="viewcode-block" id="BasicPage.get_copy_params"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_copy_params">[docs]</a>    <span class="k">def</span> <span class="nf">get_copy_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the string copies of the param names and values in the tap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;sasview_parameter_values:&#39;</span>
        <span class="c1"># Do it if params exist</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>

            <span class="c1"># go through the parameters</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_copy_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="n">strings</span>

            <span class="c1"># go through the fittables</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_copy_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params_disp</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="n">strings</span>

            <span class="c1"># go through the fixed params</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_copy_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params_disp</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="n">strings</span>

            <span class="c1"># go through the str params</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_copy_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str_parameters</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">)</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="n">strings</span>
            <span class="k">return</span> <span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="BasicPage.get_copy_excel"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_copy_excel">[docs]</a>    <span class="k">def</span> <span class="nf">get_copy_excel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get copy params to clipboard</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_copy_params_excel</span><span class="p">()</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_clipboard</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_info</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flag</span></div>

<div class="viewcode-block" id="BasicPage.get_copy_params_excel"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_copy_params_excel">[docs]</a>    <span class="k">def</span> <span class="nf">get_copy_params_excel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the string copies of the param names and values in the tap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">crlf</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

        <span class="c1"># Do it if params exist</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># parameter name</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="n">tab</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_err&quot;</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="n">tab</span>

            <span class="n">content</span> <span class="o">+=</span> <span class="n">crlf</span>

            <span class="c1"># row of values and errors...</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>  <span class="c1"># value</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="n">tab</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>  <span class="c1"># error</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="n">tab</span>

            <span class="k">return</span> <span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="BasicPage.get_copy_latex"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_copy_latex">[docs]</a>    <span class="k">def</span> <span class="nf">get_copy_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get copy params to clipboard</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_copy_params_latex</span><span class="p">()</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_clipboard</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_info</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flag</span></div>

<div class="viewcode-block" id="BasicPage.get_copy_params_latex"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_copy_params_latex">[docs]</a>    <span class="k">def</span> <span class="nf">get_copy_params_latex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the string copies of the param names and values in the tap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin{table}&#39;</span>
        <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">begin{tabular}[h]&#39;</span>

        <span class="n">crlf</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="o">+</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">tab</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

        <span class="c1"># Do it if params exist</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>

            <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39;{|&#39;</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39;l|l|&#39;</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39;}\hline&#39;</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="n">crlf</span>

            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">):</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;\_&#39;</span><span class="p">)</span>  <span class="c1"># parameter name</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39; &amp; &#39;</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="n">param</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;\_&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;\_err&quot;</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39; &amp; &#39;</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1"> </span><span class="se">\\</span><span class="s1">hline&#39;</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="n">crlf</span>

            <span class="c1"># row of values and errors...</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">):</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="n">param</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>  <span class="c1"># parameter value</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39; &amp; &#39;</span>
                <span class="n">content</span> <span class="o">+=</span> <span class="n">param</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>  <span class="c1"># parameter error</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39; &amp; &#39;</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1"> </span><span class="se">\\</span><span class="s1">hline&#39;</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="n">crlf</span>

            <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">end{tabular}&#39;</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\\</span><span class="s1">end{table}&#39;</span>
            <span class="k">return</span> <span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="BasicPage.set_clipboard"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.set_clipboard">[docs]</a>    <span class="k">def</span> <span class="nf">set_clipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Put the string to the clipboard</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">content</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">TheClipboard</span><span class="o">.</span><span class="n">Open</span><span class="p">():</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">TheClipboard</span><span class="o">.</span><span class="n">SetData</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">TextDataObject</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">)))</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">TheClipboard</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">None</span></div>

    <span class="k">def</span> <span class="nf">_get_copy_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">orient_param</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helping get value and name of the params</span>

<span class="sd">        : param param:  parameters</span>
<span class="sd">        : param orient_param = oritational params</span>
<span class="sd">        : return content: strings [list] [name,value:....]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">bound_hi</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">bound_lo</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="c1"># go through the str params</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
            <span class="c1"># copy only the params shown</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">IsShown</span><span class="p">():</span>
                <span class="k">continue</span>
            <span class="n">disfunc</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s1">&#39;ComboBox&#39;</span><span class="p">:</span>
                    <span class="n">disfunc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

            <span class="c1"># 2D</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;Data2D&quot;</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">check</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">check</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="c1"># 1D</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># for 1D all parameters except orientation</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">orient_param</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">check</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">check</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

            <span class="c1"># Bounds</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">bound_lo</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                <span class="n">bound_hi</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="c1"># harmless - need to just pass</span>
                <span class="k">pass</span>

            <span class="c1"># add to the content</span>
            <span class="k">if</span> <span class="n">disfunc</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>

                <span class="n">disfunc</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">disfunc</span>
            <span class="c1"># Need to support array func for copy/paste</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">disfunc</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;array&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">disfunc</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">disfunc</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="n">disfunc</span> <span class="o">+=</span> <span class="s1">&#39;,&#39;</span>
                    <span class="k">for</span> <span class="n">weight</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                        <span class="n">disfunc</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="n">content</span> <span class="o">+=</span> <span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="n">disfunc</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> \
                       <span class="n">bound_lo</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="n">bound_hi</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span>

        <span class="k">return</span> <span class="n">content</span>

<div class="viewcode-block" id="BasicPage.get_clipboard"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_clipboard">[docs]</a>    <span class="k">def</span> <span class="nf">get_clipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get strings in the clipboard</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="c1"># Get text from the clip board</span>
        <span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">TheClipboard</span><span class="o">.</span><span class="n">Open</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">TheClipboard</span><span class="o">.</span><span class="n">IsSupported</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">DataFormat</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">DF_TEXT</span><span class="p">)):</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextDataObject</span><span class="p">()</span>
                <span class="c1"># get wx dataobject</span>
                <span class="n">success</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TheClipboard</span><span class="o">.</span><span class="n">GetData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="c1"># get text</span>
                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">GetText</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="c1"># close clipboard</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">TheClipboard</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">text</span></div>

<div class="viewcode-block" id="BasicPage.get_paste"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_paste">[docs]</a>    <span class="k">def</span> <span class="nf">get_paste</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Paste params from the clipboard</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_clipboard</span><span class="p">()</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_paste_params</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_copy_info</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">flag</span></div>

<div class="viewcode-block" id="BasicPage.get_paste_params"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_paste_params">[docs]</a>    <span class="k">def</span> <span class="nf">get_paste_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the string copies of the param names and values in the tap</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># put the text into dictionary</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;sasview_parameter_values&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_copy_info</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">check</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="c1"># Transfer the text to content[dictionary]</span>
                <span class="n">context</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">check</span><span class="p">,</span> <span class="n">value</span><span class="p">]</span>

                <span class="c1"># limits</span>
                <span class="n">limit_lo</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="n">context</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">limit_lo</span><span class="p">)</span>
                <span class="n">limit_hi</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="n">context</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">limit_hi</span><span class="p">)</span>

            <span class="c1"># ToDo: PlugIn this poly disp function for pasting</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">poly_func</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="n">context</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly_func</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># take the vals and weights for  array</span>
                    <span class="n">array_values</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">array_weights</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">a_val</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_val</span> <span class="ow">in</span> <span class="n">array_values</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>
                    <span class="n">weit</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">a_weit</span><span class="p">)</span> <span class="k">for</span> <span class="n">a_weit</span> <span class="ow">in</span> <span class="n">array_weights</span><span class="p">[</span><span class="mi">1</span><span class="p">:]]</span>

                    <span class="n">context</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="n">context</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weit</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">poly_func</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">context</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poly_func</span><span class="p">)</span>

        <span class="c1"># Do it if params exist</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">:</span>
            <span class="c1"># go through the parameters</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_paste_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

            <span class="c1"># go through the fittables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_paste_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fittable_param</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params_disp</span><span class="p">,</span>
                                   <span class="n">context</span><span class="p">)</span>

            <span class="c1"># go through the fixed params</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_paste_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params_disp</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

            <span class="c1"># go through the str params</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_paste_helper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">str_parameters</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">orientation_params</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">None</span></div>

    <span class="k">def</span> <span class="nf">_get_paste_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">orient_param</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helping set values of the params</span>

<span class="sd">        : param param:  parameters</span>
<span class="sd">        : param orient_param: oritational params</span>
<span class="sd">        : param content: dictionary [ name, value: name1.value1,...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># go through the str params</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
            <span class="c1"># 2D</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;Data2D&quot;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="n">check</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">pd</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="c1"># If this is parameter.width, then pd may be a floating</span>
                        <span class="c1"># point value or it may be an array distribution.</span>
                        <span class="c1"># Nothing to do for parameter.npts or parameter.nsigmas.</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="nb">float</span><span class="p">(</span><span class="n">pd</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.npts&#39;</span><span class="p">):</span>
                                <span class="n">pd</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pd</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="c1"># continue</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span> <span class="ow">and</span> <span class="n">pd</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                                <span class="k">continue</span>
                    <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pd</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span> <span class="ow">and</span> <span class="n">pd</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                        <span class="c1"># Only array func has pd == &#39;&#39; case.</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;ComboBox&quot;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">content</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fun_list</span><span class="p">:</span>
                            <span class="n">fun_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fun_list</span><span class="p">[</span><span class="n">content</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fun_val</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]))</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="c1"># passing as harmless non-update</span>
                        <span class="k">pass</span>

                    <span class="n">value</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_paste_poly_help</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">check</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
                        <span class="n">is_true</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">elif</span> <span class="n">check</span> <span class="o">==</span> <span class="s1">&#39;False&#39;</span><span class="p">:</span>
                        <span class="n">is_true</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">is_true</span> <span class="o">=</span> <span class="bp">None</span>
                    <span class="k">if</span> <span class="n">is_true</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">is_true</span><span class="p">)</span>
            <span class="c1"># 1D</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># for 1D all parameters except orientation</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">orient_param</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">check</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="c1"># Avoid changing combox content</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">content</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
                        <span class="n">pd</span> <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="c1"># If this is parameter.width, then pd may be a</span>
                            <span class="c1"># floating point value or it may be an array</span>
                            <span class="c1"># distribution. Nothing to do for parameter.npts or</span>
                            <span class="c1"># parameter.nsigmas.</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">pd</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pd</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.npts&#39;</span><span class="p">):</span>
                                    <span class="n">pd</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pd</span><span class="p">)</span>
                            <span class="k">except</span><span class="p">:</span>
                                <span class="c1"># continue</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">pd</span> <span class="ow">and</span> <span class="n">pd</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                                    <span class="k">continue</span>
                        <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pd</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_param</span> <span class="ow">and</span> <span class="n">pd</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                            <span class="c1"># Only array func has pd == &#39;&#39; case.</span>
                            <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="s2">&quot;ComboBox&quot;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fun_list</span><span class="p">:</span>
                                <span class="n">fun_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fun_list</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">fun_val</span><span class="p">)</span>
                                <span class="c1"># save state</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]))</span>
                            <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
                        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                            <span class="c1"># passing as harmless non-update</span>
                            <span class="k">pass</span>

                        <span class="bp">self</span><span class="o">.</span><span class="n">_paste_poly_help</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">check</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
                            <span class="n">is_true</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="k">elif</span> <span class="n">check</span> <span class="o">==</span> <span class="s1">&#39;False&#39;</span><span class="p">:</span>
                            <span class="n">is_true</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">is_true</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="k">if</span> <span class="n">is_true</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">is_true</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">select_param</span><span class="p">(</span><span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_paste_poly_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Helps get paste for poly function</span>

<span class="sd">        *item* is the parameter name</span>

<span class="sd">        *value* depends on which parameter is being processed, and whether it</span>
<span class="sd">        has array polydispersity.</span>

<span class="sd">        For parameters without array polydispersity:</span>

<span class="sd">            parameter =&gt; [&#39;FLOAT&#39;, &#39;&#39;]</span>
<span class="sd">            parameter.width =&gt; [&#39;FLOAT&#39;, &#39;DISTRIBUTION&#39;, &#39;&#39;]</span>
<span class="sd">            parameter.npts =&gt; [&#39;FLOAT&#39;, &#39;&#39;]</span>
<span class="sd">            parameter.nsigmas =&gt; [&#39;FLOAT&#39;, &#39;&#39;]</span>

<span class="sd">        For parameters with array polydispersity:</span>

<span class="sd">            parameter =&gt; [&#39;FLOAT&#39;, &#39;&#39;]</span>
<span class="sd">            parameter.width =&gt; [&#39;FILENAME&#39;, &#39;array&#39;, [x1, ...], [w1, ...]]</span>
<span class="sd">            parameter.npts =&gt; [&#39;FLOAT&#39;, &#39;&#39;]</span>
<span class="sd">            parameter.nsigmas =&gt; [&#39;FLOAT&#39;, &#39;&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Do nothing if not setting polydispersity</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">Name</span>
            <span class="n">param_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">selection</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">GetCurrentSelection</span><span class="p">()</span>
            <span class="n">dispersity</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">GetClientData</span><span class="p">(</span><span class="n">selection</span><span class="p">)</span>
            <span class="n">disp_model</span> <span class="o">=</span> <span class="n">dispersity</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;array&#39;</span><span class="p">:</span>
                <span class="n">pd_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">pd_weights</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pd_vals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">pd_vals</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pd_weights</span><span class="p">):</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;bad array distribution parameters for </span><span class="si">%s</span><span class="s2">&quot;</span>
                           <span class="o">%</span> <span class="n">param_name</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_disp_cb</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_array_disp_model</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                           <span class="n">disp</span><span class="o">=</span><span class="n">disp_model</span><span class="p">,</span>
                                           <span class="n">values</span><span class="o">=</span><span class="n">pd_vals</span><span class="p">,</span>
                                           <span class="n">weights</span><span class="o">=</span><span class="n">pd_weights</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_set_disp_cb</span><span class="p">(</span><span class="bp">False</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">item</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp_model</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">set_dispersion</span><span class="p">(</span><span class="n">param_name</span><span class="p">,</span> <span class="n">disp_model</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">_disp_obj_dict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp_model</span><span class="o">.</span><span class="n">type</span>
                <span class="c1"># TODO: It&#39;s not an array, why update values and weights?</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">_persistency_dict</span><span class="p">[</span><span class="n">param_name</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weights</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="k">print</span> <span class="s2">&quot;Error in BasePage._paste_poly_help: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                  <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_set_disp_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">isarray</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set cb for array disp</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">isarray</span><span class="p">:</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
            <span class="n">item</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>

<div class="viewcode-block" id="BasicPage.update_pinhole_smear"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.update_pinhole_smear">[docs]</a>    <span class="k">def</span> <span class="nf">update_pinhole_smear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Method to be called by sub-classes</span>
<span class="sd">            Moveit; This method doesn&#39;t belong here</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span> <span class="s2">&quot;BasicPage.update_pinhole_smear was called: skipping&quot;</span>
        <span class="k">return</span></div>

    <span class="k">def</span> <span class="nf">_read_category_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads the categories in from file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># # ILL mod starts here - July 2012 kieranrcampbell@gmail.com</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_model_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_enabled_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">categorization_file</span> <span class="o">=</span> <span class="n">CategoryInstaller</span><span class="o">.</span><span class="n">get_user_file</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">categorization_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_regenerate_model_dict</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_regenerate_model_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        regenerates self.by_model_dict which has each model name as the</span>
<span class="sd">        key and the list of categories belonging to that model</span>
<span class="sd">        along with the enabled mapping</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">by_model_dict</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span><span class="p">[</span><span class="n">category</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">by_model_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_enabled_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">enabled</span>

    <span class="k">def</span> <span class="nf">_populate_listbox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fills out the category list box</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">uncat_str</span> <span class="o">=</span> <span class="s1">&#39;Plugin Models&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_read_category_info</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span>
        <span class="n">cat_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">uncat_str</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cat_list</span><span class="p">:</span>
            <span class="n">cat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uncat_str</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="n">cat_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">category</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">())</span>
        <span class="c1"># self._on_change_cat(None)</span>

    <span class="k">def</span> <span class="nf">_on_change_cat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback for category change action</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">GetStringSelection</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_box</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;Plugin Models&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_list_box</span><span class="p">[</span><span class="n">category</span><span class="p">]:</span>
                <span class="n">str_m</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_box</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">str_m</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master_category_dict</span><span class="p">[</span><span class="n">category</span><span class="p">],</span>
                                           <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">name</span><span class="p">:</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="k">if</span><span class="p">(</span><span class="n">enabled</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model_box</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fill_model_sizer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sizer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fill sizer containing model info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This should only be called once per fit tab</span>
        <span class="c1"># print &quot;==== Entering _fill_model_sizer&quot;</span>
        <span class="c1"># Add model function Details button in fitpanel.</span>
        <span class="c1"># The following 3 lines are for Mac. Let JHC know before modifying...</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Model&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mbox_description</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">))</span>
        <span class="n">boxsizer1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticBoxSizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mbox_description</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">sizer_cat</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mbox_description</span><span class="o">.</span><span class="n">SetForegroundColour</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span>
        <span class="n">wx_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ids</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_func</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx_id</span><span class="p">,</span> <span class="s1">&#39;Help&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">23</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_func</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_function_help_clicked</span><span class="p">,</span>
                             <span class="nb">id</span><span class="o">=</span><span class="n">wx_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_func</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Full Model Function Help&quot;</span><span class="p">)</span>
        <span class="n">wx_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ids</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_help</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx_id</span><span class="p">,</span> <span class="s1">&#39;Description&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">23</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_help</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_model_help_clicked</span><span class="p">,</span>
                             <span class="nb">id</span><span class="o">=</span><span class="n">wx_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_help</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s2">&quot;Short Model Function Description&quot;</span><span class="p">)</span>
        <span class="n">wx_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ids</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_view</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx_id</span><span class="p">,</span> <span class="s2">&quot;Show 2D&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">23</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_view</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onModel2D</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx_id</span><span class="p">)</span>
        <span class="n">hint</span> <span class="o">=</span> <span class="s2">&quot;toggle view of model from 1D to 2D  or 2D to 1D&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_view</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">hint</span><span class="p">)</span>

        <span class="n">cat_set_box</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s1">&#39;Category&#39;</span><span class="p">)</span>
        <span class="n">sizer_cat_box</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticBoxSizer</span><span class="p">(</span><span class="n">cat_set_box</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">sizer_cat_box</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="mi">200</span><span class="p">,</span> <span class="mi">50</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
                                       <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="o">.</span><span class="n">SetToolTip</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ToolTip</span><span class="p">(</span><span class="s2">&quot;Select a Category/Type&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_listbox</span><span class="p">()</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_combox</span><span class="p">)</span>
        <span class="c1"># self.shape_rbutton = wx.RadioButton(self, wx.ID_ANY, &#39;Shapes&#39;,</span>
        <span class="c1">#                                     style=wx.RB_GROUP)</span>
        <span class="c1"># self.shape_indep_rbutton = wx.RadioButton(self, wx.ID_ANY,</span>
        <span class="c1">#                                          &quot;Shape-Independent&quot;)</span>
        <span class="c1"># self.struct_rbutton = wx.RadioButton(self, wx.ID_ANY,</span>
        <span class="c1">#                                     &quot;Structure Factor &quot;)</span>
        <span class="c1"># self.plugin_rbutton = wx.RadioButton(self, wx.ID_ANY,</span>
        <span class="c1">#                                     &quot;Uncategorized&quot;)</span>

        <span class="c1"># self.Bind(wx.EVT_RADIOBUTTON, self._show_combox,</span>
        <span class="c1">#                   id=self.shape_rbutton.GetId())</span>
        <span class="c1"># self.Bind(wx.EVT_RADIOBUTTON, self._show_combox,</span>
        <span class="c1">#                    id=self.shape_indep_rbutton.GetId())</span>
        <span class="c1"># self.Bind(wx.EVT_RADIOBUTTON, self._show_combox,</span>
        <span class="c1">#                    id=self.struct_rbutton.GetId())</span>
        <span class="c1"># self.Bind(wx.EVT_RADIOBUTTON, self._show_combox,</span>
        <span class="c1">#                    id=self.plugin_rbutton.GetId())</span>
        <span class="c1"># MAC needs SetValue</span>

        <span class="n">show_cat_button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Modify&quot;</span><span class="p">)</span>
        <span class="n">cat_tip</span> <span class="o">=</span> <span class="s2">&quot;Modify model categories </span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">cat_tip</span> <span class="o">+=</span> <span class="s2">&quot;(also accessible from the menu bar).&quot;</span>
        <span class="n">show_cat_button</span><span class="o">.</span><span class="n">SetToolTip</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ToolTip</span><span class="p">(</span><span class="n">cat_tip</span><span class="p">))</span>
        <span class="n">show_cat_button</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_modify_cat</span><span class="p">)</span>
        <span class="n">sizer_cat_box</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">categorybox</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">sizer_cat_box</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">sizer_cat_box</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">show_cat_button</span><span class="p">)</span>
        <span class="c1"># self.shape_rbutton.SetValue(True)</span>

        <span class="n">sizer_radiobutton</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">GridSizer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="c1"># sizer_radiobutton.Add(self.shape_rbutton)</span>
        <span class="c1"># sizer_radiobutton.Add(self.shape_indep_rbutton)</span>
        <span class="n">sizer_radiobutton</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">sizer_radiobutton</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_view</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="c1"># sizer_radiobutton.Add(self.plugin_rbutton)</span>
        <span class="c1"># sizer_radiobutton.Add(self.struct_rbutton)</span>
        <span class="c1"># sizer_radiobutton.Add((5,5))</span>
        <span class="n">sizer_radiobutton</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_help</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="c1"># sizer_radiobutton.Add((5,5))</span>
        <span class="n">sizer_radiobutton</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_func</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">sizer_cat</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sizer_cat_box</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
        <span class="n">sizer_cat</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sizer_radiobutton</span><span class="p">)</span>
        <span class="n">sizer_selection</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">mutifactor_selection</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;P(Q)*S(Q)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutifactor_text</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;No. of Shells: &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutifactor_text1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_sld_button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s2">&quot;Show SLD Profile&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_sld_button</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_show_sld</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">SetToolTip</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ToolTip</span><span class="p">(</span><span class="s2">&quot;Select a Model&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_combox</span><span class="p">()</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_select_model</span><span class="p">)</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_select_model</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_select_model</span><span class="p">)</span>
        <span class="c1"># check model type to show sizer</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="s2">&quot;_set_model_sizer_selection: disabled.&quot;</span>
            <span class="c1"># self._set_model_sizer_selection(self.model)</span>

        <span class="n">sizer_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text1</span><span class="p">)</span>
        <span class="n">sizer_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">sizer_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">formfactorbox</span><span class="p">)</span>
        <span class="n">sizer_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">sizer_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text2</span><span class="p">)</span>
        <span class="n">sizer_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">sizer_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">structurebox</span><span class="p">)</span>

        <span class="n">mutifactor_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">13</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">mutifactor_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mutifactor_text</span><span class="p">)</span>
        <span class="n">mutifactor_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="p">)</span>
        <span class="n">mutifactor_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">mutifactor_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mutifactor_text1</span><span class="p">)</span>
        <span class="n">mutifactor_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">mutifactor_selection</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_sld_button</span><span class="p">)</span>

        <span class="n">boxsizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sizer_cat</span><span class="p">)</span>
        <span class="n">boxsizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">boxsizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sizer_selection</span><span class="p">)</span>
        <span class="n">boxsizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">boxsizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">mutifactor_selection</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_multfactor_combobox</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">multifactorbox</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_sld_button</span><span class="o">.</span><span class="n">Hide</span><span class="p">()</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">boxsizer1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>

<div class="viewcode-block" id="BasicPage.on_smear_helper"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.on_smear_helper">[docs]</a>    <span class="k">def</span> <span class="nf">on_smear_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Help for onSmear if implemented</span>

<span class="sd">        :param update: force or not to update</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
<div class="viewcode-block" id="BasicPage.reset_page"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.reset_page">[docs]</a>    <span class="k">def</span> <span class="nf">reset_page</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset the state  if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
<div class="viewcode-block" id="BasicPage.onSmear"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.onSmear">[docs]</a>    <span class="k">def</span> <span class="nf">onSmear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a smear object if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
<div class="viewcode-block" id="BasicPage.onPinholeSmear"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.onPinholeSmear">[docs]</a>    <span class="k">def</span> <span class="nf">onPinholeSmear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a custom pinhole smear object if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
<div class="viewcode-block" id="BasicPage.onSlitSmear"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.onSlitSmear">[docs]</a>    <span class="k">def</span> <span class="nf">onSlitSmear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a custom slit smear object if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
<div class="viewcode-block" id="BasicPage.update_slit_smear"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.update_slit_smear">[docs]</a>    <span class="k">def</span> <span class="nf">update_slit_smear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        called by kill_focus on pinhole TextCntrl</span>
<span class="sd">        to update the changes if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
<div class="viewcode-block" id="BasicPage.select_param"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.select_param">[docs]</a>    <span class="k">def</span> <span class="nf">select_param</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select TextCtrl  checked if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
<div class="viewcode-block" id="BasicPage.set_data"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.set_data">[docs]</a>    <span class="k">def</span> <span class="nf">set_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets data if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
    <span class="k">def</span> <span class="nf">_is_2D</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if data_name is Data2D if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_on_select_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        call back for model selection if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span>
<div class="viewcode-block" id="BasicPage.get_weight_flag"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_weight_flag">[docs]</a>    <span class="k">def</span> <span class="nf">get_weight_flag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get flag corresponding to a given weighting dI data if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
    <span class="k">def</span> <span class="nf">_set_sizer_dispersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        draw sizer for dispersity if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span>
<div class="viewcode-block" id="BasicPage.get_all_checked_params"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.get_all_checked_params">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_checked_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Found all parameters current check and add them to list of parameters</span>
<span class="sd">        to fit if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
<div class="viewcode-block" id="BasicPage.show_npts2fit"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.BasicPage.show_npts2fit">[docs]</a>    <span class="k">def</span> <span class="nf">show_npts2fit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        setValue Npts for fitting if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span></div>
    <span class="k">def</span> <span class="nf">_onModel2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        toggle view of model from 1D to 2D  or 2D from 1D if implemented</span>
<span class="sd">        &quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="ModelTextCtrl"><a class="viewcode-back" href="../../../../../dev/api/sas.sasgui.perspectives.fitting.html#sas.sasgui.perspectives.fitting.basepage.ModelTextCtrl">[docs]</a><span class="k">class</span> <span class="nc">ModelTextCtrl</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Text control for model and fit parameters.</span>
<span class="sd">    Binds the appropriate events for user interactions.</span>
<span class="sd">    Default callback methods can be overwritten on initialization</span>

<span class="sd">    :param kill_focus_callback: callback method for EVT_KILL_FOCUS event</span>
<span class="sd">    :param set_focus_callback:  callback method for EVT_SET_FOCUS event</span>
<span class="sd">    :param mouse_up_callback:   callback method for EVT_LEFT_UP event</span>
<span class="sd">    :param text_enter_callback: callback method for EVT_TEXT_ENTER event</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Set to True when the mouse is clicked while whole string is selected</span>
    <span class="n">full_selection</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="c1"># Call back for EVT_SET_FOCUS events</span>
    <span class="n">_on_set_focus_callback</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">value</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EmptyString</span><span class="p">,</span>
                 <span class="n">pos</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DefaultPosition</span><span class="p">,</span>
                 <span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DefaultSize</span><span class="p">,</span>
                 <span class="n">style</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">validator</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DefaultValidator</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TextCtrlNameStr</span><span class="p">,</span>
                 <span class="n">kill_focus_callback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">set_focus_callback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">mouse_up_callback</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">text_enter_callback</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span>
                             <span class="n">size</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">validator</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="c1"># Bind appropriate events</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_on_set_focus_callback</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">onSetFocus</span> \
            <span class="k">if</span> <span class="n">set_focus_callback</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">set_focus_callback</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SET_FOCUS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_set_focus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_silent_kill_focus</span>
        <span class="k">if</span> <span class="n">kill_focus_callback</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">kill_focus_callback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">_onparamEnter</span>
        <span class="k">if</span> <span class="n">text_enter_callback</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">text_enter_callback</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ON_MAC</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_LEFT_UP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_highlight_text</span>
            <span class="k">if</span> <span class="n">mouse_up_callback</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">mouse_up_callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_on_set_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Catch when the text control is set in focus to highlight the whole</span>
<span class="sd">        text if necessary</span>

<span class="sd">        :param event: mouse event</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_selection</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_set_focus_callback</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_highlight_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Highlight text of a TextCtrl only of no text has be selected</span>

<span class="sd">        :param event: mouse event</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Make sure the mouse event is available to other listeners</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="n">control</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_selection</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">full_selection</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="c1"># Check that we have a TextCtrl</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">control</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">):</span>
                <span class="c1"># Check whether text has been selected,</span>
                <span class="c1"># if not, select the whole string</span>
                <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="o">=</span> <span class="n">control</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">:</span>
                    <span class="n">control</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_silent_kill_focus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the state of the page</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span></div>
        <span class="c1"># pass</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">SasView 4.1.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../fitting.html" >sas.sasgui.perspectives.fitting</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2017, The SasView Project.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>