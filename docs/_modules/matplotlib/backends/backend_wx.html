
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>matplotlib.backends.backend_wx &#8212; SasView 4.1.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '4.1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SasView 4.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for matplotlib.backends.backend_wx</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="sd"> backend_wx.py</span>

<span class="sd"> A wxPython backend for matplotlib, based (very heavily) on</span>
<span class="sd"> backend_template.py and backend_gtk.py</span>

<span class="sd"> Author: Jeremy O&#39;Donoghue (jeremy@o-donoghue.com)</span>

<span class="sd"> Derived from original copyright work by John Hunter</span>
<span class="sd"> (jdhunter@ace.bsd.uchicago.edu)</span>

<span class="sd"> Copyright (C) Jeremy O&#39;Donoghue &amp; John Hunter, 2003-4</span>

<span class="sd"> License: This work is licensed under a PSF compatible license. A copy</span>
<span class="sd"> should be included with this source code.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="n">cvs_id</span> <span class="o">=</span> <span class="s1">&#39;$Id$&#39;</span>


<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">os.path</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">StringIO</span><span class="o">,</span> <span class="nn">weakref</span><span class="o">,</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>



<span class="c1"># Debugging settings here...</span>
<span class="c1"># Debug level set here. If the debug level is less than 5, information</span>
<span class="c1"># messages (progressively more info for lower value) are printed. In addition,</span>
<span class="c1"># traceback is performed, and pdb activated, for all uncaught exceptions in</span>
<span class="c1"># this case</span>
<span class="n">_DEBUG</span> <span class="o">=</span> <span class="mi">5</span>
<span class="k">if</span> <span class="n">_DEBUG</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">traceback</span><span class="o">,</span> <span class="nn">pdb</span>
<span class="n">_DEBUG_lvls</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span> <span class="p">:</span> <span class="s1">&#39;Low &#39;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">:</span> <span class="s1">&#39;Med &#39;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">:</span> <span class="s1">&#39;High&#39;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">:</span> <span class="s1">&#39;Error&#39;</span> <span class="p">}</span>

<span class="n">missingwx</span> <span class="o">=</span> <span class="s2">&quot;Matplotlib backend_wx and backend_wxagg require wxPython &gt;=2.8&quot;</span>
<span class="n">missingwxversion</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;Matplotlib backend_wx and backend_wxagg &quot;</span>
                    <span class="s2">&quot;require wxversion, which was not found.&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="p">,</span> <span class="s1">&#39;frozen&#39;</span><span class="p">):</span> <span class="c1"># i.e., not py2exe</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">wxversion</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">missingwxversion</span><span class="p">)</span>

    <span class="c1"># Some early versions of wxversion lack AlreadyImportedError.</span>
    <span class="c1"># It was added around 2.8.4?</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">_wx_ensure_failed</span> <span class="o">=</span> <span class="n">wxversion</span><span class="o">.</span><span class="n">AlreadyImportedError</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="n">_wx_ensure_failed</span> <span class="o">=</span> <span class="n">wxversion</span><span class="o">.</span><span class="n">VersionError</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">wxversion</span><span class="o">.</span><span class="n">ensureMinimal</span><span class="p">(</span><span class="s1">&#39;2.8&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">_wx_ensure_failed</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="c1"># We don&#39;t really want to pass in case of VersionError, but when</span>
    <span class="c1"># AlreadyImportedError is not available, we have to.</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">wx</span>
    <span class="n">backend_version</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">VERSION_STRING</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">missingwx</span><span class="p">)</span>

<span class="c1"># Extra version check in case wxversion lacks AlreadyImportedError;</span>
<span class="c1"># then VersionError might have been raised and ignored when</span>
<span class="c1"># there really *is* a problem with the version.</span>
<span class="n">major</span><span class="p">,</span> <span class="n">minor</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">backend_version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]]</span>
<span class="k">if</span> <span class="n">major</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span><span class="n">major</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">minor</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s2">&quot; wxPython version </span><span class="si">%s</span><span class="s2"> was imported.&quot;</span> <span class="o">%</span> <span class="n">backend_version</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="n">missingwx</span><span class="p">)</span>


<span class="c1">#!!! this is the call that is causing the exception swallowing !!!</span>
<span class="c1">#wx.InitAllImageHandlers()</span>

<span class="k">def</span> <span class="nf">DEBUG_MSG</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="n">lvl</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">lvl</span> <span class="o">&gt;=</span> <span class="n">_DEBUG</span><span class="p">:</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="c1"># Jeremy, often times the commented line won&#39;t print but the</span>
        <span class="c1"># one below does.  I think WX is redefining stderr, damned</span>
        <span class="c1"># beast</span>
        <span class="c1">#print &gt;&gt;sys.stderr, &quot;%s- %s in %s&quot; % (_DEBUG_lvls[lvl], string, cls)</span>
        <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">- </span><span class="si">%s</span><span class="s2"> in </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">_DEBUG_lvls</span><span class="p">[</span><span class="n">lvl</span><span class="p">],</span> <span class="n">string</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">debug_on_error</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Code due to Thomas Heller - published in Python Cookbook (O&#39;Reilley)&quot;&quot;&quot;</span>
    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span>
    <span class="nb">print</span>
    <span class="n">pdb</span><span class="o">.</span><span class="n">pm</span><span class="p">()</span>  <span class="c1"># jdh uncomment</span>

<span class="k">class</span> <span class="nc">fake_stderr</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Wx does strange things with stderr, as it makes the assumption that there</span>
<span class="sd">    is probably no console. This redirects stderr to the console, since we know</span>
<span class="sd">    that there is one!&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="nb">print</span> <span class="s2">&quot;Stderr: </span><span class="si">%s</span><span class="se">\n\r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">msg</span>

<span class="c1">#if _DEBUG &lt; 5:</span>
<span class="c1">#    sys.excepthook = debug_on_error</span>
<span class="c1">#    WxLogger =wx.LogStderr()</span>
<span class="c1">#    sys.stderr = fake_stderr</span>

<span class="c1"># Event binding code changed after version 2.5</span>
<span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">VERSION_STRING</span> <span class="o">&gt;=</span> <span class="s1">&#39;2.5&#39;</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">action</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">actor</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">action</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">bind</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span><span class="n">event</span><span class="p">,</span><span class="n">action</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">event</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">event</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span><span class="n">action</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">verbose</span>
<span class="kn">from</span> <span class="nn">matplotlib.backend_bases</span> <span class="k">import</span> <span class="n">RendererBase</span><span class="p">,</span> <span class="n">GraphicsContextBase</span><span class="p">,</span>\
     <span class="n">FigureCanvasBase</span><span class="p">,</span> <span class="n">FigureManagerBase</span><span class="p">,</span> <span class="n">NavigationToolbar2</span><span class="p">,</span> \
     <span class="n">cursors</span><span class="p">,</span> <span class="n">TimerBase</span>
<span class="kn">from</span> <span class="nn">matplotlib.backend_bases</span> <span class="k">import</span> <span class="n">ShowBase</span>

<span class="kn">from</span> <span class="nn">matplotlib._pylab_helpers</span> <span class="k">import</span> <span class="n">Gcf</span>
<span class="kn">from</span> <span class="nn">matplotlib.artist</span> <span class="k">import</span> <span class="n">Artist</span>
<span class="kn">from</span> <span class="nn">matplotlib.cbook</span> <span class="k">import</span> <span class="n">exception_to_str</span><span class="p">,</span> <span class="n">is_string_like</span><span class="p">,</span> <span class="n">is_writable_file_like</span>
<span class="kn">from</span> <span class="nn">matplotlib.figure</span> <span class="k">import</span> <span class="n">Figure</span>
<span class="kn">from</span> <span class="nn">matplotlib.path</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">matplotlib.text</span> <span class="k">import</span> <span class="n">_process_text_args</span><span class="p">,</span> <span class="n">Text</span>
<span class="kn">from</span> <span class="nn">matplotlib.transforms</span> <span class="k">import</span> <span class="n">Affine2D</span>
<span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="k">import</span> <span class="n">SubplotTool</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="k">import</span> <span class="n">rcParams</span>

<span class="c1"># the True dots per inch on the screen; should be display dependent</span>
<span class="c1"># see http://groups.google.com/groups?q=screen+dpi+x11&amp;hl=en&amp;lr=&amp;ie=UTF-8&amp;oe=UTF-8&amp;safe=off&amp;selm=7077.26e81ad5%40swift.cs.tcd.ie&amp;rnum=5 for some info about screen dpi</span>
<span class="n">PIXELS_PER_INCH</span> <span class="o">=</span> <span class="mi">75</span>

<span class="c1"># Delay time for idle checks</span>
<span class="n">IDLE_DELAY</span> <span class="o">=</span> <span class="mi">5</span>

<span class="k">def</span> <span class="nf">error_msg_wx</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Signal an error condition -- in a GUI, popup a error dialog</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dialog</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="n">parent</span>  <span class="o">=</span> <span class="n">parent</span><span class="p">,</span>
                             <span class="n">message</span> <span class="o">=</span> <span class="n">msg</span><span class="p">,</span>
                             <span class="n">caption</span> <span class="o">=</span> <span class="s1">&#39;Matplotlib backend_wx error&#39;</span><span class="p">,</span>
                             <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CENTRE</span><span class="p">)</span>
    <span class="n">dialog</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
    <span class="n">dialog</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span> <span class="nf">raise_msg_to_str</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;msg is a return arg from a raise.  Join with new lines&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_string_like</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">msg</span>


<span class="k">class</span> <span class="nc">TimerWx</span><span class="p">(</span><span class="n">TimerBase</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Subclass of :class:`backend_bases.TimerBase` that uses WxTimer events.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    * interval: The time between timer events in milliseconds. Default</span>
<span class="sd">        is 1000 ms.</span>
<span class="sd">    * single_shot: Boolean flag indicating whether this timer should</span>
<span class="sd">        operate as single shot (run once and then stop). Defaults to False.</span>
<span class="sd">    * callbacks: Stores list of (func, args) tuples that will be called</span>
<span class="sd">        upon timer events. This list can be manipulated directly, or the</span>
<span class="sd">        functions add_callback and remove_callback can be used.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">TimerBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Create a new timer and connect the timer event to our handler.</span>
        <span class="c1"># For WX, the events have to use a widget for binding.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TIMER</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_timer</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span><span class="p">)</span>

     <span class="c1"># Unbinding causes Wx to stop for some reason. Disabling for now.</span>
<span class="c1">#    def __del__(self):</span>
<span class="c1">#        import wx</span>
<span class="c1">#        TimerBase.__del__(self)</span>
<span class="c1">#        self.parent.Bind(wx.EVT_TIMER, None, self._timer)</span>

    <span class="k">def</span> <span class="nf">_timer_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_interval</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_single</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_timer_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_timer_set_interval</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer_start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_timer_set_single_shot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_on_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">TimerBase</span><span class="o">.</span><span class="n">_on_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">RendererWx</span><span class="p">(</span><span class="n">RendererBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The renderer handles all the drawing primitives using a graphics</span>
<span class="sd">    context instance that controls the colors/styles. It acts as the</span>
<span class="sd">    &#39;renderer&#39; instance used by many classes in the hierarchy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#In wxPython, drawing is performed on a wxDC instance, which will</span>
    <span class="c1">#generally be mapped to the client aread of the window displaying</span>
    <span class="c1">#the plot. Under wxPython, the wxDC instance has a wx.Pen which</span>
    <span class="c1">#describes the colour and weight of any lines drawn, and a wxBrush</span>
    <span class="c1">#which describes the fill colour of any closed polygon.</span>


    <span class="n">fontweights</span> <span class="o">=</span> <span class="p">{</span>
        <span class="mi">100</span>          <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">,</span>
        <span class="mi">200</span>          <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">,</span>
        <span class="mi">300</span>          <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">,</span>
        <span class="mi">400</span>          <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span>
        <span class="mi">500</span>          <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span>
        <span class="mi">600</span>          <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span>
        <span class="mi">700</span>          <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOLD</span><span class="p">,</span>
        <span class="mi">800</span>          <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOLD</span><span class="p">,</span>
        <span class="mi">900</span>          <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOLD</span><span class="p">,</span>
        <span class="s1">&#39;ultralight&#39;</span> <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">,</span>
        <span class="s1">&#39;light&#39;</span>      <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">,</span>
        <span class="s1">&#39;normal&#39;</span>     <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span>
        <span class="s1">&#39;medium&#39;</span>     <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span>
        <span class="s1">&#39;semibold&#39;</span>   <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span>
        <span class="s1">&#39;bold&#39;</span>       <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOLD</span><span class="p">,</span>
        <span class="s1">&#39;heavy&#39;</span>      <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOLD</span><span class="p">,</span>
        <span class="s1">&#39;ultrabold&#39;</span>  <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOLD</span><span class="p">,</span>
        <span class="s1">&#39;black&#39;</span>      <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOLD</span>
        <span class="p">}</span>
    <span class="n">fontangles</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;italic&#39;</span>  <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">ITALIC</span><span class="p">,</span>
        <span class="s1">&#39;normal&#39;</span>  <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span>
        <span class="s1">&#39;oblique&#39;</span> <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">SLANT</span> <span class="p">}</span>

    <span class="c1"># wxPython allows for portable font styles, choosing them appropriately</span>
    <span class="c1"># for the target platform. Map some standard font names to the portable</span>
    <span class="c1"># styles</span>
    <span class="c1"># QUESTION: Is it be wise to agree standard fontnames across all backends?</span>
    <span class="n">fontnames</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;Sans&#39;</span>       <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">SWISS</span><span class="p">,</span>
                  <span class="s1">&#39;Roman&#39;</span>      <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">ROMAN</span><span class="p">,</span>
                  <span class="s1">&#39;Script&#39;</span>     <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">SCRIPT</span><span class="p">,</span>
                  <span class="s1">&#39;Decorative&#39;</span> <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">DECORATIVE</span><span class="p">,</span>
                  <span class="s1">&#39;Modern&#39;</span>     <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">MODERN</span><span class="p">,</span>
                  <span class="s1">&#39;Courier&#39;</span>    <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">MODERN</span><span class="p">,</span>
                  <span class="s1">&#39;courier&#39;</span>    <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">MODERN</span> <span class="p">}</span>


    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="n">dpi</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise a wxWindows renderer instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;__init__()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">VERSION_STRING</span> <span class="o">&lt;</span> <span class="s2">&quot;2.8&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;matplotlib no longer supports wxPython &lt; 2.8 for the Wx backend.</span><span class="se">\n</span><span class="s2">You may, however, use the WxAgg backend.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>  <span class="o">=</span> <span class="n">bitmap</span><span class="o">.</span><span class="n">GetWidth</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">bitmap</span><span class="o">.</span><span class="n">GetHeight</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span> <span class="o">=</span> <span class="n">bitmap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">dpi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gc</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">flipy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">offset_text_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_text_width_height_descent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">ismath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        get the width and height in display coords of the string s</span>
<span class="sd">        with FontPropertry prop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#return 1, 1</span>
        <span class="k">if</span> <span class="n">ismath</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strip_math</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_gc</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gc</span>
        <span class="n">gfx_ctx</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">gfx_ctx</span>
        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wx_font</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
        <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BLACK</span><span class="p">)</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">descent</span><span class="p">,</span> <span class="n">leading</span> <span class="o">=</span> <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">GetFullTextExtent</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">descent</span>

    <span class="k">def</span> <span class="nf">get_canvas_width_height</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;return the canvas width and height in display coords&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span>

    <span class="k">def</span> <span class="nf">handle_clip_rectangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">):</span>
        <span class="n">new_bounds</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_clip_rectangle</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">new_bounds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_bounds</span> <span class="o">=</span> <span class="n">new_bounds</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">gfx_ctx</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">gfx_ctx</span>
        <span class="k">if</span> <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">_lastcliprect</span> <span class="o">!=</span> <span class="n">new_bounds</span><span class="p">:</span>
            <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">_lastcliprect</span> <span class="o">=</span> <span class="n">new_bounds</span>
            <span class="k">if</span> <span class="n">new_bounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">ResetClip</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">Clip</span><span class="p">(</span><span class="n">new_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">new_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">new_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                             <span class="n">new_bounds</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">new_bounds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">convert_path</span><span class="p">(</span><span class="n">gfx_ctx</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">transform</span><span class="p">):</span>
        <span class="n">wxpath</span> <span class="o">=</span> <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">CreatePath</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">points</span><span class="p">,</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">path</span><span class="o">.</span><span class="n">iter_segments</span><span class="p">(</span><span class="n">transform</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="n">Path</span><span class="o">.</span><span class="n">MOVETO</span><span class="p">:</span>
                <span class="n">wxpath</span><span class="o">.</span><span class="n">MoveToPoint</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="n">Path</span><span class="o">.</span><span class="n">LINETO</span><span class="p">:</span>
                <span class="n">wxpath</span><span class="o">.</span><span class="n">AddLineToPoint</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE3</span><span class="p">:</span>
                <span class="n">wxpath</span><span class="o">.</span><span class="n">AddQuadCurveToPoint</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="n">Path</span><span class="o">.</span><span class="n">CURVE4</span><span class="p">:</span>
                <span class="n">wxpath</span><span class="o">.</span><span class="n">AddCurveToPoint</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">code</span> <span class="o">==</span> <span class="n">Path</span><span class="o">.</span><span class="n">CLOSEPOLY</span><span class="p">:</span>
                <span class="n">wxpath</span><span class="o">.</span><span class="n">CloseSubpath</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">wxpath</span>

    <span class="k">def</span> <span class="nf">draw_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">rgbFace</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_clip_rectangle</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>
        <span class="n">gfx_ctx</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">gfx_ctx</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">transform</span> <span class="o">+</span> <span class="n">Affine2D</span><span class="p">()</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="n">wxpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_path</span><span class="p">(</span><span class="n">gfx_ctx</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">transform</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rgbFace</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">SetBrush</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Brush</span><span class="p">(</span><span class="n">gc</span><span class="o">.</span><span class="n">get_wxcolour</span><span class="p">(</span><span class="n">rgbFace</span><span class="p">)))</span>
            <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">DrawPath</span><span class="p">(</span><span class="n">wxpath</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">StrokePath</span><span class="p">(</span><span class="n">wxpath</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">unselect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">draw_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">im</span><span class="p">):</span>
        <span class="n">bbox</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_clip_rectangle</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bbox</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">l</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span><span class="o">=</span><span class="mi">0</span>
            <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">w</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span>
            <span class="n">h</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">image_str</span> <span class="o">=</span> <span class="n">im</span><span class="o">.</span><span class="n">as_rgba_str</span><span class="p">()</span>
        <span class="n">image_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">image_str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
        <span class="n">image_array</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="mi">4</span>
        <span class="n">bitmap</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BitmapFromBufferRGBA</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span><span class="n">rows</span><span class="p">,</span><span class="n">image_array</span><span class="p">)</span>
        <span class="n">gc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_gc</span><span class="p">()</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">gfx_ctx</span><span class="o">.</span><span class="n">DrawBitmap</span><span class="p">(</span><span class="n">bitmap</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="o">-</span><span class="n">b</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="o">-</span><span class="n">h</span><span class="p">))</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">unselect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">draw_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gc</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">angle</span><span class="p">,</span> <span class="n">ismath</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render the matplotlib.text.Text instance</span>
<span class="sd">        None)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ismath</span><span class="p">:</span> <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strip_math</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;draw_text()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_clip_rectangle</span><span class="p">(</span><span class="n">gc</span><span class="p">)</span>
        <span class="n">gfx_ctx</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">gfx_ctx</span>

        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_wx_font</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">get_wxcolour</span><span class="p">(</span><span class="n">gc</span><span class="o">.</span><span class="n">get_rgb</span><span class="p">())</span>
        <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span>

        <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_text_width_height_descent</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">,</span> <span class="n">ismath</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">h</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">angle</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">DrawText</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rads</span> <span class="o">=</span> <span class="n">angle</span> <span class="o">/</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">xo</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rads</span><span class="p">)</span>
            <span class="n">yo</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rads</span><span class="p">)</span>
            <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">DrawRotatedText</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">xo</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">yo</span><span class="p">,</span> <span class="n">rads</span><span class="p">)</span>

        <span class="n">gc</span><span class="o">.</span><span class="n">unselect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">new_gc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return an instance of a GraphicsContextWx, and sets the current gc copy</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s1">&#39;new_gc()&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gc</span> <span class="o">=</span> <span class="n">GraphicsContextWx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gc</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gc</span><span class="o">.</span><span class="n">unselect</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gc</span>

    <span class="k">def</span> <span class="nf">get_gc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch the locally cached gc.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This is a dirty hack to allow anything with access to a renderer to</span>
        <span class="c1"># access the current graphics context</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">gc</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;gc must be defined&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gc</span>


    <span class="k">def</span> <span class="nf">get_wx_font</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">prop</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return a wx font.  Cache instances in a font dictionary for</span>
<span class="sd">        efficiency</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;get_wx_font()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>


        <span class="n">key</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
        <span class="n">fontprop</span> <span class="o">=</span> <span class="n">prop</span>
        <span class="n">fontname</span> <span class="o">=</span> <span class="n">fontprop</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>

        <span class="n">font</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontd</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">font</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">font</span>

        <span class="c1"># Allow use of platform independent and dependent font names</span>
        <span class="n">wxFontname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fontnames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">fontname</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ROMAN</span><span class="p">)</span>
        <span class="n">wxFacename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="c1"># Empty =&gt; wxPython chooses based on wx_fontname</span>

        <span class="c1"># Font colour is determined by the active wx.Pen</span>
        <span class="c1"># TODO: It may be wise to cache font information</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points_to_pixels</span><span class="p">(</span><span class="n">fontprop</span><span class="o">.</span><span class="n">get_size_in_points</span><span class="p">())</span>


        <span class="n">font</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="o">+</span><span class="mf">0.5</span><span class="p">),</span>             <span class="c1"># Size</span>
                      <span class="n">wxFontname</span><span class="p">,</span>                <span class="c1"># &#39;Generic&#39; name</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">fontangles</span><span class="p">[</span><span class="n">fontprop</span><span class="o">.</span><span class="n">get_style</span><span class="p">()],</span>   <span class="c1"># Angle</span>
                      <span class="bp">self</span><span class="o">.</span><span class="n">fontweights</span><span class="p">[</span><span class="n">fontprop</span><span class="o">.</span><span class="n">get_weight</span><span class="p">()],</span> <span class="c1"># Weight</span>
                      <span class="kc">False</span><span class="p">,</span>                     <span class="c1"># Underline</span>
                      <span class="n">wxFacename</span><span class="p">)</span>                <span class="c1"># Platform font name</span>

        <span class="c1"># cache the font and gc and return it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">font</span>

        <span class="k">return</span> <span class="n">font</span>


    <span class="k">def</span> <span class="nf">points_to_pixels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        convert point measures to pixes using dpi and the pixels per</span>
<span class="sd">        inch of the display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">points</span><span class="o">*</span><span class="p">(</span><span class="n">PIXELS_PER_INCH</span><span class="o">/</span><span class="mf">72.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">dpi</span><span class="o">/</span><span class="mf">72.0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">GraphicsContextWx</span><span class="p">(</span><span class="n">GraphicsContextBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The graphics context provides the color, line styles, etc...</span>

<span class="sd">    This class stores a reference to a wxMemoryDC, and a</span>
<span class="sd">    wxGraphicsContext that draws to it.  Creating a wxGraphicsContext</span>
<span class="sd">    seems to be fairly heavy, so these objects are cached based on the</span>
<span class="sd">    bitmap object that is passed in.</span>

<span class="sd">    The base GraphicsContext stores colors as a RGB tuple on the unit</span>
<span class="sd">    interval, eg, (0.5, 0.0, 1.0).  wxPython uses an int interval, but</span>
<span class="sd">    since wxPython colour management is rather simple, I have not chosen</span>
<span class="sd">    to implement a separate colour manager class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_capd</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;butt&#39;</span><span class="p">:</span>       <span class="n">wx</span><span class="o">.</span><span class="n">CAP_BUTT</span><span class="p">,</span>
              <span class="s1">&#39;projecting&#39;</span><span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">CAP_PROJECTING</span><span class="p">,</span>
              <span class="s1">&#39;round&#39;</span><span class="p">:</span>      <span class="n">wx</span><span class="o">.</span><span class="n">CAP_ROUND</span> <span class="p">}</span>

    <span class="n">_joind</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;bevel&#39;</span><span class="p">:</span>     <span class="n">wx</span><span class="o">.</span><span class="n">JOIN_BEVEL</span><span class="p">,</span>
               <span class="s1">&#39;miter&#39;</span><span class="p">:</span>     <span class="n">wx</span><span class="o">.</span><span class="n">JOIN_MITER</span><span class="p">,</span>
               <span class="s1">&#39;round&#39;</span><span class="p">:</span>     <span class="n">wx</span><span class="o">.</span><span class="n">JOIN_ROUND</span> <span class="p">}</span>

    <span class="n">_dashd_wx</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;solid&#39;</span><span class="p">:</span>     <span class="n">wx</span><span class="o">.</span><span class="n">SOLID</span><span class="p">,</span>
                  <span class="s1">&#39;dashed&#39;</span><span class="p">:</span>    <span class="n">wx</span><span class="o">.</span><span class="n">SHORT_DASH</span><span class="p">,</span>
                  <span class="s1">&#39;dashdot&#39;</span><span class="p">:</span>   <span class="n">wx</span><span class="o">.</span><span class="n">DOT_DASH</span><span class="p">,</span>
                  <span class="s1">&#39;dotted&#39;</span><span class="p">:</span>    <span class="n">wx</span><span class="o">.</span><span class="n">DOT</span> <span class="p">}</span>
    <span class="n">_cache</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakKeyDictionary</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
        <span class="n">GraphicsContextBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1">#assert self.Ok(), &quot;wxMemoryDC not OK to use&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;__init__()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">dc</span><span class="p">,</span> <span class="n">gfx_ctx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">bitmap</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">dc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dc</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MemoryDC</span><span class="p">()</span>
            <span class="n">dc</span><span class="o">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">bitmap</span><span class="p">)</span>
            <span class="n">gfx_ctx</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">GraphicsContext</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">dc</span><span class="p">)</span>
            <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">_lastcliprect</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">[</span><span class="n">bitmap</span><span class="p">]</span> <span class="o">=</span> <span class="n">dc</span><span class="p">,</span> <span class="n">gfx_ctx</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span> <span class="o">=</span> <span class="n">bitmap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dc</span> <span class="o">=</span> <span class="n">dc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gfx_ctx</span> <span class="o">=</span> <span class="n">gfx_ctx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pen</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="s1">&#39;BLACK&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">SOLID</span><span class="p">)</span>
        <span class="n">gfx_ctx</span><span class="o">.</span><span class="n">SetPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SOLID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renderer</span> <span class="o">=</span> <span class="n">renderer</span>

    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select the current bitmap into this wxDC instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">==</span><span class="s1">&#39;win32&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IsSelected</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">unselect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select a Null bitmasp into this wxDC instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">==</span><span class="s1">&#39;win32&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dc</span><span class="o">.</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">NullBitmap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IsSelected</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">set_foreground</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fg</span><span class="p">,</span> <span class="n">isRGB</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the foreground color.  fg can be a matlab format string, a</span>
<span class="sd">        html hex color string, an rgb unit tuple, or a float between 0</span>
<span class="sd">        and 1.  In the latter case, grayscale is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Implementation note: wxPython has a separate concept of pen and</span>
        <span class="c1"># brush - the brush fills any outline trace left by the pen.</span>
        <span class="c1"># Here we set both to the same colour - if a figure is not to be</span>
        <span class="c1"># filled, the renderer will set the brush to be transparent</span>
        <span class="c1"># Same goes for text foreground...</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;set_foreground()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
        <span class="n">GraphicsContextBase</span><span class="o">.</span><span class="n">set_foreground</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fg</span><span class="p">,</span> <span class="n">isRGB</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pen</span><span class="o">.</span><span class="n">SetColour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_wxcolour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_rgb</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gfx_ctx</span><span class="o">.</span><span class="n">SetPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unselect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_graylevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frac</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the foreground color.  fg can be a matlab format string, a</span>
<span class="sd">        html hex color string, an rgb unit tuple, or a float between 0</span>
<span class="sd">        and 1.  In the latter case, grayscale is used.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;set_graylevel()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
        <span class="n">GraphicsContextBase</span><span class="o">.</span><span class="n">set_graylevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frac</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pen</span><span class="o">.</span><span class="n">SetColour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_wxcolour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_rgb</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gfx_ctx</span><span class="o">.</span><span class="n">SetPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unselect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_linewidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the line width.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;set_linewidth()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">w</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">w</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">GraphicsContextBase</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
        <span class="n">lw</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renderer</span><span class="o">.</span><span class="n">points_to_pixels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_linewidth</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">lw</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pen</span><span class="o">.</span><span class="n">SetWidth</span><span class="p">(</span><span class="n">lw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gfx_ctx</span><span class="o">.</span><span class="n">SetPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unselect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_capstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the capstyle as a string in (&#39;butt&#39;, &#39;round&#39;, &#39;projecting&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;set_capstyle()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
        <span class="n">GraphicsContextBase</span><span class="o">.</span><span class="n">set_capstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pen</span><span class="o">.</span><span class="n">SetCap</span><span class="p">(</span><span class="n">GraphicsContextWx</span><span class="o">.</span><span class="n">_capd</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_capstyle</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gfx_ctx</span><span class="o">.</span><span class="n">SetPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unselect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_joinstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">js</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the join style to be one of (&#39;miter&#39;, &#39;round&#39;, &#39;bevel&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;set_joinstyle()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
        <span class="n">GraphicsContextBase</span><span class="o">.</span><span class="n">set_joinstyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">js</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pen</span><span class="o">.</span><span class="n">SetJoin</span><span class="p">(</span><span class="n">GraphicsContextWx</span><span class="o">.</span><span class="n">_joind</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_joinstyle</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gfx_ctx</span><span class="o">.</span><span class="n">SetPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unselect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_linestyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the line style to be one of</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;set_linestyle()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">select</span><span class="p">()</span>
        <span class="n">GraphicsContextBase</span><span class="o">.</span><span class="n">set_linestyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ls</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="n">GraphicsContextWx</span><span class="o">.</span><span class="n">_dashd_wx</span><span class="p">[</span><span class="n">ls</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_style</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">LONG_DASH</span><span class="c1"># Style not used elsewhere...</span>

        <span class="c1"># On MS Windows platform, only line width of 1 allowed for dash lines</span>
        <span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">Platform</span> <span class="o">==</span> <span class="s1">&#39;__WXMSW__&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pen</span><span class="o">.</span><span class="n">SetStyle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_style</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gfx_ctx</span><span class="o">.</span><span class="n">SetPen</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pen</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unselect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_wxcolour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;return a wx.Colour from RGB format&quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;get_wx_color()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">color</span>
            <span class="n">r</span> <span class="o">*=</span> <span class="mi">255</span>
            <span class="n">g</span> <span class="o">*=</span> <span class="mi">255</span>
            <span class="n">b</span> <span class="o">*=</span> <span class="mi">255</span>
            <span class="k">return</span> <span class="n">wx</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="n">red</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">green</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="n">blue</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">color</span>
            <span class="n">r</span> <span class="o">*=</span> <span class="mi">255</span>
            <span class="n">g</span> <span class="o">*=</span> <span class="mi">255</span>
            <span class="n">b</span> <span class="o">*=</span> <span class="mi">255</span>
            <span class="n">a</span> <span class="o">*=</span> <span class="mi">255</span>
            <span class="k">return</span> <span class="n">wx</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="n">red</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">green</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="n">blue</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">FigureCanvasWx</span><span class="p">(</span><span class="n">FigureCanvasBase</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The FigureCanvas contains the figure and does event handling.</span>

<span class="sd">    In the wxPython backend, it is derived from wxPanel, and (usually) lives</span>
<span class="sd">    inside a frame instantiated by a FigureManagerWx. The parent window probably</span>
<span class="sd">    implements a wx.Sizer to control the displayed control size - but we give a</span>
<span class="sd">    hint as to our preferred minimum size.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">keyvald</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_CONTROL</span>         <span class="p">:</span> <span class="s1">&#39;control&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_SHIFT</span>           <span class="p">:</span> <span class="s1">&#39;shift&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_ALT</span>             <span class="p">:</span> <span class="s1">&#39;alt&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_LEFT</span>            <span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_UP</span>              <span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_RIGHT</span>           <span class="p">:</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_DOWN</span>            <span class="p">:</span> <span class="s1">&#39;down&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_ESCAPE</span>          <span class="p">:</span> <span class="s1">&#39;escape&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_F1</span>              <span class="p">:</span> <span class="s1">&#39;f1&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_F2</span>              <span class="p">:</span> <span class="s1">&#39;f2&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_F3</span>              <span class="p">:</span> <span class="s1">&#39;f3&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_F4</span>              <span class="p">:</span> <span class="s1">&#39;f4&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_F5</span>              <span class="p">:</span> <span class="s1">&#39;f5&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_F6</span>              <span class="p">:</span> <span class="s1">&#39;f6&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_F7</span>              <span class="p">:</span> <span class="s1">&#39;f7&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_F8</span>              <span class="p">:</span> <span class="s1">&#39;f8&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_F9</span>              <span class="p">:</span> <span class="s1">&#39;f9&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_F10</span>             <span class="p">:</span> <span class="s1">&#39;f10&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_F11</span>             <span class="p">:</span> <span class="s1">&#39;f11&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_F12</span>             <span class="p">:</span> <span class="s1">&#39;f12&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_SCROLL</span>          <span class="p">:</span> <span class="s1">&#39;scroll_lock&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_PAUSE</span>           <span class="p">:</span> <span class="s1">&#39;break&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_BACK</span>            <span class="p">:</span> <span class="s1">&#39;backspace&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_RETURN</span>          <span class="p">:</span> <span class="s1">&#39;enter&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_INSERT</span>          <span class="p">:</span> <span class="s1">&#39;insert&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_DELETE</span>          <span class="p">:</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_HOME</span>            <span class="p">:</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_END</span>             <span class="p">:</span> <span class="s1">&#39;end&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_PRIOR</span>           <span class="p">:</span> <span class="s1">&#39;pageup&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NEXT</span>            <span class="p">:</span> <span class="s1">&#39;pagedown&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_PAGEUP</span>          <span class="p">:</span> <span class="s1">&#39;pageup&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_PAGEDOWN</span>        <span class="p">:</span> <span class="s1">&#39;pagedown&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD0</span>         <span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD1</span>         <span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD2</span>         <span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD3</span>         <span class="p">:</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD4</span>         <span class="p">:</span> <span class="s1">&#39;4&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD5</span>         <span class="p">:</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD6</span>         <span class="p">:</span> <span class="s1">&#39;6&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD7</span>         <span class="p">:</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD8</span>         <span class="p">:</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD9</span>         <span class="p">:</span> <span class="s1">&#39;9&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_ADD</span>      <span class="p">:</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_SUBTRACT</span> <span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_MULTIPLY</span> <span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_DIVIDE</span>   <span class="p">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_DECIMAL</span>  <span class="p">:</span> <span class="s1">&#39;dec&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_ENTER</span>    <span class="p">:</span> <span class="s1">&#39;enter&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_UP</span>       <span class="p">:</span> <span class="s1">&#39;up&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_RIGHT</span>    <span class="p">:</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_DOWN</span>     <span class="p">:</span> <span class="s1">&#39;down&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_LEFT</span>     <span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_PRIOR</span>    <span class="p">:</span> <span class="s1">&#39;pageup&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_NEXT</span>     <span class="p">:</span> <span class="s1">&#39;pagedown&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_PAGEUP</span>   <span class="p">:</span> <span class="s1">&#39;pageup&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_PAGEDOWN</span> <span class="p">:</span> <span class="s1">&#39;pagedown&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_HOME</span>     <span class="p">:</span> <span class="s1">&#39;home&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_END</span>      <span class="p">:</span> <span class="s1">&#39;end&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_INSERT</span>   <span class="p">:</span> <span class="s1">&#39;insert&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WXK_NUMPAD_DELETE</span>   <span class="p">:</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">figure</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise a FigureWx instance.</span>

<span class="sd">        - Initialise the FigureCanvasBase and wxPanel parents.</span>
<span class="sd">        - Set event handlers for:</span>
<span class="sd">          EVT_SIZE  (Resize event)</span>
<span class="sd">          EVT_PAINT (Paint event)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">figure</span><span class="p">)</span>
        <span class="c1"># Set preferred window size hint - helps the sizer (if one is</span>
        <span class="c1"># connected)</span>
        <span class="n">l</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">do_nothing</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;could not find a setinitialsize function for backend_wx; please report your wxpython version=</span><span class="si">%s</span><span class="s1"> to the matplotlib developers list&#39;</span><span class="o">%</span><span class="n">backend_version</span><span class="p">)</span>
            <span class="k">pass</span>

        <span class="c1"># try to find the set size func across wx versions</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;SetInitialSize&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetInitialSize</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;SetBestFittingSize&#39;</span><span class="p">,</span> <span class="n">do_nothing</span><span class="p">)</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;IsShownOnScreen&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">IsShownOnScreen</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;IsVisible&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>


        <span class="c1"># Create the drawing bitmap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EmptyBitmap</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;__init__() - bitmap w:</span><span class="si">%d</span><span class="s2"> h:</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="c1"># TODO: Add support for &#39;point&#39; inspection and plot navigation.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isDrawn</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_SIZE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onSize</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_PAINT</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onPaint</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_ERASE_BACKGROUND</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onEraseBackground</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_KEY_DOWN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onKeyDown</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_KEY_UP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onKeyUp</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_RIGHT_DOWN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onRightButtonDown</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_RIGHT_DCLICK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onRightButtonDown</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_RIGHT_UP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onRightButtonUp</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MOUSEWHEEL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onMouseWheel</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_LEFT_DOWN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onLeftButtonDown</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_LEFT_DCLICK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onLeftButtonDown</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_LEFT_UP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onLeftButtonUp</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MOTION</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onMotion</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_LEAVE_WINDOW</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onLeave</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_ENTER_WINDOW</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onEnter</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_IDLE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onIdle</span><span class="p">)</span>
        <span class="c1">#Add middle button events</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MIDDLE_DOWN</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onMiddleButtonDown</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MIDDLE_DCLICK</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onMiddleButtonDown</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MIDDLE_UP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onMiddleButtonUp</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetBackgroundStyle</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">BG_STYLE_CUSTOM</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">macros</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># dict from wx id to seq of macros</span>

        <span class="c1"># printer attributes and methods deprecated, 2010/06/19</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_printerData</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_printerPageData</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printer_width</span> <span class="o">=</span> <span class="mf">5.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printer_margin</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">def</span> <span class="nf">Destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="n">Destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">Copy_to_Clipboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="s2">&quot;copy bitmap of canvas to system clipboard&quot;</span>
        <span class="n">bmp_obj</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BitmapDataObject</span><span class="p">()</span>
        <span class="n">bmp_obj</span><span class="o">.</span><span class="n">SetBitmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">TheClipboard</span><span class="o">.</span><span class="n">Open</span><span class="p">()</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">TheClipboard</span><span class="o">.</span><span class="n">SetData</span><span class="p">(</span><span class="n">bmp_obj</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">TheClipboard</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">TheClipboard</span><span class="o">.</span><span class="n">Flush</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">Printer_Init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        initialize printer settings using wx methods</span>

<span class="sd">        Deprecated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Printer* methods will be removed&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printerData</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PrintData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printerData</span><span class="o">.</span><span class="n">SetPaperId</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">PAPER_LETTER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printerData</span><span class="o">.</span><span class="n">SetPrintMode</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">PRINT_MODE_PRINTER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printerPageData</span><span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PageSetupDialogData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printerPageData</span><span class="o">.</span><span class="n">SetMarginBottomRight</span><span class="p">((</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printerPageData</span><span class="o">.</span><span class="n">SetMarginTopLeft</span><span class="p">((</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printerPageData</span><span class="o">.</span><span class="n">SetPrintData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">printerData</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">printer_width</span> <span class="o">=</span> <span class="mf">5.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printer_margin</span><span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">def</span> <span class="nf">_get_printerData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_printerData</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Printer* methods will be removed&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_printerData</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PrintData</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_printerData</span><span class="o">.</span><span class="n">SetPaperId</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">PAPER_LETTER</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_printerData</span><span class="o">.</span><span class="n">SetPrintMode</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">PRINT_MODE_PRINTER</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_printerData</span>
    <span class="n">printerData</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_printerData</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_printerPageData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_printerPageData</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Printer* methods will be removed&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_printerPageData</span><span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PageSetupDialogData</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_printerPageData</span><span class="o">.</span><span class="n">SetMarginBottomRight</span><span class="p">((</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_printerPageData</span><span class="o">.</span><span class="n">SetMarginTopLeft</span><span class="p">((</span><span class="mi">25</span><span class="p">,</span><span class="mi">25</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_printerPageData</span><span class="o">.</span><span class="n">SetPrintData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">printerData</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_printerPageData</span>
    <span class="n">printerPageData</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">_get_printerPageData</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Printer_Setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set up figure for printing.  The standard wx Printer</span>
<span class="sd">        Setup Dialog seems to die easily. Therefore, this setup</span>
<span class="sd">        simply asks for image width and margin for printing.</span>
<span class="sd">        Deprecated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">dmsg</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Width of output figure in inches.</span>
<span class="s2">The current aspect ratio will be kept.&quot;&quot;&quot;</span>

        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Printer* methods will be removed&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Page Setup for Printing&#39;</span> <span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetFont</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">SetWeight</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">SetPointSize</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="n">x_wid</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">printer_width</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">x_mrg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">printer_margin</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="n">sizerAll</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">sizerAll</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">dmsg</span><span class="p">),</span>
                    <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">sizerAll</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Figure Width&#39;</span><span class="p">),</span>
                    <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">x_wid</span><span class="p">,</span>
                    <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;in&#39;</span><span class="p">),</span>
                    <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;Margin&#39;</span><span class="p">),</span>
                    <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">x_mrg</span><span class="p">,</span>
                    <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;in&#39;</span><span class="p">),</span>
                    <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">,</span> <span class="s2">&quot; OK &quot;</span><span class="p">)</span>
        <span class="n">btn</span><span class="o">.</span><span class="n">SetDefault</span><span class="p">()</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">,</span> <span class="s2">&quot; CANCEL &quot;</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">dlg</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">sizerAll</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetAutoLayout</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sizerAll</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">dlg</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printer_width</span>  <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x_wid</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">printer_margin</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">x_mrg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">printer_width</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">printer_margin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">7.5</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printerData</span><span class="o">.</span><span class="n">SetOrientation</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">LANDSCAPE</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">printerData</span><span class="o">.</span><span class="n">SetOrientation</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">PORTRAIT</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">Printer_Setup2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        set up figure for printing.  Using the standard wx Printer</span>
<span class="sd">        Setup Dialog.</span>

<span class="sd">        Deprecated.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Printer* methods will be removed&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;printerData&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PageSetupDialogData</span><span class="p">()</span>
            <span class="n">data</span><span class="o">.</span><span class="n">SetPrintData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">printerData</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PageSetupDialogData</span><span class="p">()</span>
        <span class="n">data</span><span class="o">.</span><span class="n">SetMarginTopLeft</span><span class="p">(</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">SetMarginBottomRight</span><span class="p">(</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="p">)</span>

        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PageSetupDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPageSetupData</span><span class="p">()</span>
            <span class="n">tl</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">GetMarginTopLeft</span><span class="p">()</span>
            <span class="n">br</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">GetMarginBottomRight</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">printerData</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PrintData</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">GetPrintData</span><span class="p">())</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">Printer_Preview</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        generate Print Preview with wx Print mechanism</span>

<span class="sd">        Deprecated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Printer* methods will be removed&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="n">po1</span>  <span class="o">=</span> <span class="n">PrintoutWx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">printer_width</span><span class="p">,</span>
                          <span class="n">margin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">printer_margin</span><span class="p">)</span>
        <span class="n">po2</span>  <span class="o">=</span> <span class="n">PrintoutWx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">printer_width</span><span class="p">,</span>
                          <span class="n">margin</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">printer_margin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">preview</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PrintPreview</span><span class="p">(</span><span class="n">po1</span><span class="p">,</span><span class="n">po2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">printerData</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">preview</span><span class="o">.</span><span class="n">Ok</span><span class="p">():</span>  <span class="nb">print</span> <span class="s2">&quot;error with preview&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">preview</span><span class="o">.</span><span class="n">SetZoom</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">frameInst</span><span class="o">=</span> <span class="bp">self</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">frameInst</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
            <span class="n">frameInst</span><span class="o">=</span> <span class="n">frameInst</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PreviewFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">preview</span><span class="p">,</span> <span class="n">frameInst</span><span class="p">,</span> <span class="s2">&quot;Preview&quot;</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">Initialize</span><span class="p">()</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">())</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">SetSize</span><span class="p">((</span><span class="mi">850</span><span class="p">,</span><span class="mi">650</span><span class="p">))</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">Centre</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">BOTH</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_repaint</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">Printer_Print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Print figure using wx Print mechanism</span>

<span class="sd">        Deprecated.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Printer* methods will be removed&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="n">pdd</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PrintDialogData</span><span class="p">()</span>
        <span class="c1"># SetPrintData for 2.4 combatibility</span>
        <span class="n">pdd</span><span class="o">.</span><span class="n">SetPrintData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">printerData</span><span class="p">)</span>
        <span class="n">pdd</span><span class="o">.</span><span class="n">SetToPage</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">printer</span>  <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Printer</span><span class="p">(</span><span class="n">pdd</span><span class="p">)</span>
        <span class="n">printout</span>  <span class="o">=</span> <span class="n">PrintoutWx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">printer_width</span><span class="p">),</span>
                               <span class="n">margin</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">printer_margin</span><span class="p">))</span>
        <span class="n">print_ok</span> <span class="o">=</span> <span class="n">printer</span><span class="o">.</span><span class="n">Print</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">printout</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">VERSION_STRING</span> <span class="o">&gt;=</span> <span class="s1">&#39;2.5&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">print_ok</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">printer</span><span class="o">.</span><span class="n">GetLastError</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">PRINTER_CANCELLED</span><span class="p">:</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;There was a problem printing.</span>
<span class="s2">                Perhaps your current printer is not set correctly?&quot;&quot;&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Printing&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">print_ok</span><span class="p">:</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;There was a problem printing.</span>
<span class="s2">                Perhaps your current printer is not set correctly?&quot;&quot;&quot;</span><span class="p">,</span>
                              <span class="s2">&quot;Printing&quot;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
        <span class="n">printout</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_repaint</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">draw_idle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delay rendering until the GUI is idle.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;draw_idle()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isDrawn</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Force redraw</span>
        <span class="c1"># Create a timer for handling draw_idle requests</span>
        <span class="c1"># If there are events pending when the timer is</span>
        <span class="c1"># complete, reset the timer and continue.  The</span>
        <span class="c1"># alternative approach, binding to wx.EVT_IDLE,</span>
        <span class="c1"># doesn&#39;t behave as nicely.</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_idletimer&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_idletimer</span><span class="o">.</span><span class="n">Restart</span><span class="p">(</span><span class="n">IDLE_DELAY</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_idletimer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FutureCall</span><span class="p">(</span><span class="n">IDLE_DELAY</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_onDrawIdle</span><span class="p">)</span>
            <span class="c1"># FutureCall is a backwards-compatible alias;</span>
            <span class="c1"># CallLater became available in 2.7.1.1.</span>

    <span class="k">def</span> <span class="nf">_onDrawIdle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">GetApp</span><span class="p">()</span><span class="o">.</span><span class="n">Pending</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_idletimer</span><span class="o">.</span><span class="n">Restart</span><span class="p">(</span><span class="n">IDLE_DELAY</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idletimer</span>
            <span class="c1"># GUI event or explicit draw call may already</span>
            <span class="c1"># have caused the draw to take place</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isDrawn</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawDC</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Render the figure using RendererWx instance renderer, or using a</span>
<span class="sd">        previously defined renderer if none is specified.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;draw()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">renderer</span> <span class="o">=</span> <span class="n">RendererWx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isDrawn</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui_repaint</span><span class="p">(</span><span class="n">drawDC</span><span class="o">=</span><span class="n">drawDC</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">new_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new backend-specific subclass of :class:`backend_bases.Timer`.</span>
<span class="sd">        This is useful for getting periodic events through the backend&#39;s native</span>
<span class="sd">        event loop. Implemented only for backends with GUIs.</span>

<span class="sd">        optional arguments:</span>

<span class="sd">        *interval*</span>
<span class="sd">          Timer interval in milliseconds</span>
<span class="sd">        *callbacks*</span>
<span class="sd">          Sequence of (func, args, kwargs) where func(*args, **kwargs) will</span>
<span class="sd">          be executed by the timer every *interval*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">TimerWx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">flush_events</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Yield</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">start_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start an event loop.  This is used to start a blocking event</span>
<span class="sd">        loop so that interactive functions, such as ginput and</span>
<span class="sd">        waitforbuttonpress, can wait for events.  This should not be</span>
<span class="sd">        confused with the main GUI event loop, which is always running</span>
<span class="sd">        and has nothing to do with this.</span>

<span class="sd">        Call signature::</span>

<span class="sd">        start_event_loop(self,timeout=0)</span>

<span class="sd">        This call blocks until a callback function triggers</span>
<span class="sd">        stop_event_loop() or *timeout* is reached.  If *timeout* is</span>
<span class="sd">        &lt;=0, never timeout.</span>

<span class="sd">        Raises RuntimeError if event loop is already running.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_event_loop&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Event loop already running&quot;</span><span class="p">)</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Timer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">timeout</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">timer</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span><span class="n">timeout</span><span class="o">*</span><span class="mi">1000</span><span class="p">,</span> <span class="n">oneShot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TIMER</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_event_loop</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>

        <span class="c1"># Event loop handler for start/stop event loop</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event_loop</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">EventLoop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_event_loop</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span>
        <span class="n">timer</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">stop_event_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop an event loop.  This is used to stop a blocking event</span>
<span class="sd">        loop so that interactive functions, such as ginput and</span>
<span class="sd">        waitforbuttonpress, can wait for events.</span>

<span class="sd">        Call signature::</span>

<span class="sd">        stop_event_loop_default(self)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_event_loop&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event_loop</span><span class="o">.</span><span class="n">IsRunning</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_event_loop</span><span class="o">.</span><span class="n">Exit</span><span class="p">()</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_event_loop</span>


    <span class="k">def</span> <span class="nf">_get_imagesave_wildcards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;return the wildcard string for the filesave dialog&#39;</span>
        <span class="n">default_filetype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_filetype</span><span class="p">()</span>
        <span class="n">filetypes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_supported_filetypes_grouped</span><span class="p">()</span>
        <span class="n">sorted_filetypes</span> <span class="o">=</span> <span class="n">filetypes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="n">sorted_filetypes</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">wildcards</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">extensions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">filter_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">exts</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sorted_filetypes</span><span class="p">):</span>
            <span class="n">ext_list</span> <span class="o">=</span> <span class="s1">&#39;;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;*.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">ext</span> <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">exts</span><span class="p">])</span>
            <span class="n">extensions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">wildcard</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)|</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ext_list</span><span class="p">,</span> <span class="n">ext_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">default_filetype</span> <span class="ow">in</span> <span class="n">exts</span><span class="p">:</span>
                <span class="n">filter_index</span> <span class="o">=</span> <span class="n">i</span>
            <span class="n">wildcards</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wildcard</span><span class="p">)</span>
        <span class="n">wildcards</span> <span class="o">=</span> <span class="s1">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wildcards</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wildcards</span><span class="p">,</span> <span class="n">extensions</span><span class="p">,</span> <span class="n">filter_index</span>

    <span class="k">def</span> <span class="nf">gui_repaint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawDC</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs update of the displayed image on the GUI canvas, using the</span>
<span class="sd">        supplied device context.  If drawDC is None, a ClientDC will be used to</span>
<span class="sd">        redraw the image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;gui_repaint()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsShownOnScreen</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">drawDC</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">drawDC</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ClientDC</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

            <span class="n">drawDC</span><span class="o">.</span><span class="n">BeginDrawing</span><span class="p">()</span>
            <span class="n">drawDC</span><span class="o">.</span><span class="n">DrawBitmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">drawDC</span><span class="o">.</span><span class="n">EndDrawing</span><span class="p">()</span>
            <span class="c1">#wx.GetApp().Yield()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="n">filetypes</span> <span class="o">=</span> <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">filetypes</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">filetypes</span><span class="p">[</span><span class="s1">&#39;bmp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Windows bitmap&#39;</span>
    <span class="n">filetypes</span><span class="p">[</span><span class="s1">&#39;jpeg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;JPEG&#39;</span>
    <span class="n">filetypes</span><span class="p">[</span><span class="s1">&#39;jpg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;JPEG&#39;</span>
    <span class="n">filetypes</span><span class="p">[</span><span class="s1">&#39;pcx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;PCX&#39;</span>
    <span class="n">filetypes</span><span class="p">[</span><span class="s1">&#39;png&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Portable Network Graphics&#39;</span>
    <span class="n">filetypes</span><span class="p">[</span><span class="s1">&#39;tif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Tagged Image Format File&#39;</span>
    <span class="n">filetypes</span><span class="p">[</span><span class="s1">&#39;tiff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Tagged Image Format File&#39;</span>
    <span class="n">filetypes</span><span class="p">[</span><span class="s1">&#39;xpm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;X pixmap&#39;</span>

    <span class="k">def</span> <span class="nf">print_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># Use pure Agg renderer to draw</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">print_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Restore the current view; this is needed because the</span>
        <span class="c1"># artist contains methods rely on particular attributes</span>
        <span class="c1"># of the rendered figure for determining things like</span>
        <span class="c1"># bounding boxes.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isDrawn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">print_bmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BITMAP_TYPE_BMP</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_jpeg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BITMAP_TYPE_JPEG</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">print_jpg</span> <span class="o">=</span> <span class="n">print_jpeg</span>

    <span class="k">def</span> <span class="nf">print_pcx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BITMAP_TYPE_PCX</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_png</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BITMAP_TYPE_PNG</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_tiff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BITMAP_TYPE_TIF</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">print_tif</span> <span class="o">=</span> <span class="n">print_tiff</span>

    <span class="k">def</span> <span class="nf">print_xpm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_image</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">BITMAP_TYPE_XPM</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">filetype</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">origBitmap</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span>

        <span class="n">l</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">width</span><span class="p">,</span><span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
        <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">height</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">EmptyBitmap</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">renderer</span> <span class="o">=</span> <span class="n">RendererWx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>

        <span class="n">gc</span> <span class="o">=</span> <span class="n">renderer</span><span class="o">.</span><span class="n">new_gc</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>

        <span class="c1"># Now that we have rendered into the bitmap, save it</span>
        <span class="c1"># to the appropriate file type and clean up</span>
        <span class="k">if</span> <span class="n">is_string_like</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span><span class="o">.</span><span class="n">SaveFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">filetype</span><span class="p">):</span>
                <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s1">&#39;print_figure() file save error&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Could not save figure to </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">is_writable_file_like</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span><span class="o">.</span><span class="n">ConvertToImage</span><span class="p">()</span><span class="o">.</span><span class="n">SaveStream</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">filetype</span><span class="p">):</span>
                <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s1">&#39;print_figure() file save error&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">&#39;Could not save figure to </span><span class="si">%s</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">))</span>

        <span class="c1"># Restore everything to normal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span> <span class="o">=</span> <span class="n">origBitmap</span>

        <span class="c1"># Note: draw is required here since bits of state about the</span>
        <span class="c1"># last renderer are strewn about the artist draw methods.  Do</span>
        <span class="c1"># not remove the draw without first verifying that these have</span>
        <span class="c1"># been cleaned up.  The artist contains() methods will fail</span>
        <span class="c1"># otherwise.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isDrawn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_default_filetype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;png&#39;</span>

    <span class="k">def</span> <span class="nf">_onPaint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when wxPaintEvt is generated</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;_onPaint()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">drawDC</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PaintDC</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isDrawn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">drawDC</span><span class="o">=</span><span class="n">drawDC</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui_repaint</span><span class="p">(</span><span class="n">drawDC</span><span class="o">=</span><span class="n">drawDC</span><span class="p">)</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_onEraseBackground</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when window is redrawn; since we are blitting the entire</span>
<span class="sd">        image, we can leave this blank to suppress flicker.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_onSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called when wxEventSize is generated.</span>

<span class="sd">        In this application we attempt to resize to fit the window, so it</span>
<span class="sd">        is better to take the performance hit and redraw the whole window.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;_onSize()&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Create a new, correctly sized bitmap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetClientSize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bitmap</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">EmptyBitmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isDrawn</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="c1"># Empty figure</span>

        <span class="n">dpival</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span>
        <span class="n">winch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_width</span><span class="o">/</span><span class="n">dpival</span>
        <span class="n">hinch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_height</span><span class="o">/</span><span class="n">dpival</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">winch</span><span class="p">,</span> <span class="n">hinch</span><span class="p">)</span>

        <span class="c1"># Rendering will happen on the associated paint event</span>
        <span class="c1"># so no need to do anything here except to make sure</span>
        <span class="c1"># the whole background is repainted.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">(</span><span class="n">eraseBackground</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">resize_event</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>

        <span class="n">keyval</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">m_keyCode</span>
        <span class="k">if</span> <span class="n">keyval</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyvald</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keyvald</span><span class="p">[</span><span class="n">keyval</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">keyval</span> <span class="o">&lt;</span><span class="mi">256</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">keyval</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># why is wx upcasing this?</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">key</span>

    <span class="k">def</span> <span class="nf">_onIdle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="s1">&#39;a GUI idle event&#39;</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">idle_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onKeyDown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Capture key press.&quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_key</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">key_press_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onKeyUp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Release key.&quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_key</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
        <span class="c1">#print &#39;release key&#39;, key</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">key_release_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onRightButtonDown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start measuring on an axis.&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CaptureMouse</span><span class="p">()</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">button_press_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">evt</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_onRightButtonUp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;End measuring on an axis.&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">HasCapture</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReleaseMouse</span><span class="p">()</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">button_release_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onLeftButtonDown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start measuring on an axis.&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CaptureMouse</span><span class="p">()</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">button_press_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onLeftButtonUp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;End measuring on an axis.&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span>
        <span class="c1">#print &#39;release button&#39;, 1</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">HasCapture</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReleaseMouse</span><span class="p">()</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">button_release_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">evt</span><span class="p">)</span>

    <span class="c1">#Add middle button events</span>
    <span class="k">def</span> <span class="nf">_onMiddleButtonDown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start measuring on an axis.&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CaptureMouse</span><span class="p">()</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">button_press_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onMiddleButtonUp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;End measuring on an axis.&quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span>
        <span class="c1">#print &#39;release button&#39;, 1</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">HasCapture</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReleaseMouse</span><span class="p">()</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">button_release_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onMouseWheel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Translate mouse wheel events into matplotlib events&quot;&quot;&quot;</span>

        <span class="c1"># Determine mouse location</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span>

        <span class="c1"># Convert delta/rotation/rate into a floating point step size</span>
        <span class="n">delta</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetWheelDelta</span><span class="p">()</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetWheelRotation</span><span class="p">()</span>
        <span class="n">rate</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetLinesPerAction</span><span class="p">()</span>
        <span class="c1">#print &quot;delta,rotation,rate&quot;,delta,rotation,rate</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">rate</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">rotation</span><span class="p">)</span><span class="o">/</span><span class="n">delta</span>

        <span class="c1"># Done handling event</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

        <span class="c1"># Mac is giving two events for every wheel event</span>
        <span class="c1"># Need to skip every second one</span>
        <span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">Platform</span> <span class="o">==</span> <span class="s1">&#39;__WXMAC__&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_skipwheelevent&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skipwheelevent</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skipwheelevent</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skipwheelevent</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">return</span>  <span class="c1"># Return without processing event</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_skipwheelevent</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Convert to mpl event</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">scroll_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onMotion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Start measuring on an axis.&quot;&quot;&quot;</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetX</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetY</span><span class="p">()</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">motion_notify_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">guiEvent</span><span class="o">=</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onLeave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mouse has left the window.&quot;&quot;&quot;</span>

        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">leave_notify_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guiEvent</span> <span class="o">=</span> <span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onEnter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Mouse has entered the window.&quot;&quot;&quot;</span>
        <span class="n">FigureCanvasBase</span><span class="o">.</span><span class="n">enter_notify_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guiEvent</span> <span class="o">=</span> <span class="n">evt</span><span class="p">)</span>


<span class="c1">########################################################################</span>
<span class="c1">#</span>
<span class="c1"># The following functions and classes are for pylab compatibility</span>
<span class="c1"># mode (matplotlib.pylab) and implement figure managers, etc...</span>
<span class="c1">#</span>
<span class="c1">########################################################################</span>


<span class="k">def</span> <span class="nf">_create_wx_app</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a wx.PySimpleApp instance if a wx.App has not been created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">wxapp</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">GetApp</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">wxapp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wxapp</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PySimpleApp</span><span class="p">()</span>
        <span class="n">wxapp</span><span class="o">.</span><span class="n">SetExitOnFrameDelete</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># retain a reference to the app object so it does not get garbage</span>
        <span class="c1"># collected and cause segmentation faults</span>
        <span class="n">_create_wx_app</span><span class="o">.</span><span class="n">theWxApp</span> <span class="o">=</span> <span class="n">wxapp</span>


<span class="k">def</span> <span class="nf">draw_if_interactive</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This should be overriden in a windowing environment if drawing</span>
<span class="sd">    should be done in interactive python mode</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;draw_if_interactive()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">is_interactive</span><span class="p">():</span>

        <span class="n">figManager</span> <span class="o">=</span> <span class="n">Gcf</span><span class="o">.</span><span class="n">get_active</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">figManager</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">figManager</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Show</span><span class="p">(</span><span class="n">ShowBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">mainloop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">needmain</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="o">.</span><span class="n">IsMainLoopRunning</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">needmain</span><span class="p">:</span>
            <span class="n">wxapp</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">GetApp</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">wxapp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">wxapp</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>

<span class="n">show</span> <span class="o">=</span> <span class="n">Show</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">new_figure_manager</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new figure manager instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># in order to expose the Figure constructor to the pylab</span>
    <span class="c1"># interface we need to create the figure here</span>
    <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;new_figure_manager()&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">_create_wx_app</span><span class="p">()</span>

    <span class="n">FigureClass</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;FigureClass&#39;</span><span class="p">,</span> <span class="n">Figure</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">FigureClass</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">FigureFrameWx</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>
    <span class="n">figmgr</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">get_figure_manager</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">is_interactive</span><span class="p">():</span>
        <span class="n">figmgr</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">figmgr</span>

<span class="k">class</span> <span class="nc">FigureFrameWx</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">fig</span><span class="p">):</span>
        <span class="c1"># On non-Windows platform, explicitly set the position - fix</span>
        <span class="c1"># positioning bug on some Linux platforms</span>
        <span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">Platform</span> <span class="o">==</span> <span class="s1">&#39;__WXMSW__&#39;</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">DefaultPosition</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">l</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">bounds</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">id</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span>
                          <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Figure </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">num</span><span class="p">)</span>
        <span class="c1"># Frame will be sized later by the Fit method</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;__init__()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span>

        <span class="n">statbar</span> <span class="o">=</span> <span class="n">StatusBarWx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetStatusBar</span><span class="p">(</span><span class="n">statbar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_canvas</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">SetInitialSize</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="c1"># By adding toolbar in sizer, we are able to put it at the bottom</span>
        <span class="c1"># of the frame - so appearance is closer to GTK version</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_toolbar</span><span class="p">(</span><span class="n">statbar</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">Realize</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">wx</span><span class="o">.</span><span class="n">Platform</span> <span class="o">==</span> <span class="s1">&#39;__WXMAC__&#39;</span><span class="p">:</span>
                <span class="c1"># Mac platform (OSX 10.3, MacPython) does not seem to cope with</span>
                <span class="c1"># having a toolbar in a sizer. This work-around gets the buttons</span>
                <span class="c1"># back, but at the expense of having the toolbar at the top</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetToolBar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># On Windows platform, default window size is incorrect, so set</span>
                <span class="c1"># toolbar width to figure width.</span>
                <span class="n">tw</span><span class="p">,</span> <span class="n">th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">GetSizeTuple</span><span class="p">()</span>
                <span class="n">fw</span><span class="p">,</span> <span class="n">fh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">GetSizeTuple</span><span class="p">()</span>
                <span class="c1"># By adding toolbar in sizer, we are able to put it at the bottom</span>
                <span class="c1"># of the frame - so appearance is closer to GTK version.</span>
                <span class="c1"># As noted above, doesn&#39;t work for Mac.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="n">fw</span><span class="p">,</span> <span class="n">th</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">figmgr</span> <span class="o">=</span> <span class="n">FigureManagerWx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_CLOSE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onClose</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_toolbar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statbar</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;toolbar&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;classic&#39;</span><span class="p">:</span>
            <span class="n">toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbarWx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;toolbar&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;toolbar2&#39;</span><span class="p">:</span>
            <span class="n">toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbar2Wx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="p">)</span>
            <span class="n">toolbar</span><span class="o">.</span><span class="n">set_status_bar</span><span class="p">(</span><span class="n">statbar</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">toolbar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">toolbar</span>

    <span class="k">def</span> <span class="nf">get_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FigureCanvasWx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_figure_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;get_figure_manager()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">figmgr</span>

    <span class="k">def</span> <span class="nf">_onClose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;onClose()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">close_event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">stop_event_loop</span><span class="p">()</span>
        <span class="n">Gcf</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
        <span class="c1">#self.Destroy()</span>

    <span class="k">def</span> <span class="nf">GetToolBar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Override wxFrame::GetToolBar as we don&#39;t have managed toolbar&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span>

    <span class="k">def</span> <span class="nf">Destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">_idDrag</span><span class="p">)</span>
            <span class="c1"># Rationale for line above: see issue 2941338.</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span> <span class="c1"># classic toolbar lacks the attribute</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">Destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="n">wxapp</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">GetApp</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">wxapp</span><span class="p">:</span>
            <span class="n">wxapp</span><span class="o">.</span><span class="n">Yield</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">FigureManagerWx</span><span class="p">(</span><span class="n">FigureManagerBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class contains the FigureCanvas and GUI frame</span>

<span class="sd">    It is instantiated by GcfWx whenever a new figure is created. GcfWx is</span>
<span class="sd">    responsible for managing multiple instances of FigureManagerWx.</span>

<span class="sd">    NB: FigureManagerBase is found in _pylab_helpers</span>

<span class="sd">    public attrs</span>

<span class="sd">    canvas - a FigureCanvasWx(wx.Panel) instance</span>
<span class="sd">    window - a wxFrame instance - http://www.lpthe.jussieu.fr/~zeitlin/wxWindows/docs/wxwin_wxframe.html#wxframe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">num</span><span class="p">,</span> <span class="n">frame</span><span class="p">):</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;__init__()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">FigureManagerBase</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">frame</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tb</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">GetToolBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tb</span>  <span class="c1"># consistent with other backends</span>
        <span class="k">def</span> <span class="nf">notify_axes_change</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
            <span class="s1">&#39;this will be called whenever the current axes is changed&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tb</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">tb</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_axobserver</span><span class="p">(</span><span class="n">notify_axes_change</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">showfig</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>

        <span class="c1"># attach a show method to the figure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="n">showfig</span>

    <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;destroy()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="c1">#if self.tb is not None: self.tb.Destroy()</span>
        <span class="kn">import</span> <span class="nn">wx</span>
        <span class="c1">#wx.GetApp().ProcessIdle()</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">WakeUpIdle</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_window_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">):</span>
        <span class="s1">&#39;Set the canvas size in pixels&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">SetInitialSize</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">.</span><span class="n">GetSizer</span><span class="p">()</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">)</span>

<span class="c1"># Identifiers for toolbar controls - images_wx contains bitmaps for the images</span>
<span class="c1"># used in the controls. wxWindows does not provide any stock images, so I&#39;ve</span>
<span class="c1"># &#39;stolen&#39; those from GTK2, and transformed them into the appropriate format.</span>
<span class="c1">#import images_wx</span>

<span class="n">_NTB_AXISMENU</span>        <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">_NTB_AXISMENU_BUTTON</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">_NTB_X_PAN_LEFT</span>      <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">_NTB_X_PAN_RIGHT</span>     <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">_NTB_X_ZOOMIN</span>        <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">_NTB_X_ZOOMOUT</span>       <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">_NTB_Y_PAN_UP</span>        <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">_NTB_Y_PAN_DOWN</span>      <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">_NTB_Y_ZOOMIN</span>        <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">_NTB_Y_ZOOMOUT</span>       <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="c1">#_NTB_SUBPLOT            =wx.NewId()</span>
<span class="n">_NTB_SAVE</span>            <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
<span class="n">_NTB_CLOSE</span>           <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">_load_bitmap</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a bitmap file from the backends/images subdirectory in which the</span>
<span class="sd">    matplotlib library is installed. The filename parameter should not</span>
<span class="sd">    contain any path information as this is determined automatically.</span>

<span class="sd">    Returns a wx.Bitmap object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">basedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;datapath&#39;</span><span class="p">],</span><span class="s1">&#39;images&#39;</span><span class="p">)</span>

    <span class="n">bmpFilename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">basedir</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">bmpFilename</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="s1">&#39;Could not find bitmap file &quot;</span><span class="si">%s</span><span class="s1">&quot;; dying&#39;</span><span class="o">%</span><span class="n">bmpFilename</span><span class="p">)</span>

    <span class="n">bmp</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Bitmap</span><span class="p">(</span><span class="n">bmpFilename</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bmp</span>

<span class="k">class</span> <span class="nc">MenuButtonWx</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    wxPython does not permit a menu to be incorporated directly into a toolbar.</span>
<span class="sd">    This class simulates the effect by associating a pop-up menu with a button</span>
<span class="sd">    in the toolbar, and managing this as though it were a menu.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">_NTB_AXISMENU_BUTTON</span><span class="p">,</span> <span class="s2">&quot;Axes:        &quot;</span><span class="p">,</span>
                          <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">BU_EXACTFIT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toolbar</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># First two menu items never change...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allId</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_invertId</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_allId</span><span class="p">,</span> <span class="s2">&quot;All&quot;</span><span class="p">,</span> <span class="s2">&quot;Select all axes&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_invertId</span><span class="p">,</span> <span class="s2">&quot;Invert&quot;</span><span class="p">,</span> <span class="s2">&quot;Invert axes selected&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">AppendSeparator</span><span class="p">()</span>

        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onMenuButton</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB_AXISMENU_BUTTON</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handleSelectAllAxes</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_allId</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handleInvertAxesSelected</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_invertId</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_onMenuButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Handle menu button pressed.&quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPositionTuple</span><span class="p">()</span>
        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSizeTuple</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PopupMenuXY</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
                <span class="c1"># When menu returned, indicate selection in button</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_handleSelectAllAxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called when the &#39;select all axes&#39; menu item is selected.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toolbar</span><span class="o">.</span><span class="n">set_active</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getActiveAxes</span><span class="p">())</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_handleInvertAxesSelected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called when the invert all menu item is selected&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toolbar</span><span class="o">.</span><span class="n">set_active</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getActiveAxes</span><span class="p">())</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_onMenuItemSelected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called whenever one of the specific axis menu items is selected&quot;&quot;&quot;</span>
        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">current</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">GetId</span><span class="p">(),</span> <span class="n">new</span><span class="p">)</span>
        <span class="c1"># Lines above would be deleted based on svn tracker ID 2841525;</span>
        <span class="c1"># not clear whether this matters or not.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toolbar</span><span class="o">.</span><span class="n">set_active</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getActiveAxes</span><span class="p">())</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">updateAxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxAxis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Ensures that there are entries for max_axis axes in the menu</span>
<span class="sd">        (selected by default).&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">maxAxis</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxAxis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">menuId</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">menuId</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menuId</span><span class="p">,</span> <span class="s2">&quot;Axis </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="s2">&quot;Select axis </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="n">menuId</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onMenuItemSelected</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">menuId</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">maxAxis</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">menuId</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">[</span><span class="n">maxAxis</span><span class="p">:]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">menuId</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">[:</span><span class="n">maxAxis</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_toolbar</span><span class="o">.</span><span class="n">set_active</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">maxAxis</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getActiveAxes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a list of the selected axes.&quot;&quot;&quot;</span>
        <span class="n">active</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axisId</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">active</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">active</span>

    <span class="k">def</span> <span class="nf">updateButtonText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update the list of selected axes in the menu button&quot;&quot;&quot;</span>
        <span class="n">axis_txt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
            <span class="n">axis_txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># remove trailing &#39;,&#39; and add to button string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s2">&quot;Axes: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">axis_txt</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>




<span class="n">cursord</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">cursors</span><span class="o">.</span><span class="n">MOVE</span> <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">CURSOR_HAND</span><span class="p">,</span>
    <span class="n">cursors</span><span class="o">.</span><span class="n">HAND</span> <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">CURSOR_HAND</span><span class="p">,</span>
    <span class="n">cursors</span><span class="o">.</span><span class="n">POINTER</span> <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">CURSOR_ARROW</span><span class="p">,</span>
    <span class="n">cursors</span><span class="o">.</span><span class="n">SELECT_REGION</span> <span class="p">:</span> <span class="n">wx</span><span class="o">.</span><span class="n">CURSOR_CROSS</span><span class="p">,</span>
    <span class="p">}</span>


<span class="k">class</span> <span class="nc">SubplotToolWX</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetfig</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Configure subplots&quot;</span><span class="p">)</span>

        <span class="n">toolfig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="n">FigureCanvasWx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">toolfig</span><span class="p">)</span>

        <span class="c1"># Create a figure manager to manage things</span>
        <span class="n">figmgr</span> <span class="o">=</span> <span class="n">FigureManager</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Now put all into a sizer</span>
        <span class="n">sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="c1"># This way of adding to sizer allows resizing</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">GROW</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">sizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
        <span class="n">tool</span> <span class="o">=</span> <span class="n">SubplotTool</span><span class="p">(</span><span class="n">targetfig</span><span class="p">,</span> <span class="n">toolfig</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NavigationToolbar2Wx</span><span class="p">(</span><span class="n">NavigationToolbar2</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ToolBar</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">ToolBar</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">GetParent</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">NavigationToolbar2</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idle</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statbar</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_canvas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">fig</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">FigureCanvasWx</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_toolbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;_init_toolbar&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
        <span class="n">_NTB2_HOME</span>    <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_BACK</span>    <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_FORWARD</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_PAN</span>     <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_ZOOM</span>    <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
        <span class="n">_NTB2_SAVE</span>    <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
        <span class="n">_NTB2_SUBPLOT</span>    <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetToolBitmapSize</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span><span class="mi">24</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="n">_NTB2_HOME</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;home.png&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Home&#39;</span><span class="p">,</span> <span class="s1">&#39;Reset original view&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_BACK</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;back.png&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Back&#39;</span><span class="p">,</span> <span class="s1">&#39;Back navigation view&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_FORWARD</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;forward.png&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Forward&#39;</span><span class="p">,</span> <span class="s1">&#39;Forward navigation view&#39;</span><span class="p">)</span>
        <span class="c1"># todo: get new bitmap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddCheckTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_PAN</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;move.png&#39;</span><span class="p">),</span>
                           <span class="n">shortHelp</span><span class="o">=</span><span class="s1">&#39;Pan&#39;</span><span class="p">,</span>
                           <span class="n">longHelp</span><span class="o">=</span><span class="s1">&#39;Pan with left, zoom with right&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddCheckTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_ZOOM</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;zoom_to_rect.png&#39;</span><span class="p">),</span>
                           <span class="n">shortHelp</span><span class="o">=</span><span class="s1">&#39;Zoom&#39;</span><span class="p">,</span> <span class="n">longHelp</span><span class="o">=</span><span class="s1">&#39;Zoom to rectangle&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AddSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="n">_NTB2_SUBPLOT</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;subplots.png&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Configure subplots&#39;</span><span class="p">,</span> <span class="s1">&#39;Configure subplot parameters&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="n">_NTB2_SAVE</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;filesave.png&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Save&#39;</span><span class="p">,</span> <span class="s1">&#39;Save plot contents to file&#39;</span><span class="p">)</span>

        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">home</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB2_HOME</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_FORWARD</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">back</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_BACK</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_ZOOM</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pan</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_PAN</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">configure_subplot</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB2_SUBPLOT</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB2_SAVE</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Realize</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ToggleTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_PAN</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">NavigationToolbar2</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ToggleTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_ZOOM</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">NavigationToolbar2</span><span class="o">.</span><span class="n">pan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">configure_subplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="n">frame</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Configure subplots&quot;</span><span class="p">)</span>

        <span class="n">toolfig</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_canvas</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">toolfig</span><span class="p">)</span>

        <span class="c1"># Create a figure manager to manage things</span>
        <span class="n">figmgr</span> <span class="o">=</span> <span class="n">FigureManager</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">frame</span><span class="p">)</span>

        <span class="c1"># Now put all into a sizer</span>
        <span class="n">sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="c1"># This way of adding to sizer allows resizing</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">canvas</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">GROW</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">sizer</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
        <span class="n">tool</span> <span class="o">=</span> <span class="n">SubplotTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="p">,</span> <span class="n">toolfig</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="c1"># Fetch the required filename and file type.</span>
        <span class="n">filetypes</span><span class="p">,</span> <span class="n">exts</span><span class="p">,</span> <span class="n">filter_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">_get_imagesave_wildcards</span><span class="p">()</span>
        <span class="n">default_file</span> <span class="o">=</span> <span class="s2">&quot;image.&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">get_default_filetype</span><span class="p">()</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">,</span> <span class="s2">&quot;Save to file&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">default_file</span><span class="p">,</span>
                            <span class="n">filetypes</span><span class="p">,</span>
                            <span class="n">wx</span><span class="o">.</span><span class="n">SAVE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">OVERWRITE_PROMPT</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetFilterIndex</span><span class="p">(</span><span class="n">filter_index</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">dirname</span>  <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetFilename</span><span class="p">()</span>
            <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s1">&#39;Save file dir:</span><span class="si">%s</span><span class="s1"> name:</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="nb">format</span> <span class="o">=</span> <span class="n">exts</span><span class="p">[</span><span class="n">dlg</span><span class="o">.</span><span class="n">GetFilterIndex</span><span class="p">()]</span>
            <span class="n">basename</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ext</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
                <span class="n">ext</span> <span class="o">=</span> <span class="n">ext</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;ps&#39;</span><span class="p">,</span> <span class="s1">&#39;eps&#39;</span><span class="p">,</span> <span class="s1">&#39;png&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">format</span><span class="o">!=</span><span class="n">ext</span><span class="p">:</span>
                <span class="c1">#looks like they forgot to set the image type drop</span>
                <span class="c1">#down, going with the extension.</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;extension </span><span class="si">%s</span><span class="s1"> did not match the selected image type </span><span class="si">%s</span><span class="s1">; going with </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ext</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span> <span class="n">ext</span><span class="p">),</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="nb">format</span> <span class="o">=</span> <span class="n">ext</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">print_figure</span><span class="p">(</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">filename</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">error_msg_wx</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">set_cursor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cursor</span><span class="p">):</span>
        <span class="n">cursor</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">StockCursor</span><span class="p">(</span><span class="n">cursord</span><span class="p">[</span><span class="n">cursor</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">SetCursor</span><span class="p">(</span> <span class="n">cursor</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span> <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastrect</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">dynamic_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idle</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">d</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_idle</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">draw_rubberband</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">):</span>
        <span class="s1">&#39;adapted from http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/189744&#39;</span>
        <span class="n">canvas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span>
        <span class="n">dc</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ClientDC</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>

        <span class="c1"># Set logical function to XOR for rubberbanding</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">SetLogicalFunction</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">XOR</span><span class="p">)</span>

        <span class="c1"># Set dc brush and pen</span>
        <span class="c1"># Here I set brush and pen to white and grey respectively</span>
        <span class="c1"># You can set it to your own choices</span>

        <span class="c1"># The brush setting is not really needed since we</span>
        <span class="c1"># dont do any filling of the dc. It is set just for</span>
        <span class="c1"># the sake of completion.</span>

        <span class="n">wbrush</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Brush</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">),</span> <span class="n">wx</span><span class="o">.</span><span class="n">TRANSPARENT</span><span class="p">)</span>
        <span class="n">wpen</span> <span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Pen</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">SOLID</span><span class="p">)</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">SetBrush</span><span class="p">(</span><span class="n">wbrush</span><span class="p">)</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">SetPen</span><span class="p">(</span><span class="n">wpen</span><span class="p">)</span>


        <span class="n">dc</span><span class="o">.</span><span class="n">ResetBoundingBox</span><span class="p">()</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">BeginDrawing</span><span class="p">()</span>
        <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">bbox</span><span class="o">.</span><span class="n">height</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="n">y1</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">height</span> <span class="o">-</span> <span class="n">y0</span>

        <span class="k">if</span> <span class="n">y1</span><span class="o">&lt;</span><span class="n">y0</span><span class="p">:</span> <span class="n">y0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y0</span>
        <span class="k">if</span> <span class="n">x1</span><span class="o">&lt;</span><span class="n">y0</span><span class="p">:</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x0</span>

        <span class="n">w</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span>

        <span class="n">rect</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x0</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">y0</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span> <span class="n">lastrect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lastrect</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">dc</span><span class="o">.</span><span class="n">DrawRectangle</span><span class="p">(</span><span class="o">*</span><span class="n">lastrect</span><span class="p">)</span>  <span class="c1">#erase last</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastrect</span> <span class="o">=</span> <span class="n">rect</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">DrawRectangle</span><span class="p">(</span><span class="o">*</span><span class="n">rect</span><span class="p">)</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">EndDrawing</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_status_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statbar</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statbar</span> <span class="o">=</span> <span class="n">statbar</span>

    <span class="k">def</span> <span class="nf">set_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">statbar</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">statbar</span><span class="o">.</span><span class="n">set_function</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_history_buttons</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">can_backward</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="o">.</span><span class="n">_pos</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">can_forward</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="o">.</span><span class="n">_pos</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_views</span><span class="o">.</span><span class="n">_elements</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EnableTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_BACK</span><span class="p">,</span> <span class="n">can_backward</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EnableTool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_NTB2_FORWARD</span><span class="p">,</span> <span class="n">can_forward</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">NavigationToolbarWx</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ToolBar</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">can_kill</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        figure is the Figure instance that the toolboar controls</span>

<span class="sd">        win, if not None, is the wxWindow the Figure is embedded in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">ToolBar</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="o">.</span><span class="n">GetParent</span><span class="p">(),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;__init__()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lastControl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mouseOnButton</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_NTB_BUTTON_HANDLER</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">_NTB_X_PAN_LEFT</span>  <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">panx</span><span class="p">,</span>
            <span class="n">_NTB_X_PAN_RIGHT</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">panx</span><span class="p">,</span>
            <span class="n">_NTB_X_ZOOMIN</span>    <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoomx</span><span class="p">,</span>
            <span class="n">_NTB_X_ZOOMOUT</span>   <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoomy</span><span class="p">,</span>
            <span class="n">_NTB_Y_PAN_UP</span>    <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pany</span><span class="p">,</span>
            <span class="n">_NTB_Y_PAN_DOWN</span>  <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">pany</span><span class="p">,</span>
            <span class="n">_NTB_Y_ZOOMIN</span>    <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoomy</span><span class="p">,</span>
            <span class="n">_NTB_Y_ZOOMOUT</span>   <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoomy</span> <span class="p">}</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">_create_menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_controls</span><span class="p">(</span><span class="n">can_kill</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Realize</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_create_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the &#39;menu&#39; - implemented as a button which opens a</span>
<span class="sd">        pop-up menu since wxPython does not allow a menu as a control</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;_create_menu()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span> <span class="o">=</span> <span class="n">MenuButtonWx</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddControl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSeparator</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_create_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">can_kill</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates the button controls, and links them to event handlers</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;_create_controls()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Need the following line as Windows toolbars default to 15x16</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetToolBitmapSize</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="n">_NTB_X_PAN_LEFT</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;stock_left.xpm&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Left&#39;</span><span class="p">,</span> <span class="s1">&#39;Scroll left&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="n">_NTB_X_PAN_RIGHT</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;stock_right.xpm&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Right&#39;</span><span class="p">,</span> <span class="s1">&#39;Scroll right&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="n">_NTB_X_ZOOMIN</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;stock_zoom-in.xpm&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Zoom in&#39;</span><span class="p">,</span> <span class="s1">&#39;Increase X axis magnification&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="n">_NTB_X_ZOOMOUT</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;stock_zoom-out.xpm&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Zoom out&#39;</span><span class="p">,</span> <span class="s1">&#39;Decrease X axis magnification&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="n">_NTB_Y_PAN_UP</span><span class="p">,</span><span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;stock_up.xpm&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Up&#39;</span><span class="p">,</span> <span class="s1">&#39;Scroll up&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="n">_NTB_Y_PAN_DOWN</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;stock_down.xpm&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Down&#39;</span><span class="p">,</span> <span class="s1">&#39;Scroll down&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="n">_NTB_Y_ZOOMIN</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;stock_zoom-in.xpm&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Zoom in&#39;</span><span class="p">,</span> <span class="s1">&#39;Increase Y axis magnification&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="n">_NTB_Y_ZOOMOUT</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;stock_zoom-out.xpm&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Zoom out&#39;</span><span class="p">,</span> <span class="s1">&#39;Decrease Y axis magnification&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSimpleTool</span><span class="p">(</span><span class="n">_NTB_SAVE</span><span class="p">,</span> <span class="n">_load_bitmap</span><span class="p">(</span><span class="s1">&#39;stock_save_as.xpm&#39;</span><span class="p">),</span>
                           <span class="s1">&#39;Save&#39;</span><span class="p">,</span> <span class="s1">&#39;Save plot contents as images&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddSeparator</span><span class="p">()</span>

        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onLeftScroll</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB_X_PAN_LEFT</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onRightScroll</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB_X_PAN_RIGHT</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onXZoomIn</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB_X_ZOOMIN</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onXZoomOut</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB_X_ZOOMOUT</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onUpScroll</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB_Y_PAN_UP</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onDownScroll</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB_Y_PAN_DOWN</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onYZoomIn</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB_Y_ZOOMIN</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onYZoomOut</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB_Y_ZOOMOUT</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onSave</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB_SAVE</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL_ENTER</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onEnterTool</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">can_kill</span><span class="p">:</span>
            <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_TOOL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onClose</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">_NTB_CLOSE</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MOUSEWHEEL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onMouseWheel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_active</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ind</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ind is a list of index numbers for the axes which are to be made active</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;set_active()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="o">=</span> <span class="n">ind</span>
        <span class="k">if</span> <span class="n">ind</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ind</span> <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_active</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Now update button text wit active axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">updateButtonText</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_last_control</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the identity of the last toolbar button pressed.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastControl</span>

    <span class="k">def</span> <span class="nf">panx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>

        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;panx()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">pan</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">Refresh</span><span class="p">(</span><span class="n">eraseBackground</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pany</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">direction</span><span class="p">):</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;pany()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">pan</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">Refresh</span><span class="p">(</span><span class="n">eraseBackground</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">zoomx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_out</span><span class="p">):</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;zoomx()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">in_out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">Refresh</span><span class="p">(</span><span class="n">eraseBackground</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">zoomy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_out</span><span class="p">):</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;zoomy()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_active</span><span class="p">:</span>
            <span class="n">a</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">zoom</span><span class="p">(</span><span class="n">in_out</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">Refresh</span><span class="p">(</span><span class="n">eraseBackground</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the toolbar menu - called when (e.g.) a new subplot</span>
<span class="sd">        or axes are added</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DEBUG_MSG</span><span class="p">(</span><span class="s2">&quot;update()&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_axes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu</span><span class="o">.</span><span class="n">updateAxes</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_axes</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_do_nothing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A NULL event handler - does nothing whatsoever&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="c1"># Local event handlers - mainly supply parameters to pan/scroll functions</span>
    <span class="k">def</span> <span class="nf">_onEnterTool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="n">toolId</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_NTB_BUTTON_HANDLER</span><span class="p">[</span><span class="n">toolId</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">button_fn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_nothing</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_onLeftScroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panx</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_onRightScroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_onXZoomIn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoomx</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_onXZoomOut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoomx</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_onUpScroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pany</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_onDownScroll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pany</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_onYZoomIn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoomy</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_onYZoomOut</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoomy</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_onMouseEnterButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mouseOnButton</span> <span class="o">=</span> <span class="n">button</span>

    <span class="k">def</span> <span class="nf">_onMouseLeaveButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mouseOnButton</span> <span class="o">==</span> <span class="n">button</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_mouseOnButton</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_onMouseWheel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetWheelRotation</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_fn</span><span class="p">(</span><span class="n">direction</span><span class="p">)</span>

    <span class="n">_onSave</span> <span class="o">=</span> <span class="n">NavigationToolbar2Wx</span><span class="o">.</span><span class="n">save</span>

    <span class="k">def</span> <span class="nf">_onClose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>



<span class="k">class</span> <span class="nc">StatusBarWx</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StatusBar</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A status bar is added to _FigureFrame to allow measurements and the</span>
<span class="sd">    previously selected scroll function to be displayed as a user</span>
<span class="sd">    convenience.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">StatusBar</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetFieldsCount</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetStatusText</span><span class="p">(</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1">#self.SetStatusText(&quot;Measurement: None&quot;, 2)</span>
        <span class="c1">#self.Reposition()</span>

    <span class="k">def</span> <span class="nf">set_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">string</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetStatusText</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">string</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1">#def set_measurement(self, string):</span>
    <span class="c1">#    self.SetStatusText(&quot;Measurement: %s&quot; % string, 2)</span>


<span class="c1">#&lt; Additions for printing support: Matt Newville</span>

<span class="k">class</span> <span class="nc">PrintoutWx</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Printout</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple wrapper around wx Printout class -- all the real work</span>
<span class="sd">    here is scaling the matplotlib canvas bitmap to the current</span>
<span class="sd">    printer&#39;s definition.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">canvas</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">5.5</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;matplotlib&#39;</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Printout</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span> <span class="o">=</span> <span class="n">canvas</span>
        <span class="c1"># width, in inches of output figure (approximate)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span>  <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">margin</span> <span class="o">=</span> <span class="n">margin</span>

    <span class="k">def</span> <span class="nf">HasPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">):</span>
        <span class="c1">#current only supports 1 page print</span>
        <span class="k">return</span> <span class="n">page</span> <span class="o">==</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">GetPageInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">OnPrintPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">page</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="n">dc</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetDC</span><span class="p">()</span>
        <span class="p">(</span><span class="n">ppw</span><span class="p">,</span><span class="n">pph</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPPIPrinter</span><span class="p">()</span>      <span class="c1"># printer&#39;s pixels per in</span>
        <span class="p">(</span><span class="n">pgw</span><span class="p">,</span><span class="n">pgh</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPageSizePixels</span><span class="p">()</span>  <span class="c1"># page size in pixels</span>
        <span class="p">(</span><span class="n">dcw</span><span class="p">,</span><span class="n">dch</span><span class="p">)</span> <span class="o">=</span> <span class="n">dc</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>
        <span class="p">(</span><span class="n">grw</span><span class="p">,</span><span class="n">grh</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">GetSizeTuple</span><span class="p">()</span>

        <span class="c1"># save current figure dpi resolution and bg color,</span>
        <span class="c1"># so that we can temporarily set them to the dpi of</span>
        <span class="c1"># the printer, and the bg color to white</span>
        <span class="n">bgcolor</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">get_facecolor</span><span class="p">()</span>
        <span class="n">fig_dpi</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span>

        <span class="c1"># draw the bitmap, scaled appropriately</span>
        <span class="n">vscale</span>    <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">ppw</span><span class="p">)</span> <span class="o">/</span> <span class="n">fig_dpi</span>

        <span class="c1"># set figure resolution,bg color for printer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">ppw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;#FFFFFF&#39;</span><span class="p">)</span>

        <span class="n">renderer</span>  <span class="o">=</span> <span class="n">RendererWx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bitmap</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bitmap</span><span class="o">.</span><span class="n">SetWidth</span><span class="p">(</span>  <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bitmap</span><span class="o">.</span><span class="n">GetWidth</span><span class="p">()</span> <span class="o">*</span> <span class="n">vscale</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bitmap</span><span class="o">.</span><span class="n">SetHeight</span><span class="p">(</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bitmap</span><span class="o">.</span><span class="n">GetHeight</span><span class="p">()</span><span class="o">*</span> <span class="n">vscale</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

        <span class="c1"># page may need additional scaling on preview</span>
        <span class="n">page_scale</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">IsPreview</span><span class="p">():</span>   <span class="n">page_scale</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">dcw</span><span class="p">)</span><span class="o">/</span><span class="n">pgw</span>

        <span class="c1"># get margin in pixels = (margin in in) * (pixels/in)</span>
        <span class="n">top_margin</span>  <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margin</span> <span class="o">*</span> <span class="n">pph</span> <span class="o">*</span> <span class="n">page_scale</span><span class="p">)</span>
        <span class="n">left_margin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margin</span> <span class="o">*</span> <span class="n">ppw</span> <span class="o">*</span> <span class="n">page_scale</span><span class="p">)</span>

        <span class="c1"># set scale so that width of output is self.width inches</span>
        <span class="c1"># (assuming grw is size of graph in inches....)</span>
        <span class="n">user_scale</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">fig_dpi</span> <span class="o">*</span> <span class="n">page_scale</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">grw</span><span class="p">)</span>

        <span class="n">dc</span><span class="o">.</span><span class="n">SetDeviceOrigin</span><span class="p">(</span><span class="n">left_margin</span><span class="p">,</span><span class="n">top_margin</span><span class="p">)</span>
        <span class="n">dc</span><span class="o">.</span><span class="n">SetUserScale</span><span class="p">(</span><span class="n">user_scale</span><span class="p">,</span><span class="n">user_scale</span><span class="p">)</span>

        <span class="c1"># this cute little number avoid API inconsistencies in wx</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dc</span><span class="o">.</span><span class="n">DrawBitmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bitmap</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dc</span><span class="o">.</span><span class="n">DrawBitmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">bitmap</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># restore original figure  resolution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">bgcolor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">fig_dpi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span>
<span class="c1">#&gt;</span>

<span class="c1">########################################################################</span>
<span class="c1">#</span>
<span class="c1"># Now just provide the standard names that backend.__init__ is expecting</span>
<span class="c1">#</span>
<span class="c1">########################################################################</span>

<span class="n">Toolbar</span> <span class="o">=</span> <span class="n">NavigationToolbarWx</span>
<span class="n">FigureManager</span> <span class="o">=</span> <span class="n">FigureManagerWx</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">SasView 4.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, The SasView Project.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.2.
    </div>
  </body>
</html>