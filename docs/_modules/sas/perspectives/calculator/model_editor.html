<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>sas.perspectives.calculator.model_editor &mdash; SasView 3.1.2 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '3.1.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="SasView 3.1.2 documentation" href="../../../../index.html" />
    <link rel="up" title="sas.perspectives.calculator" href="../calculator.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">SasView 3.1.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../calculator.html" accesskey="U">sas.perspectives.calculator</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for sas.perspectives.calculator.model_editor</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">This module provides three model editor classes: the composite model editor,</span>
<span class="sd">the easy editor which provides a simple interface with tooltip help to enter</span>
<span class="sd">the parameters of the model and their default value and a panel to input a</span>
<span class="sd">function of y (usually the intensity).  It also provides a drop down of</span>
<span class="sd">standard available math functions.  Finally a full python editor panel for</span>
<span class="sd">complete customizatin is provided.</span>

<span class="sd">:TODO the writiong of the file and name checking (and maybe some other</span>
<span class="sd">funtions?) should be moved to a computational module which could be called</span>
<span class="sd">fropm a python script.  Basically one just needs to pass the name,</span>
<span class="sd">description text and function text (or in the case of the composite editor</span>
<span class="sd">the names of the first and second model and the operator to be used).</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="c">################################################################################</span>
<span class="c">#This software was developed by the University of Tennessee as part of the</span>
<span class="c">#Distributed Data Analysis of Neutron Scattering Experiments (DANSE)</span>
<span class="c">#project funded by the US National Science Foundation.</span>
<span class="c">#</span>
<span class="c">#See the license text in license.txt</span>
<span class="c">#</span>
<span class="c">#copyright 2009, University of Tennessee</span>
<span class="c">################################################################################</span>
<span class="kn">import</span> <span class="nn">wx</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">wx.py.editwindow</span> <span class="kn">import</span> <span class="n">EditWindow</span>
<span class="kn">from</span> <span class="nn">sas.guiframe.documentation_window</span> <span class="kn">import</span> <span class="n">DocumentationWindow</span>


<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;win32&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">FONT_VARIANT</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">PNL_WIDTH</span> <span class="o">=</span> <span class="mi">450</span>
    <span class="n">PNL_HEIGHT</span> <span class="o">=</span> <span class="mi">320</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">FONT_VARIANT</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">PNL_WIDTH</span> <span class="o">=</span> <span class="mi">590</span>
    <span class="n">PNL_HEIGHT</span> <span class="o">=</span> <span class="mi">350</span>
<span class="n">M_NAME</span> <span class="o">=</span> <span class="s">&#39;Model&#39;</span>
<span class="n">EDITOR_WIDTH</span> <span class="o">=</span> <span class="mi">800</span>
<span class="n">EDITOR_HEIGTH</span> <span class="o">=</span> <span class="mi">735</span>
<span class="n">PANEL_WIDTH</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">_BOX_WIDTH</span> <span class="o">=</span> <span class="mi">55</span>


<span class="k">def</span> <span class="nf">_compile_file</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compile the file in the path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">py_compile</span>
        <span class="n">py_compile</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">doraise</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">value</span>

<span class="k">def</span> <span class="nf">_delete_file</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete file in the path</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">raise</span>


<div class="viewcode-block" id="TextDialog"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog">[docs]</a><span class="k">class</span> <span class="nc">TextDialog</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dialog for easy custom composite models.  Provides a wx.Dialog panel</span>
<span class="sd">    to choose two existing models (including pre-existing custom models which</span>
<span class="sd">    may themselves be composite models) as well as an operation on those models</span>
<span class="sd">    (add or multiply) the resulting model will add a scale parameter for summed</span>
<span class="sd">    models and a background parameter for a multiplied model.</span>

<span class="sd">    The user also gives a brief help for the model in a description box and</span>
<span class="sd">    must provide a unique name which is verified as unique before the new</span>
<span class="sd">    model is saved.</span>

<span class="sd">    This Dialog pops up for the user when they press &#39;Sum|Multi(p1,p2)&#39; under</span>
<span class="sd">    &#39;Edit Custom Model&#39; under &#39;Fitting&#39; menu.  This is currently called as</span>
<span class="sd">    a Modal Dialog.</span>

<span class="sd">    :TODO the build in compiler currently balks at when it tries to import</span>
<span class="sd">    a model whose name contains spaces or symbols (such as + ... underscore</span>
<span class="sd">    should be fine).  Have fixed so the editor cannot save such a file name</span>
<span class="sd">    but if a file is dropped in the plugin directory from outside this class</span>
<span class="sd">    will create a file that cannot be compiled.  Should add the check to</span>
<span class="sd">    the write method or to the on_modelx method.</span>

<span class="sd">    - PDB:April 5, 2015</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">model_list</span><span class="o">=</span><span class="p">[],</span> <span class="n">plugin_dir</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This class is run when instatiated.  The __init__ initializes and</span>
<span class="sd">        calls the internal methods necessary.  On exiting the wx.Dialog</span>
<span class="sd">        window should be destroyed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span>
                           <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">PNL_WIDTH</span><span class="p">,</span> <span class="n">PNL_HEIGHT</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">base</span>
        <span class="c">#Font</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetWindowVariant</span><span class="p">(</span><span class="n">variant</span><span class="o">=</span><span class="n">FONT_VARIANT</span><span class="p">)</span>
        <span class="c"># default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overwrite_name</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span> <span class="o">=</span> <span class="n">plugin_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_list</span> <span class="o">=</span> <span class="n">model_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model1_string</span> <span class="o">=</span> <span class="s">&quot;SphereModel&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model2_string</span> <span class="o">=</span> <span class="s">&quot;CylinderModel&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Sum&#39;</span> <span class="o">+</span> <span class="n">M_NAME</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="s">&#39;scale_factor&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_notes</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operator</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operator_choice</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanationctr</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_sizer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc_sizer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc_tcl</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_box</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model1</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model2</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">static_line_1</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_box</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_sizer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cm_list</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_p1_custom</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_p2_custom</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_build_sizer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model1_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model1</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model2_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model2</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">good_name</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_oprator_combox</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_layout_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do the layout for file/function name related widgets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#container for new model name input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

        <span class="c">#set up label and input box with tool tip and event handling</span>
        <span class="n">name_txt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Function Name : &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s">&#39;MySumFunction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_change_name</span><span class="p">)</span>
        <span class="n">hint_name</span> <span class="o">=</span> <span class="s">&quot;Unique Sum/Multiply Model Function Name.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">hint_name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name_sizer</span><span class="o">.</span><span class="n">AddMany</span><span class="p">([(</span><span class="n">name_txt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span>
                                  <span class="mi">10</span><span class="p">)])</span>


    <span class="k">def</span> <span class="nf">_layout_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do the layout for description related widgets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#container for new model description input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

        <span class="c">#set up description label and input box with tool tip and event handling</span>
        <span class="n">desc_txt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Description (optional) : &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc_tcl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">hint_desc</span> <span class="o">=</span> <span class="s">&quot;Write a short description of this model function.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc_tcl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">hint_desc</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">desc_sizer</span><span class="o">.</span><span class="n">AddMany</span><span class="p">([(</span><span class="n">desc_txt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">desc_tcl</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span>
                                  <span class="mi">10</span><span class="p">)])</span>


    <span class="k">def</span> <span class="nf">_layout_model_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do the layout for model selection related widgets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">box_width</span> <span class="o">=</span> <span class="mi">195</span> <span class="c"># combobox width</span>

        <span class="c">#First set up main sizer for the selection</span>
        <span class="n">selection_box_title</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Select&#39;</span><span class="p">,</span>
                                           <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">PNL_WIDTH</span> <span class="o">-</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">70</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_box</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticBoxSizer</span><span class="p">(</span><span class="n">selection_box_title</span><span class="p">,</span>
                                                <span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>

        <span class="c">#Next create the help labels for the model selection</span>
        <span class="n">select_help_box</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">model_string</span> <span class="o">=</span> <span class="s">&quot; Model</span><span class="si">%s</span><span class="s"> (p</span><span class="si">%s</span><span class="s">):&quot;</span>
        <span class="n">select_help_box</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">model_string</span> <span class="o">%</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
                            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">select_help_box</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="n">box_width</span> <span class="o">-</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">select_help_box</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">model_string</span> <span class="o">%</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_box</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">select_help_box</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c">#Next create the actual selection box with 3 combo boxes</span>
        <span class="n">selection_box_choose</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_model1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model1</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="n">box_width</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model1</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s">&quot;model1&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_operator_choice</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_choice</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_select_operator</span><span class="p">)</span>
        <span class="n">operation_tip</span> <span class="o">=</span> <span class="s">&quot;Add: +, Multiply: * &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operator_choice</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">operation_tip</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_model2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model2</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">((</span><span class="n">box_width</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model2</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s">&quot;model2&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_model_list</span><span class="p">()</span>

        <span class="n">selection_box_choose</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">selection_box_choose</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">selection_box_choose</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator_choice</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">selection_box_choose</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">selection_box_choose</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c"># add some space between labels and selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_box</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_selection_box</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">selection_box_choose</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_build_sizer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Build GUI with calls to _layout_name, _layout Description</span>
<span class="sd">        and _layout_model_selection which each build a their portion of the</span>
<span class="sd">        GUI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mainsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span> <span class="c"># create main sizer for dialog</span>

        <span class="c"># build fromm top by calling _layout_name and _layout_description</span>
        <span class="c"># and adding to main sizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_name</span><span class="p">()</span>
        <span class="n">mainsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_sizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_description</span><span class="p">()</span>
        <span class="n">mainsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">desc_sizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>

        <span class="c"># Add an explanation of dialog (short help)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanationctr</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">explanation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_explanation_helpstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_operator</span><span class="p">)</span>
        <span class="n">mainsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanationctr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>

        <span class="c"># Add the selection box stuff with border and labels built</span>
        <span class="c"># by _layout_model_selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_model_selection</span><span class="p">()</span>
        <span class="n">mainsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_selection_box</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>

        <span class="c"># Add a space and horizontal line before the notification</span>
        <span class="c">#messages and the buttons at the bottom</span>
        <span class="n">mainsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">static_line_1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticLine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mainsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">static_line_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="c"># Add action status notification line (null at startup)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_box</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg_box</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">mainsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg_sizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                      <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ADJUST_MINSIZE</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="c"># Finally add the buttons (apply and close) on the bottom</span>
        <span class="c"># Eventually need to add help here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">,</span> <span class="s">&#39;Apply&#39;</span><span class="p">)</span>
        <span class="n">_app_tip</span> <span class="o">=</span> <span class="s">&quot;Save the new Model.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">_app_tip</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;HELP&#39;</span><span class="p">)</span>
        <span class="n">_app_tip</span> <span class="o">=</span> <span class="s">&quot;Help on composite model creation.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_button</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">_app_tip</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_button</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_help</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">,</span> <span class="s">&#39;Close&#39;</span><span class="p">)</span>
        <span class="n">sizer_button</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">sizer_button</span><span class="o">.</span><span class="n">AddMany</span><span class="p">([((</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ok_button</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help_button</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close_button</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span> <span class="mi">10</span><span class="p">)])</span>
        <span class="n">mainsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sizer_button</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainsizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Centre</span><span class="p">()</span>

<div class="viewcode-block" id="TextDialog.on_change_name"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.on_change_name">[docs]</a>    <span class="k">def</span> <span class="nf">on_change_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s">&#39;white&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TextDialog.check_name"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.check_name">[docs]</a>    <span class="k">def</span> <span class="nf">check_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that proposed new model name is a valid Python module name</span>
<span class="sd">        and that it does not already exist. If not show error message and</span>
<span class="sd">        pink background in text box else call on_apply</span>

<span class="sd">        :TODO this should be separated out from the GUI code.  For that we</span>
<span class="sd">        need to pass it the name (or if we want to keep the default name</span>
<span class="sd">        option also need to pass the self._operator attribute) We just need</span>
<span class="sd">        the function to return an error code that the name is good or if</span>
<span class="sd">        not why (not a valid name, name exists already).  The rest of the</span>
<span class="sd">        error handling should be done in this module. so on_apply would then</span>
<span class="sd">        start by checking the name and then either raise errors or do the</span>
<span class="sd">        deed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#Get the function/file name</span>
        <span class="n">mname</span> <span class="o">=</span> <span class="n">M_NAME</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_change_name</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operator</span>
            <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mname</span> <span class="o">=</span> <span class="s">&#39;Sum&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">mname</span> <span class="o">=</span> <span class="s">&#39;Multi&#39;</span>
            <span class="n">mname</span> <span class="o">+=</span> <span class="n">M_NAME</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">mname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">title</span>
        <span class="n">t_fname</span> <span class="o">=</span> <span class="n">title</span> <span class="o">+</span> <span class="s">&#39;.py&#39;</span>

        <span class="c">#First check if the name is a valid Python name</span>
        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^[A-Za-z0-9_]*$&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">good_name</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">good_name</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> is not a valid Python name. Only alphanumeric </span><span class="se">\n</span><span class="s">&quot;</span> \
                   <span class="s">&quot;and underscore allowed&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c">#Now check if the name already exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">overwrite_name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">good_name</span><span class="p">:</span>
            <span class="c">#Create list of existing model names for comparison</span>
            <span class="n">list_fnames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span><span class="p">)</span>
            <span class="c"># fake existing regular model name list</span>
            <span class="n">m_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">model</span> <span class="o">+</span> <span class="s">&quot;.py&quot;</span> <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_list</span><span class="p">]</span>
            <span class="n">list_fnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_list</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">t_fname</span> <span class="ow">in</span> <span class="n">list_fnames</span> <span class="ow">and</span> <span class="n">title</span> <span class="o">!=</span> <span class="n">mname</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">good_name</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Name exists already.&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">good_name</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s">&#39;pink&#39;</span><span class="p">)</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;Error&#39;</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">MessageBox</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_notes</span> <span class="o">=</span> <span class="n">msg</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;red&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_msg_box</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_msg_box</span><span class="o">.</span><span class="n">SetForegroundColour</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">good_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span><span class="p">,</span> <span class="n">t_fname</span><span class="p">)</span>
        <span class="n">s_title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">s_title</span> <span class="o">=</span> <span class="n">title</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">19</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;...&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_notes</span> <span class="o">=</span> <span class="s">&quot;Model function (</span><span class="si">%s</span><span class="s">) has been set! </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">s_title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">good_name</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_apply</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">good_name</span>
</div>
<div class="viewcode-block" id="TextDialog.on_apply"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.on_apply">[docs]</a>    <span class="k">def</span> <span class="nf">on_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is a misnomer - it is not bound to the apply button</span>
<span class="sd">        event.  Instead the apply button event goes to check_name which</span>
<span class="sd">        then calls this method if the name of the new file is acceptable.</span>

<span class="sd">        :TODO this should be bound to the apply button.  The first line</span>
<span class="sd">        should call the check_name method which itself should be in another</span>
<span class="sd">        module separated from the the GUI modules.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s">&#39;white&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_textnames</span><span class="p">()</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">path</span>
            <span class="n">name1</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">name2</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">write_string</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compile_file</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">update_custom_combo</span><span class="p">()</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notes</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;Info&#39;</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;blue&#39;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Easy Custom Sum/Multipy: Error occurred...&quot;</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;Error&#39;</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;red&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_box</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_box</span><span class="o">.</span><span class="n">SetForegroundColour</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">sas.guiframe.events</span> <span class="kn">import</span> <span class="n">StatusEvent</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span>
                                                         <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span>
</div>
<div class="viewcode-block" id="TextDialog.on_help"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.on_help">[docs]</a>    <span class="k">def</span> <span class="nf">on_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bring up the Composite Model Editor Documentation whenever</span>
<span class="sd">        the HELP button is clicked.</span>

<span class="sd">        Calls DocumentationWindow with the path of the location within the</span>
<span class="sd">        documentation tree (after /doc/ ....&quot;.  Note that when using old</span>
<span class="sd">        versions of Wx (before 2.9) and thus not the release version of</span>
<span class="sd">        installers, the help comes up at the top level of the file as</span>
<span class="sd">        webbrowser does not pass anything past the # to the browser when it is</span>
<span class="sd">        running &quot;file:///....&quot;</span>

<span class="sd">    :param evt: Triggers on clicking the help button</span>
<span class="sd">    &quot;&quot;&quot;</span>

        <span class="n">_TreeLocation</span> <span class="o">=</span> <span class="s">&quot;user/perspectives/fitting/fitting_help.html&quot;</span>
        <span class="n">_PageAnchor</span> <span class="o">=</span> <span class="s">&quot;#sum-multi-p1-p2&quot;</span>
        <span class="n">_doc_viewer</span> <span class="o">=</span> <span class="n">DocumentationWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">_TreeLocation</span><span class="p">,</span> <span class="n">_PageAnchor</span><span class="p">,</span>
                                          <span class="s">&quot;Composite Model Editor Help&quot;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_set_model_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the list of models</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># list of model names</span>
        <span class="c"># get regular models</span>
        <span class="n">main_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_list</span>
        <span class="c"># get custom models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_cm_list</span><span class="p">()</span>
        <span class="c"># add custom models to model list</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cm_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">main_list</span><span class="p">:</span>
                <span class="n">main_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">main_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">main_list</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">main_list</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model1</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">main_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]),</span> <span class="n">idx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model2</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">main_list</span><span class="p">[</span><span class="n">idx</span><span class="p">]),</span> <span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model1</span><span class="o">.</span><span class="n">SetStringSelection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model1_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model2</span><span class="o">.</span><span class="n">SetStringSelection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model2_string</span><span class="p">)</span>

<div class="viewcode-block" id="TextDialog.update_cm_list"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.update_cm_list">[docs]</a>    <span class="k">def</span> <span class="nf">update_cm_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update custom model list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cm_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">al_list</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plugin_dir</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c_name</span> <span class="ow">in</span> <span class="n">al_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;py&#39;</span> <span class="ow">and</span> \
                    <span class="n">c_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;__init__&#39;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">c_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">cm_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cm_list</span> <span class="o">=</span> <span class="n">cm_list</span>
</div>
<div class="viewcode-block" id="TextDialog.on_model1"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.on_model1">[docs]</a>    <span class="k">def</span> <span class="nf">on_model1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set model1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_cm_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model1_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model1</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model1_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model1_name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model1_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cm_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_p1_custom</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_p1_custom</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="TextDialog.on_model2"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.on_model2">[docs]</a>    <span class="k">def</span> <span class="nf">on_model2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set model2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_cm_list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model2_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model2</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model2_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model2_name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model2_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cm_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_p2_custom</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_p2_custom</span> <span class="o">=</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="TextDialog.on_select_operator"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.on_select_operator">[docs]</a>    <span class="k">def</span> <span class="nf">on_select_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        On Select an Operator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># For Mac</span>
        <span class="k">if</span> <span class="n">event</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_explanation_helpstring</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TextDialog.fill_explanation_helpstring"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.fill_explanation_helpstring">[docs]</a>    <span class="k">def</span> <span class="nf">fill_explanation_helpstring</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Choose the equation to use depending on whether we now have</span>
<span class="sd">        a sum or multiply model then create the appropriate string</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s">&#39;*&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Multi&#39;</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="s">&#39;BackGround&#39;</span>
            <span class="n">f_oper</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Sum&#39;</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="s">&#39;scale_factor&#39;</span>
            <span class="n">f_oper</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operator</span> <span class="o">=</span> <span class="n">operator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanation</span> <span class="o">=</span> <span class="s">&quot;  Custom Model = </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> (model1 </span><span class="si">%s</span><span class="s"> model2)</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> \
                           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">factor</span><span class="p">,</span> <span class="n">f_oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">explanationctr</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">explanation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="n">M_NAME</span>

</div>
<div class="viewcode-block" id="TextDialog.fill_oprator_combox"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.fill_oprator_combox">[docs]</a>    <span class="k">def</span> <span class="nf">fill_oprator_combox</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        fill the current combobox with the operator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">operator_list</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39; +&#39;</span><span class="p">,</span> <span class="s">&#39; *&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">oper</span> <span class="ow">in</span> <span class="n">operator_list</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operator_choice</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">oper</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_operator_choice</span><span class="o">.</span><span class="n">SetClientData</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">oper</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operator_choice</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TextDialog.get_textnames"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.get_textnames">[docs]</a>    <span class="k">def</span> <span class="nf">get_textnames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns model name string as list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model1_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model2_name</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="TextDialog.write_string"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.write_string">[docs]</a>    <span class="k">def</span> <span class="nf">write_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">name1</span><span class="p">,</span> <span class="n">name2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write and Save file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span>
        <span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc_tcl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">description</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">name1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operator</span> <span class="o">+</span> <span class="n">name2</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operator_choice</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">text</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="s">&#39;scale_factor&#39;</span>
            <span class="n">f_oper</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span>
            <span class="n">default_val</span> <span class="o">=</span> <span class="s">&#39;1.0&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="s">&#39;BackGround&#39;</span>
            <span class="n">f_oper</span> <span class="o">=</span> <span class="s">&#39;+&#39;</span>
            <span class="n">default_val</span> <span class="o">=</span> <span class="s">&#39;0.0&#39;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out_f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">SUM_TEMPLATE</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;scale_factor&quot;</span><span class="p">):</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;scale_factor&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
                    <span class="c">#print &quot;scale_factor&quot;, line</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;= </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">):</span>
                    <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">%</span> <span class="p">(</span><span class="n">default_val</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;import Model as P1&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_p1_custom</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                        <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">%</span> <span class="n">name1</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;import </span><span class="si">%s</span><span class="s"> as P1&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_p1_custom</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                        <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">%</span> <span class="p">(</span><span class="n">name1</span><span class="p">,</span> <span class="n">name1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;import Model as P2&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_p2_custom</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                        <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">%</span> <span class="n">name2</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;import </span><span class="si">%s</span><span class="s"> as P2&quot;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_p2_custom</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
                        <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">%</span> <span class="p">(</span><span class="n">name2</span><span class="p">,</span> <span class="n">name2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;self.description = &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="p">):</span>
                    <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">%</span> <span class="n">description</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="c">#elif line.count(&quot;run&quot;) and line.count(&quot;%s&quot;):</span>
                <span class="c">#    out_f.write(line % self._operator + &quot;\n&quot;)</span>
                <span class="c">#elif line.count(&quot;evalDistribution&quot;) and line.count(&quot;%s&quot;):</span>
                <span class="c">#    out_f.write(line % self._operator + &quot;\n&quot;)</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;return&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="c">#print &quot;line return&quot;, line</span>
                    <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">%</span> <span class="p">(</span><span class="n">f_oper</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operator</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;out2&quot;</span><span class="p">)</span><span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="p">):</span>
                    <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operator</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="n">out_f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c">#else:</span>
        <span class="c">#    msg = &quot;Name exists already.&quot;</span>
</div>
<div class="viewcode-block" id="TextDialog.compile_file"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.compile_file">[docs]</a>    <span class="k">def</span> <span class="nf">compile_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compile the file in the path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fname</span>
        <span class="n">_compile_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="TextDialog.delete_file"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.TextDialog.delete_file">[docs]</a>    <span class="k">def</span> <span class="nf">delete_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete file in the path</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_delete_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="EditorPanel"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorPanel">[docs]</a><span class="k">class</span> <span class="nc">EditorPanel</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ScrolledWindow</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom model function editor</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="n">kwds</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>
<span class="c">#        kwds[&quot;size&quot;] = (EDITOR_WIDTH, EDITOR_HEIGTH)</span>
        <span class="n">kwds</span><span class="p">[</span><span class="s">&quot;style&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FULL_REPAINT_ON_RESIZE</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">ScrolledWindow</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetScrollbars</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">=</span> <span class="n">base</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SystemSettings_GetFont</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">SYS_SYSTEM_FONT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="o">.</span><span class="n">SetPointSize</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;untitled&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overwrite_name</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_2d</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_sizer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_sizer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_hsizer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc_sizer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc_tcl</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_sizer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_tcl</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_sizer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func_horizon_sizer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_sizer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_strings</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_strings</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_notes</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_box</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_sizer</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warning</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_description</span> <span class="o">=</span> <span class="s">&quot;New Custom Model&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_tcl</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">math_combo</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bt_apply</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bt_close</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c">#self._default_save_location = os.getcwd()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_layout</span><span class="p">()</span>



    <span class="k">def</span> <span class="nf">_define_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        define initial sizer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#w, h = self.parent.GetSize()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_hsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func_horizon_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">button_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_layout_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do the layout for file/function name related widgets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#title name [string]</span>
        <span class="n">name_txt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Function Name : &#39;</span><span class="p">)</span>
        <span class="n">overwrite_cb</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Overwrite?&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">overwrite_cb</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">overwrite_cb</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s">&quot;Overwrite it if already exists?&quot;</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overwrite_cb</span><span class="o">.</span><span class="n">GetId</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_over_cb</span><span class="p">)</span>
        <span class="c">#overwrite_cb.Show(False)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">PANEL_WIDTH</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_change_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;MyFunction&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">font</span><span class="p">)</span>
        <span class="n">hint_name</span> <span class="o">=</span> <span class="s">&quot;Unique Model Function Name.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">hint_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_hsizer</span><span class="o">.</span><span class="n">AddMany</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                                  <span class="p">(</span><span class="n">overwrite_cb</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="mi">20</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_sizer</span><span class="o">.</span><span class="n">AddMany</span><span class="p">([(</span><span class="n">name_txt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_hsizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span> <span class="mi">10</span><span class="p">)])</span>


    <span class="k">def</span> <span class="nf">_layout_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do the layout for description related widgets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#title name [string]</span>
        <span class="n">desc_txt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Description (optional) : &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc_tcl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">PANEL_WIDTH</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc_tcl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">hint_desc</span> <span class="o">=</span> <span class="s">&quot;Write a short description of the model function.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc_tcl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">hint_desc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">desc_sizer</span><span class="o">.</span><span class="n">AddMany</span><span class="p">([(</span><span class="n">desc_txt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">desc_tcl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TOP</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span> <span class="mi">10</span><span class="p">)])</span>
    <span class="k">def</span> <span class="nf">_layout_param</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do the layout for parameter related widgets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_txt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Fit Parameters (if any): &#39;</span><span class="p">)</span>

        <span class="n">param_tip</span> <span class="o">=</span> <span class="s">&quot;#Set the parameters and initial values.</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">param_tip</span> <span class="o">+=</span> <span class="s">&quot;#Example:</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">param_tip</span> <span class="o">+=</span> <span class="s">&quot;A = 1</span><span class="se">\n</span><span class="s">B = 1&quot;</span>
        <span class="c">#param_txt.SetToolTipString(param_tip)</span>
        <span class="n">newid</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_tcl</span> <span class="o">=</span> <span class="n">EditWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newid</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">DefaultPosition</span><span class="p">,</span>
                                    <span class="n">wx</span><span class="o">.</span><span class="n">DefaultSize</span><span class="p">,</span>
                                    <span class="n">wx</span><span class="o">.</span><span class="n">CLIP_CHILDREN</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_tcl</span><span class="o">.</span><span class="n">setDisplayLineNumbers</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_tcl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">param_tip</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">param_sizer</span><span class="o">.</span><span class="n">AddMany</span><span class="p">([(</span><span class="n">param_txt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                                  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_tcl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">10</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">_layout_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do the layout for function related widgets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">function_txt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Function(x) : &#39;</span><span class="p">)</span>
        <span class="n">hint_function</span> <span class="o">=</span> <span class="s">&quot;#Example:</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">hint_function</span> <span class="o">+=</span> <span class="s">&quot;if x &lt;= 0:</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">hint_function</span> <span class="o">+=</span> <span class="s">&quot;    y = A + B</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">hint_function</span> <span class="o">+=</span> <span class="s">&quot;else:</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">hint_function</span> <span class="o">+=</span> <span class="s">&quot;    y = A + B * cos(2 * pi * x)</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">hint_function</span> <span class="o">+=</span> <span class="s">&quot;return y</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="n">math_txt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;*Useful math functions: &#39;</span><span class="p">)</span>
        <span class="n">math_combo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_math_combo</span><span class="p">()</span>

        <span class="n">newid</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_tcl</span> <span class="o">=</span> <span class="n">EditWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newid</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">DefaultPosition</span><span class="p">,</span>
                                       <span class="n">wx</span><span class="o">.</span><span class="n">DefaultSize</span><span class="p">,</span>
                                       <span class="n">wx</span><span class="o">.</span><span class="n">CLIP_CHILDREN</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_tcl</span><span class="o">.</span><span class="n">setDisplayLineNumbers</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_tcl</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">hint_function</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">func_horizon_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">function_txt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func_horizon_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">math_txt</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func_horizon_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">math_combo</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">function_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func_horizon_sizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_tcl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_layout_msg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Layout msg</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_box</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notes</span><span class="p">,</span>
                                      <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">PANEL_WIDTH</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg_sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msg_box</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_layout_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do the layout for the button widgets</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bt_apply</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Apply&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">_BOX_WIDTH</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bt_apply</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s">&quot;Save changes into the imported data.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bt_apply</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_click_apply</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bt_help</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;HELP&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">_BOX_WIDTH</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bt_help</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s">&quot;Get Help For Model Editor&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bt_help</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_help</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bt_close</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&#39;Close&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">_BOX_WIDTH</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bt_close</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_close</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bt_close</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s">&quot;Close this panel.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">button_sizer</span><span class="o">.</span><span class="n">AddMany</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">bt_apply</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span> <span class="n">EDITOR_WIDTH</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">),</span>
                                   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bt_help</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span>
                                   <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bt_close</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                    <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="p">,</span> <span class="mi">15</span><span class="p">)])</span>

    <span class="k">def</span> <span class="nf">_do_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Draw the current panel</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_define_structure</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_name</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_description</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_param</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_function</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_msg</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_layout_button</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main_sizer</span><span class="o">.</span><span class="n">AddMany</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_sizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticLine</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">desc_sizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticLine</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param_sizer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticLine</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_sizer</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
                                  <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                 <span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticLine</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span>
                                  <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">msg_sizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">button_sizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main_sizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetAutoLayout</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_fill_math_combo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fill up the math combo box</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">math_combo</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                      <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">math</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">exec</span> <span class="s">&quot;float(math.</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">item</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">math_combo</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">math_combo</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;()&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">math_combo</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_on_math_select</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">math_combo</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">math_combo</span>

    <span class="k">def</span> <span class="nf">_on_math_select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        On math selection on ComboBox</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">math_combo</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_tcl</span><span class="o">.</span><span class="n">SetFocus</span><span class="p">()</span>
        <span class="c"># Put the text at the cursor position</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_tcl</span><span class="o">.</span><span class="n">GetCurrentPos</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_tcl</span><span class="o">.</span><span class="n">InsertText</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="c"># Put the cursor at appropriate position</span>
        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">length</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">[</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;)&#39;</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">f_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">length</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_tcl</span><span class="o">.</span><span class="n">GotoPos</span><span class="p">(</span><span class="n">f_pos</span><span class="p">)</span>

<div class="viewcode-block" id="EditorPanel.get_notes"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorPanel.get_notes">[docs]</a>    <span class="k">def</span> <span class="nf">get_notes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return notes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notes</span>
</div>
<div class="viewcode-block" id="EditorPanel.on_change_name"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorPanel.on_change_name">[docs]</a>    <span class="k">def</span> <span class="nf">on_change_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s">&#39;white&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="EditorPanel.check_name"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorPanel.check_name">[docs]</a>    <span class="k">def</span> <span class="nf">check_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check name if exist already</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_notes</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_change_name</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="n">plugin_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="n">list_fnames</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">plugin_dir</span><span class="p">)</span>
        <span class="c"># function/file name</span>
        <span class="n">title</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">title</span>
        <span class="n">t_fname</span> <span class="o">=</span> <span class="n">title</span> <span class="o">+</span> <span class="s">&#39;.py&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">overwrite_name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t_fname</span> <span class="ow">in</span> <span class="n">list_fnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s">&#39;pink&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plugin_dir</span><span class="p">,</span> <span class="n">t_fname</span><span class="p">)</span>
        <span class="n">s_title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">s_title</span> <span class="o">=</span> <span class="n">title</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">19</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;...&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_notes</span> <span class="o">+=</span> <span class="s">&quot;Model function name is set &quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_notes</span> <span class="o">+=</span> <span class="s">&quot;to </span><span class="si">%s</span><span class="s">. </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">s_title</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="EditorPanel.on_over_cb"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorPanel.on_over_cb">[docs]</a>    <span class="k">def</span> <span class="nf">on_over_cb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set overwrite name flag on cb event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="n">cb_value</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overwrite_name</span> <span class="o">=</span> <span class="n">cb_value</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="EditorPanel.on_click_apply"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorPanel.on_click_apply">[docs]</a>    <span class="k">def</span> <span class="nf">on_click_apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes are saved in data object imported to edit.</span>

<span class="sd">        checks firs for valid name, then if it already exists then checks</span>
<span class="sd">        that a function was entered and finally that if entered it contains at</span>
<span class="sd">        least a return statement.  If all passes writes file then tries to</span>
<span class="sd">        compile.  If compile fails or import module fails or run method fails</span>
<span class="sd">        tries to remove any .py and pyc files that may have been created and</span>
<span class="sd">        sets error message.</span>

<span class="sd">        :todo this code still could do with a careful going over to clean</span>
<span class="sd">        up and simplify. the non GUI methods such as this one should be removed</span>
<span class="sd">        to computational code of SasView. Most of those computational methods</span>
<span class="sd">        would be the same for both the simple editors.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#must post event here</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_tcl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;Info&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="c"># Sort out the errors if occur</span>
        <span class="c"># First check for valid python name then if the name already exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">&#39;^[A-Za-z0-9_]*$&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;not a valid python name. Name must include only alpha </span><span class="se">\n</span><span class="s">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;numeric or underline characters and no spaces&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_name</span><span class="p">():</span>
            <span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">desc_tcl</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="n">param_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_tcl</span><span class="o">.</span><span class="n">GetText</span><span class="p">()</span>
            <span class="n">func_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_tcl</span><span class="o">.</span><span class="n">GetText</span><span class="p">()</span>
            <span class="c"># No input for the model function</span>
            <span class="k">if</span> <span class="n">func_str</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">func_str</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;return&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">write_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">param_str</span><span class="p">,</span>
                                    <span class="n">func_str</span><span class="p">)</span>
                    <span class="n">tr_msg</span> <span class="o">=</span> <span class="n">_compile_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tr_msg</span><span class="o">.</span><span class="n">__str__</span><span class="p">())</span>
                    <span class="c"># Compile error</span>
                    <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
                        <span class="n">msg</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;  &quot;</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                        <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Compiling Failed&quot;</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c"># try to remove pyc file if exists</span>
                            <span class="n">_delete_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span><span class="p">)</span>
                            <span class="n">_delete_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">+</span> <span class="s">&quot;c&quot;</span><span class="p">)</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Error: The func(x) must &#39;return&#39; a value at least.</span><span class="se">\n</span><span class="s">&quot;</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;For example: </span><span class="se">\n\n</span><span class="s">return 2*x&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Error: Function is not defined.&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Name exists already.&quot;</span>
        <span class="c"># Prepare the messagebox</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">msg</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">update_custom_combo</span><span class="p">()</span>
            <span class="n">Model</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">exec</span> <span class="s">&quot;from </span><span class="si">%s</span><span class="s"> import Model&quot;</span> <span class="o">%</span> <span class="n">name</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;new model fails to import in python&#39;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c"># try to remove pyc file if exists</span>
                    <span class="n">_delete_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">+</span> <span class="s">&quot;c&quot;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">msg</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Model</span><span class="p">()</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;new model fails on run method:&quot;</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;in </span><span class="si">%s</span><span class="s">:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c"># try to remove pyc file if exists</span>
                    <span class="n">_delete_file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fname</span> <span class="o">+</span> <span class="s">&quot;c&quot;</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>
        <span class="c"># Prepare the messagebox</span>
        <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;Error&#39;</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;red&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&quot;Successful! &quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot;  &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notes</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s">&quot; Please look for it in the Customized Models.&quot;</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;Info&#39;</span>
            <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;blue&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_box</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msg_box</span><span class="o">.</span><span class="n">SetForegroundColour</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>
        <span class="c"># Send msg to the top window</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">base</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">sas.guiframe.events</span> <span class="kn">import</span> <span class="n">StatusEvent</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">PostEvent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">StatusEvent</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">info</span><span class="o">=</span><span class="n">info</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warning</span> <span class="o">=</span> <span class="n">msg</span>

</div>
<div class="viewcode-block" id="EditorPanel.write_file"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorPanel.write_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">desc_str</span><span class="p">,</span> <span class="n">param_str</span><span class="p">,</span> <span class="n">func_str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write content in file</span>

<span class="sd">        :param fname: full file path</span>
<span class="sd">        :param desc_str: content of the description strings</span>
<span class="sd">        :param param_str: content of params; Strings</span>
<span class="sd">        :param func_str: content of func; Strings</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">out_f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span>
        <span class="c"># Prepare the content of the function</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">CUSTOM_TEMPLATE</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="n">has_scipy</span> <span class="o">=</span> <span class="n">func_str</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;scipy.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_2d</span> <span class="o">=</span> <span class="n">func_str</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;#self.ndim = 2&quot;</span><span class="p">)</span>
        <span class="n">line_2d</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_2d</span><span class="p">:</span>
            <span class="n">line_2d</span> <span class="o">=</span> <span class="n">CUSTOM_2D_TEMP</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">line_test</span> <span class="o">=</span> <span class="n">TEST_TEMPLATE</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">local_params</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">spaces</span> <span class="o">=</span> <span class="s">&#39;        &#39;</span><span class="c">#8spaces</span>
        <span class="c"># write function here</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="c"># The location where to put the strings is</span>
            <span class="c"># hard-coded in the template as shown below.</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;#self.params here&quot;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">param_line</span> <span class="ow">in</span> <span class="n">param_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                    <span class="n">p_line</span> <span class="o">=</span> <span class="n">param_line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">p_line</span><span class="p">:</span>
                        <span class="n">p0_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_param_helper</span><span class="p">(</span><span class="n">p_line</span><span class="p">)</span>
                        <span class="n">local_params</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_function_helper</span><span class="p">(</span><span class="n">p_line</span><span class="p">)</span>
                        <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">p0_line</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;#local params here&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">local_params</span><span class="p">:</span>
                    <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">local_params</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;self.description = &quot;</span><span class="p">):</span>
                <span class="n">des0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\\</span><span class="s">n&quot;</span>
                <span class="n">desc</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">desc_str</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\&quot;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
                <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">%</span> <span class="p">(</span><span class="n">des0</span> <span class="o">+</span> <span class="n">desc</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;def function(self, x=0.0</span><span class="si">%s</span><span class="s">):&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_2d</span><span class="p">:</span>
                    <span class="n">y_str</span> <span class="o">=</span> <span class="s">&#39;, y=0.0&#39;</span>
                    <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">%</span> <span class="n">y_str</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">%</span> <span class="s">&#39;&#39;</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;#function here&quot;</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">func_line</span> <span class="ow">in</span> <span class="n">func_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">):</span>
                    <span class="n">f_line</span> <span class="o">=</span> <span class="n">func_line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">f_line</span><span class="p">:</span>
                        <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">spaces</span> <span class="o">+</span> <span class="n">f_line</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">func_str</span><span class="p">:</span>
                    <span class="n">dep_var</span> <span class="o">=</span> <span class="s">&#39;y&#39;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_2d</span><span class="p">:</span>
                        <span class="n">dep_var</span> <span class="o">=</span> <span class="s">&#39;z&#39;</span>
                    <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">spaces</span> <span class="o">+</span> <span class="s">&#39;return </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">dep_var</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&quot;#import scipy?&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">has_scipy</span><span class="p">:</span>
                    <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;import scipy&quot;</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
            <span class="c">#elif line.count(&quot;name = &quot;):</span>
            <span class="c">#    out_f.write(line % self.name + &quot;\n&quot;)</span>
            <span class="k">elif</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="c"># run string for 2d</span>
        <span class="k">if</span> <span class="n">line_2d</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_2d</span><span class="p">:</span>
                <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="c"># Test strins</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_test</span><span class="p">:</span>
            <span class="n">out_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>

        <span class="n">out_f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="EditorPanel.set_param_helper"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorPanel.set_param_helper">[docs]</a>    <span class="k">def</span> <span class="nf">set_param_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get string in line to define the params dictionary</span>

<span class="sd">        :param line: one line of string got from the param_str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">spaces</span> <span class="o">=</span> <span class="s">&#39;        &#39;</span><span class="c">#8spaces</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c"># default</span>
            <span class="n">params_str</span> <span class="o">+=</span> <span class="n">spaces</span> <span class="o">+</span> <span class="s">&quot;self.params[&#39;</span><span class="si">%s</span><span class="s">&#39;] = </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">params_str</span>
</div>
<div class="viewcode-block" id="EditorPanel.set_function_helper"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorPanel.set_function_helper">[docs]</a>    <span class="k">def</span> <span class="nf">set_function_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get string in line to define the local params</span>

<span class="sd">        :param line: one line of string got from the param_str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params_str</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">spaces</span> <span class="o">=</span> <span class="s">&#39;        &#39;</span><span class="c">#8spaces</span>
        <span class="n">items</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="n">params_str</span> <span class="o">+=</span> <span class="n">spaces</span> <span class="o">+</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> = self.params[&#39;</span><span class="si">%s</span><span class="s">&#39;]</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">params_str</span>
</div>
<div class="viewcode-block" id="EditorPanel.get_warning"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorPanel.get_warning">[docs]</a>    <span class="k">def</span> <span class="nf">get_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the warning msg</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">warning</span>
</div>
<div class="viewcode-block" id="EditorPanel.on_help"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorPanel.on_help">[docs]</a>    <span class="k">def</span> <span class="nf">on_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bring up the Custom Model Editor Documentation whenever</span>
<span class="sd">        the HELP button is clicked.</span>

<span class="sd">        Calls DocumentationWindow with the path of the location within the</span>
<span class="sd">        documentation tree (after /doc/ ....&quot;.  Note that when using old</span>
<span class="sd">        versions of Wx (before 2.9) and thus not the release version of</span>
<span class="sd">        installers, the help comes up at the top level of the file as</span>
<span class="sd">        webbrowser does not pass anything past the # to the browser when it is</span>
<span class="sd">        running &quot;file:///....&quot;</span>

<span class="sd">    :param evt: Triggers on clicking the help button</span>
<span class="sd">    &quot;&quot;&quot;</span>

        <span class="n">_TreeLocation</span> <span class="o">=</span> <span class="s">&quot;user/perspectives/fitting/fitting_help.html&quot;</span>
        <span class="n">_PageAnchor</span> <span class="o">=</span> <span class="s">&quot;#custom-model-editor&quot;</span>
        <span class="n">_doc_viewer</span> <span class="o">=</span> <span class="n">DocumentationWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">_TreeLocation</span><span class="p">,</span> <span class="n">_PageAnchor</span><span class="p">,</span>
                                          <span class="s">&quot;Custom Model Editor Help&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="EditorPanel.on_close"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorPanel.on_close">[docs]</a>    <span class="k">def</span> <span class="nf">on_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        leave data as it is and close</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span><span class="c">#Close()</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
</div></div>
<div class="viewcode-block" id="EditorWindow"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorWindow">[docs]</a><span class="k">class</span> <span class="nc">EditorWindow</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Editor Window</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>
                 <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">EDITOR_WIDTH</span><span class="p">,</span> <span class="n">EDITOR_HEIGTH</span><span class="p">),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Init</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwds</span><span class="p">[</span><span class="s">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span>
        <span class="n">kwds</span><span class="p">[</span><span class="s">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="n">EditorPanel</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
                                 <span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_CLOSE</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_close</span><span class="p">)</span>

<div class="viewcode-block" id="EditorWindow.on_close"><a class="viewcode-back" href="../../../../dev/api/sas.perspectives.calculator.html#sas.perspectives.calculator.model_editor.EditorWindow.on_close">[docs]</a>    <span class="k">def</span> <span class="nf">on_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        On close event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="c">#if self.parent != None:</span>
        <span class="c">#    self.parent.new_model_frame = None</span>
        <span class="c">#self.Destroy()</span>

<span class="c">## Templates for custom models</span></div></div>
<span class="n">CUSTOM_TEMPLATE</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">from sas.models.pluginmodel import Model1DPlugin</span>
<span class="s">from math import *</span>
<span class="s">import os</span>
<span class="s">import sys</span>
<span class="s">import numpy</span>
<span class="s">#import scipy?</span>
<span class="s">class Model(Model1DPlugin):</span>
<span class="s">    name = &quot;&quot;</span>
<span class="s">    def __init__(self):</span>
<span class="s">        Model1DPlugin.__init__(self, name=self.name)</span>
<span class="s">        #set name same as file name</span>
<span class="s">        self.name = self.get_fname()</span>
<span class="s">        #self.params here</span>
<span class="s">        self.description = &quot;</span><span class="si">%s</span><span class="s">&quot;</span>
<span class="s">        self.set_details()</span>
<span class="s">    def function(self, x=0.0</span><span class="si">%s</span><span class="s">):</span>
<span class="s">        #local params here</span>
<span class="s">        #function here</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="n">CUSTOM_2D_TEMP</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    def run(self, x=0.0, y=0.0):</span>
<span class="s">        if x.__class__.__name__ == &#39;list&#39;:</span>
<span class="s">            x_val = x[0]</span>
<span class="s">            y_val = y[0]*0.0</span>
<span class="s">            return self.function(x_val, y_val)</span>
<span class="s">        elif x.__class__.__name__ == &#39;tuple&#39;:</span>
<span class="s">            msg = &quot;Tuples are not allowed as input to BaseComponent models&quot;</span>
<span class="s">            raise ValueError, msg</span>
<span class="s">        else:</span>
<span class="s">            return self.function(x, 0.0)</span>
<span class="s">    def runXY(self, x=0.0, y=0.0):</span>
<span class="s">        if x.__class__.__name__ == &#39;list&#39;:</span>
<span class="s">            return self.function(x, y)</span>
<span class="s">        elif x.__class__.__name__ == &#39;tuple&#39;:</span>
<span class="s">            msg = &quot;Tuples are not allowed as input to BaseComponent models&quot;</span>
<span class="s">            raise ValueError, msg</span>
<span class="s">        else:</span>
<span class="s">            return self.function(x, y)</span>
<span class="s">    def evalDistribution(self, qdist):</span>
<span class="s">        if qdist.__class__.__name__ == &#39;list&#39;:</span>
<span class="s">            msg = &quot;evalDistribution expects a list of 2 ndarrays&quot;</span>
<span class="s">            if len(qdist)!=2:</span>
<span class="s">                raise RuntimeError, msg</span>
<span class="s">            if qdist[0].__class__.__name__ != &#39;ndarray&#39;:</span>
<span class="s">                raise RuntimeError, msg</span>
<span class="s">            if qdist[1].__class__.__name__ != &#39;ndarray&#39;:</span>
<span class="s">                raise RuntimeError, msg</span>
<span class="s">            v_model = numpy.vectorize(self.runXY, otypes=[float])</span>
<span class="s">            iq_array = v_model(qdist[0], qdist[1])</span>
<span class="s">            return iq_array</span>
<span class="s">        elif qdist.__class__.__name__ == &#39;ndarray&#39;:</span>
<span class="s">            v_model = numpy.vectorize(self.runXY, otypes=[float])</span>
<span class="s">            iq_array = v_model(qdist)</span>
<span class="s">            return iq_array</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="n">TEST_TEMPLATE</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">    def get_fname(self):</span>
<span class="s">        path = sys._getframe().f_code.co_filename</span>
<span class="s">        basename  = os.path.basename(path)</span>
<span class="s">        name, _ = os.path.splitext(basename)</span>
<span class="s">        return name</span>
<span class="s">######################################################################</span>
<span class="s">## THIS IS FOR TEST. DO NOT MODIFY THE FOLLOWING LINES!!!!!!!!!!!!!!!!</span>
<span class="s">if __name__ == &quot;__main__&quot;:</span>
<span class="s">    m= Model()</span>
<span class="s">    out1 = m.runXY(0.0)</span>
<span class="s">    out2 = m.runXY(0.01)</span>
<span class="s">    isfine1 = numpy.isfinite(out1)</span>
<span class="s">    isfine2 = numpy.isfinite(out2)</span>
<span class="s">    print &quot;Testing the value at Q = 0.0:&quot;</span>
<span class="s">    print out1, &quot; : finite? &quot;, isfine1</span>
<span class="s">    print &quot;Testing the value at Q = 0.01:&quot;</span>
<span class="s">    print out2, &quot; : finite? &quot;, isfine2</span>
<span class="s">    if isfine1 and isfine2:</span>
<span class="s">        print &quot;===&gt; Simple Test: Passed!&quot;</span>
<span class="s">    else:</span>
<span class="s">        print &quot;===&gt; Simple Test: Failed!&quot;</span>
<span class="s">&quot;&quot;&quot;</span>
<span class="n">SUM_TEMPLATE</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s"># A sample of an experimental model function for Sum/Multiply(Pmodel1,Pmodel2)</span>
<span class="s">import copy</span>
<span class="s">from sas.models.pluginmodel import Model1DPlugin</span>
<span class="s"># User can change the name of the model (only with single functional model)</span>
<span class="s">#P1_model:</span>
<span class="s">#from sas.models.</span><span class="si">%s</span><span class="s"> import </span><span class="si">%s</span><span class="s"> as P1</span>
<span class="s">#from </span><span class="si">%s</span><span class="s"> import Model as P1</span>

<span class="s">#P2_model:</span>
<span class="s">#from sas.models.</span><span class="si">%s</span><span class="s"> import </span><span class="si">%s</span><span class="s"> as P2</span>
<span class="s">#from </span><span class="si">%s</span><span class="s"> import Model as P2</span>
<span class="s">import os</span>
<span class="s">import sys</span>

<span class="s">class Model(Model1DPlugin):</span>
<span class="s">    name = &quot;&quot;</span>
<span class="s">    def __init__(self):</span>
<span class="s">        Model1DPlugin.__init__(self, name=&#39;&#39;)</span>
<span class="s">        p_model1 = P1()</span>
<span class="s">        p_model2 = P2()</span>
<span class="s">        ## Setting  model name model description</span>
<span class="s">        self.description = &#39;</span><span class="si">%s</span><span class="s">&#39;</span>
<span class="s">        self.name = self.get_fname()</span>
<span class="s">        if self.name.rstrip().lstrip() == &#39;&#39;:</span>
<span class="s">            self.name = self._get_name(p_model1.name, p_model2.name)</span>
<span class="s">        if self.description.rstrip().lstrip() == &#39;&#39;:</span>
<span class="s">            self.description = p_model1.name</span>
<span class="s">            self.description += p_model2.name</span>
<span class="s">            self.fill_description(p_model1, p_model2)</span>

<span class="s">        ## Define parameters</span>
<span class="s">        self.params = {}</span>

<span class="s">        ## Parameter details [units, min, max]</span>
<span class="s">        self.details = {}</span>
<span class="s">        ## Magnetic Panrameters</span>
<span class="s">        self.magnetic_params = []</span>
<span class="s">        # non-fittable parameters</span>
<span class="s">        self.non_fittable = p_model1.non_fittable</span>
<span class="s">        self.non_fittable += p_model2.non_fittable</span>

<span class="s">        ##models</span>
<span class="s">        self.p_model1= p_model1</span>
<span class="s">        self.p_model2= p_model2</span>


<span class="s">        ## dispersion</span>
<span class="s">        self._set_dispersion()</span>
<span class="s">        ## Define parameters</span>
<span class="s">        self._set_params()</span>
<span class="s">        ## New parameter:scaling_factor</span>
<span class="s">        self.params[&#39;scale_factor&#39;] = </span><span class="si">%s</span><span class="s"></span>

<span class="s">        ## Parameter details [units, min, max]</span>
<span class="s">        self._set_details()</span>
<span class="s">        self.details[&#39;scale_factor&#39;] = [&#39;&#39;, None, None]</span>


<span class="s">        #list of parameter that can be fitted</span>
<span class="s">        self._set_fixed_params()</span>
<span class="s">        ## parameters with orientation</span>
<span class="s">        for item in self.p_model1.orientation_params:</span>
<span class="s">            new_item = &quot;p1_&quot; + item</span>
<span class="s">            if not new_item in self.orientation_params:</span>
<span class="s">                self.orientation_params.append(new_item)</span>

<span class="s">        for item in self.p_model2.orientation_params:</span>
<span class="s">            new_item = &quot;p2_&quot; + item</span>
<span class="s">            if not new_item in self.orientation_params:</span>
<span class="s">                self.orientation_params.append(new_item)</span>
<span class="s">        ## magnetic params</span>
<span class="s">        for item in self.p_model1.magnetic_params:</span>
<span class="s">            new_item = &quot;p1_&quot; + item</span>
<span class="s">            if not new_item in self.magnetic_params:</span>
<span class="s">                self.magnetic_params.append(new_item)</span>

<span class="s">        for item in self.p_model2.magnetic_params:</span>
<span class="s">            new_item = &quot;p2_&quot; + item</span>
<span class="s">            if not new_item in self.magnetic_params:</span>
<span class="s">                self.magnetic_params.append(new_item)</span>
<span class="s">        # get multiplicity if model provide it, else 1.</span>
<span class="s">        try:</span>
<span class="s">            multiplicity1 = p_model1.multiplicity</span>
<span class="s">            try:</span>
<span class="s">                multiplicity2 = p_model2.multiplicity</span>
<span class="s">            except:</span>
<span class="s">                multiplicity2 = 1</span>
<span class="s">        except:</span>
<span class="s">            multiplicity1 = 1</span>
<span class="s">            multiplicity2 = 1</span>
<span class="s">        ## functional multiplicity of the model</span>
<span class="s">        self.multiplicity1 = multiplicity1</span>
<span class="s">        self.multiplicity2 = multiplicity2</span>
<span class="s">        self.multiplicity_info = []</span>

<span class="s">    def _clone(self, obj):</span>
<span class="s">        obj.params     = copy.deepcopy(self.params)</span>
<span class="s">        obj.description     = copy.deepcopy(self.description)</span>
<span class="s">        obj.details    = copy.deepcopy(self.details)</span>
<span class="s">        obj.dispersion = copy.deepcopy(self.dispersion)</span>
<span class="s">        obj.p_model1  = self.p_model1.clone()</span>
<span class="s">        obj.p_model2  = self.p_model2.clone()</span>
<span class="s">        #obj = copy.deepcopy(self)</span>
<span class="s">        return obj</span>

<span class="s">    def _get_name(self, name1, name2):</span>
<span class="s">        p1_name = self._get_upper_name(name1)</span>
<span class="s">        if not p1_name:</span>
<span class="s">            p1_name = name1</span>
<span class="s">        name = p1_name</span>
<span class="s">        name += &quot;_and_&quot;</span>
<span class="s">        p2_name = self._get_upper_name(name2)</span>
<span class="s">        if not p2_name:</span>
<span class="s">            p2_name = name2</span>
<span class="s">        name += p2_name</span>
<span class="s">        return name</span>

<span class="s">    def _get_upper_name(self, name=None):</span>
<span class="s">        if name == None:</span>
<span class="s">            return &quot;&quot;</span>
<span class="s">        upper_name = &quot;&quot;</span>
<span class="s">        str_name = str(name)</span>
<span class="s">        for index in range(len(str_name)):</span>
<span class="s">            if str_name[index].isupper():</span>
<span class="s">                upper_name += str_name[index]</span>
<span class="s">        return upper_name</span>

<span class="s">    def _set_dispersion(self):</span>
<span class="s">        ##set dispersion only from p_model</span>
<span class="s">        for name , value in self.p_model1.dispersion.iteritems():</span>
<span class="s">            #if name.lower() not in self.p_model1.orientation_params:</span>
<span class="s">            new_name = &quot;p1_&quot; + name</span>
<span class="s">            self.dispersion[new_name]= value</span>
<span class="s">        for name , value in self.p_model2.dispersion.iteritems():</span>
<span class="s">            #if name.lower() not in self.p_model2.orientation_params:</span>
<span class="s">            new_name = &quot;p2_&quot; + name</span>
<span class="s">            self.dispersion[new_name]= value</span>

<span class="s">    def function(self, x=0.0):</span>
<span class="s">        return 0</span>

<span class="s">    def getProfile(self):</span>
<span class="s">        try:</span>
<span class="s">            x,y = self.p_model1.getProfile()</span>
<span class="s">        except:</span>
<span class="s">            x = None</span>
<span class="s">            y = None</span>

<span class="s">        return x, y</span>

<span class="s">    def _set_params(self):</span>
<span class="s">        for name , value in self.p_model1.params.iteritems():</span>
<span class="s">            # No 2D-supported</span>
<span class="s">            #if name not in self.p_model1.orientation_params:</span>
<span class="s">            new_name = &quot;p1_&quot; + name</span>
<span class="s">            self.params[new_name]= value</span>

<span class="s">        for name , value in self.p_model2.params.iteritems():</span>
<span class="s">            # No 2D-supported</span>
<span class="s">            #if name not in self.p_model2.orientation_params:</span>
<span class="s">            new_name = &quot;p2_&quot; + name</span>
<span class="s">            self.params[new_name]= value</span>

<span class="s">        # Set &quot;scale&quot; as initializing</span>
<span class="s">        self._set_scale_factor()</span>


<span class="s">    def _set_details(self):</span>
<span class="s">        for name ,detail in self.p_model1.details.iteritems():</span>
<span class="s">            new_name = &quot;p1_&quot; + name</span>
<span class="s">            #if new_name not in self.orientation_params:</span>
<span class="s">            self.details[new_name]= detail</span>

<span class="s">        for name ,detail in self.p_model2.details.iteritems():</span>
<span class="s">            new_name = &quot;p2_&quot; + name</span>
<span class="s">            #if new_name not in self.orientation_params:</span>
<span class="s">            self.details[new_name]= detail</span>

<span class="s">    def _set_scale_factor(self):</span>
<span class="s">        pass</span>


<span class="s">    def setParam(self, name, value):</span>
<span class="s">        # set param to this (p1, p2) model</span>
<span class="s">        self._setParamHelper(name, value)</span>

<span class="s">        ## setParam to p model</span>
<span class="s">        model_pre = &#39;&#39;</span>
<span class="s">        new_name = &#39;&#39;</span>
<span class="s">        name_split = name.split(&#39;_&#39;, 1)</span>
<span class="s">        if len(name_split) == 2:</span>
<span class="s">            model_pre = name.split(&#39;_&#39;, 1)[0]</span>
<span class="s">            new_name = name.split(&#39;_&#39;, 1)[1]</span>
<span class="s">        if model_pre == &quot;p1&quot;:</span>
<span class="s">            if new_name in self.p_model1.getParamList():</span>
<span class="s">                self.p_model1.setParam(new_name, value)</span>
<span class="s">        elif model_pre == &quot;p2&quot;:</span>
<span class="s">             if new_name in self.p_model2.getParamList():</span>
<span class="s">                self.p_model2.setParam(new_name, value)</span>
<span class="s">        elif name == &#39;scale_factor&#39;:</span>
<span class="s">            self.params[&#39;scale_factor&#39;] = value</span>
<span class="s">        else:</span>
<span class="s">            raise ValueError, &quot;Model does not contain parameter </span><span class="si">%s</span><span class="s">&quot; % name</span>

<span class="s">    def getParam(self, name):</span>
<span class="s">        # Look for dispersion parameters</span>
<span class="s">        toks = name.split(&#39;.&#39;)</span>
<span class="s">        if len(toks)==2:</span>
<span class="s">            for item in self.dispersion.keys():</span>
<span class="s">                # 2D not supported</span>
<span class="s">                if item.lower()==toks[0].lower():</span>
<span class="s">                    for par in self.dispersion[item]:</span>
<span class="s">                        if par.lower() == toks[1].lower():</span>
<span class="s">                            return self.dispersion[item][par]</span>
<span class="s">        else:</span>
<span class="s">            # Look for standard parameter</span>
<span class="s">            for item in self.params.keys():</span>
<span class="s">                if item.lower()==name.lower():</span>
<span class="s">                    return self.params[item]</span>
<span class="s">        return</span>
<span class="s">        #raise ValueError, &quot;Model does not contain parameter </span><span class="si">%s</span><span class="s">&quot; % name</span>

<span class="s">    def _setParamHelper(self, name, value):</span>
<span class="s">        # Look for dispersion parameters</span>
<span class="s">        toks = name.split(&#39;.&#39;)</span>
<span class="s">        if len(toks)== 2:</span>
<span class="s">            for item in self.dispersion.keys():</span>
<span class="s">                if item.lower()== toks[0].lower():</span>
<span class="s">                    for par in self.dispersion[item]:</span>
<span class="s">                        if par.lower() == toks[1].lower():</span>
<span class="s">                            self.dispersion[item][par] = value</span>
<span class="s">                            return</span>
<span class="s">        else:</span>
<span class="s">            # Look for standard parameter</span>
<span class="s">            for item in self.params.keys():</span>
<span class="s">                if item.lower()== name.lower():</span>
<span class="s">                    self.params[item] = value</span>
<span class="s">                    return</span>

<span class="s">        raise ValueError, &quot;Model does not contain parameter </span><span class="si">%s</span><span class="s">&quot; % name</span>


<span class="s">    def _set_fixed_params(self):</span>
<span class="s">        for item in self.p_model1.fixed:</span>
<span class="s">            new_item = &quot;p1&quot; + item</span>
<span class="s">            self.fixed.append(new_item)</span>
<span class="s">        for item in self.p_model2.fixed:</span>
<span class="s">            new_item = &quot;p2&quot; + item</span>
<span class="s">            self.fixed.append(new_item)</span>

<span class="s">        self.fixed.sort()</span>


<span class="s">    def run(self, x = 0.0):</span>
<span class="s">        self._set_scale_factor()</span>
<span class="s">        return self.params[&#39;scale_factor&#39;] </span><span class="si">%s</span><span class="s"> </span><span class="se">\</span>
<span class="s">(self.p_model1.run(x) </span><span class="si">%s</span><span class="s"> self.p_model2.run(x))</span>

<span class="s">    def runXY(self, x = 0.0):</span>
<span class="s">        self._set_scale_factor()</span>
<span class="s">        return self.params[&#39;scale_factor&#39;] </span><span class="si">%s</span><span class="s"> </span><span class="se">\</span>
<span class="s">(self.p_model1.runXY(x) </span><span class="si">%s</span><span class="s"> self.p_model2.runXY(x))</span>

<span class="s">    ## Now (May27,10) directly uses the model eval function</span>
<span class="s">    ## instead of the for-loop in Base Component.</span>
<span class="s">    def evalDistribution(self, x = []):</span>
<span class="s">        self._set_scale_factor()</span>
<span class="s">        return self.params[&#39;scale_factor&#39;] </span><span class="si">%s</span><span class="s"> </span><span class="se">\</span>
<span class="s">(self.p_model1.evalDistribution(x) </span><span class="si">%s</span><span class="s"> </span><span class="se">\</span>
<span class="s">self.p_model2.evalDistribution(x))</span>

<span class="s">    def set_dispersion(self, parameter, dispersion):</span>
<span class="s">        value= None</span>
<span class="s">        new_pre = parameter.split(&quot;_&quot;, 1)[0]</span>
<span class="s">        new_parameter = parameter.split(&quot;_&quot;, 1)[1]</span>
<span class="s">        try:</span>
<span class="s">            if new_pre == &#39;p1&#39; and </span><span class="se">\</span>
<span class="s">new_parameter in self.p_model1.dispersion.keys():</span>
<span class="s">                value= self.p_model1.set_dispersion(new_parameter, dispersion)</span>
<span class="s">            if new_pre == &#39;p2&#39; and </span><span class="se">\</span>
<span class="s">new_parameter in self.p_model2.dispersion.keys():</span>
<span class="s">                value= self.p_model2.set_dispersion(new_parameter, dispersion)</span>
<span class="s">            self._set_dispersion()</span>
<span class="s">            return value</span>
<span class="s">        except:</span>
<span class="s">            raise</span>

<span class="s">    def fill_description(self, p_model1, p_model2):</span>
<span class="s">        description = &quot;&quot;</span>
<span class="s">        description += &quot;This model gives the summation or multiplication of&quot;</span>
<span class="s">        description += &quot;</span><span class="si">%s</span><span class="s"> and </span><span class="si">%s</span><span class="s">. &quot;% ( p_model1.name, p_model2.name )</span>
<span class="s">        self.description += description</span>

<span class="s">    def get_fname(self):</span>
<span class="s">        path = sys._getframe().f_code.co_filename</span>
<span class="s">        basename  = os.path.basename(path)</span>
<span class="s">        name, _ = os.path.splitext(basename)</span>
<span class="s">        return name</span>

<span class="s">if __name__ == &quot;__main__&quot;:</span>
<span class="s">    m1= Model()</span>
<span class="s">    #m1.setParam(&quot;p1_scale&quot;, 25)</span>
<span class="s">    #m1.setParam(&quot;p1_length&quot;, 1000)</span>
<span class="s">    #m1.setParam(&quot;p2_scale&quot;, 100)</span>
<span class="s">    #m1.setParam(&quot;p2_rg&quot;, 100)</span>
<span class="s">    out1 = m1.runXY(0.01)</span>

<span class="s">    m2= Model()</span>
<span class="s">    #m2.p_model1.setParam(&quot;scale&quot;, 25)</span>
<span class="s">    #m2.p_model1.setParam(&quot;length&quot;, 1000)</span>
<span class="s">    #m2.p_model2.setParam(&quot;scale&quot;, 100)</span>
<span class="s">    #m2.p_model2.setParam(&quot;rg&quot;, 100)</span>
<span class="s">    out2 = m2.p_model1.runXY(0.01) </span><span class="si">%s</span><span class="s"> m2.p_model2.runXY(0.01)</span><span class="se">\n</span><span class="s"></span>
<span class="s">    print &quot;My name is </span><span class="si">%s</span><span class="s">.&quot;% m1.name</span>
<span class="s">    print out1, &quot; = &quot;, out2</span>
<span class="s">    if out1 == out2:</span>
<span class="s">        print &quot;===&gt; Simple Test: Passed!&quot;</span>
<span class="s">    else:</span>
<span class="s">        print &quot;===&gt; Simple Test: Failed!&quot;</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
<span class="c">#    app = wx.PySimpleApp()</span>
    <span class="n">main_app</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="p">()</span>
    <span class="n">main_frame</span> <span class="o">=</span> <span class="n">TextDialog</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">model_list</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;SphereModel&quot;</span><span class="p">,</span> <span class="s">&quot;CylinderModel&quot;</span><span class="p">],</span>
                       <span class="n">plugin_dir</span><span class="o">=</span><span class="s">&#39;../fitting/plugin_models&#39;</span><span class="p">)</span>
    <span class="n">main_frame</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
    <span class="n">main_app</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>

<span class="c">#if __name__ == &quot;__main__&quot;:</span>
<span class="c">#    from sas.perspectives.fitting import models</span>
<span class="c">#    dir_path = models.find_plugins_dir()</span>
<span class="c">#    app = wx.App()</span>
<span class="c">#    window = EditorWindow(parent=None, base=None, path=dir_path, title=&quot;Editor&quot;)</span>
<span class="c">#    app.MainLoop()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">SasView 3.1.2 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../calculator.html" >sas.perspectives.calculator</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, The SasView Project.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>