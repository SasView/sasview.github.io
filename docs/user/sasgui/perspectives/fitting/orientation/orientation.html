<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Oriented particles &mdash; SasView 4.2.0 documentation</title>
    
    <link rel="stylesheet" href="../../../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../../',
        VERSION:     '4.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <link rel="top" title="SasView 4.2.0 documentation" href="../../../../../index.html" />
    <link rel="up" title="Fitting Documentation" href="../fitting.html" />
    <link rel="next" title="Optimizer Selection" href="../optimizer.html" />
    <link rel="prev" title="Polarisation/Magnetic Scattering" href="../magnetism/magnetism.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../optimizer.html" title="Optimizer Selection"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../magnetism/magnetism.html" title="Polarisation/Magnetic Scattering"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">SasView 4.2.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../user.html" >SasView User Documentation</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../../../analysis.html" >Fitting &amp; Other Analyses</a> &raquo;</li>
          <li class="nav-item nav-item-3"><a href="../fitting.html" accesskey="U">Fitting Documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="oriented-particles">
<span id="orientation"></span><h1>Oriented particles</h1>
<p>With two dimensional small angle diffraction data sasmodels will calculate
scattering from oriented particles, applicable for example to shear flow
or orientation in a magnetic field.</p>
<p>In general we first need to define the reference orientation
of the particle&#8217;s <span class="math">\(a\)</span>-<span class="math">\(b\)</span>-<span class="math">\(c\)</span> axes with respect to the incoming
neutron or X-ray beam. This is done using three angles: <span class="math">\(\theta\)</span> and <span class="math">\(\phi\)</span>
define the orientation of the <span class="math">\(c\)</span>-axis of the particle, and angle <span class="math">\(\Psi\)</span> is
defined as the orientation of the major axis of the particle cross section
with respect to its starting position along the beam direction (or
equivalently, as rotation about the <span class="math">\(c\)</span> axis). There is an unavoidable
ambiguity when <span class="math">\(c\)</span> is aligned with <span class="math">\(z\)</span> in that <span class="math">\(\phi\)</span> and <span class="math">\(\Psi\)</span> both
serve to rotate the particle about <span class="math">\(c\)</span>, but this symmetry is destroyed
when <span class="math">\(\theta\)</span> is not a multiple of 180.</p>
<p>The figures below are for an elliptical cross section cylinder, but may
be applied analogously to other shapes of particle.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is very important to note that these angles, in particular <span class="math">\(\theta\)</span>
and <span class="math">\(\phi\)</span>, are NOT in general the same as the <span class="math">\(\theta\)</span> and <span class="math">\(\phi\)</span>
appearing in equations for the scattering form factor which gives the
scattered intensity or indeed in the equation for scattering vector <span class="math">\(Q\)</span>.
The <span class="math">\(\theta\)</span> rotation must be applied before the <span class="math">\(\phi\)</span> rotation, else
there is an ambiguity.</p>
</div>
<div class="figure" id="id1">
<img alt="../../../../../_images/elliptical_cylinder_angle_definition1.png" src="../../../../../_images/elliptical_cylinder_angle_definition1.png" />
<p class="caption"><span class="caption-number">Fig. 134 </span><span class="caption-text">Definition of angles for oriented elliptical cylinder, where axis_ratio
b/a is shown &gt;1. Note that rotation <span class="math">\(\theta\)</span>, initially in the <span class="math">\(x\)</span>-<span class="math">\(z\)</span>
plane, is carried out first, then rotation <span class="math">\(\phi\)</span> about the <span class="math">\(z\)</span>-axis,
finally rotation <span class="math">\(\Psi\)</span> is around the axis of the cylinder. The neutron
or X-ray beam is along the <span class="math">\(-z\)</span> axis.</span></p>
</div>
<div class="figure" id="id2">
<img alt="../../../../../_images/elliptical_cylinder_angle_projection1.png" src="../../../../../_images/elliptical_cylinder_angle_projection1.png" />
<p class="caption"><span class="caption-number">Fig. 135 </span><span class="caption-text">Some examples of the orientation angles for an elliptical cylinder,
with <span class="math">\(\Psi\)</span> = 0.</span></p>
</div>
<p>Having established the mean direction of the particle (the view) we can then
apply angular orientation distributions (jitter). This is done by a numerical
integration over a range of angles in a similar way to particle size
dispersity. The orientation dispersity is defined with respect to the
<span class="math">\(a\)</span>-<span class="math">\(b\)</span>-<span class="math">\(c\)</span> axes of the particle, with roll angle <span class="math">\(\Psi\)</span> about the <span class="math">\(c\)</span>-axis,
yaw angle <span class="math">\(\theta\)</span> about the <span class="math">\(b\)</span>-axis and pitch angle <span class="math">\(\phi\)</span> about the
<span class="math">\(a\)</span>-axis.</p>
<p>You can explore the view and jitter angles interactively using
<a class="reference internal" href="../../../../../dev/sasmodels-api/sasmodels.html#sasmodels.jitter.run" title="sasmodels.jitter.run"><code class="xref py py-func docutils literal"><span class="pre">sasmodels.jitter.run()</span></code></a>.  Enter the following into the python
interpreter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sasmodels</span> <span class="k">import</span> <span class="n">jitter</span>
<span class="n">jitter</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>More formally, starting with axes <span class="math">\(a\)</span>-<span class="math">\(b\)</span>-<span class="math">\(c\)</span> of the particle aligned
with axes <span class="math">\(x\)</span>-<span class="math">\(y\)</span>-<span class="math">\(z\)</span> of the laboratory frame, the orientation dispersity
is applied first, using the
<a class="reference external" href="https://en.wikipedia.org/wiki/Euler_angles#Conventions_2">Tait-Bryan</a>
<span class="math">\(x\)</span>-<span class="math">\(y'\)</span>-<span class="math">\(z''\)</span> convention with angles <span class="math">\(\Delta\phi\)</span>-<span class="math">\(\Delta\theta\)</span>-<span class="math">\(\Delta\Psi\)</span>.
The reference orientation then follows, using the
<a class="reference external" href="https://en.wikipedia.org/wiki/Euler_angles#Conventions">Euler angles</a>
<span class="math">\(z\)</span>-<span class="math">\(y'\)</span>-<span class="math">\(z''\)</span> with angles <span class="math">\(\phi\)</span>-<span class="math">\(\theta\)</span>-<span class="math">\(\Psi\)</span>.  This is implemented
using rotation matrices as</p>
<div class="math">
\[R = R_z(\phi)\, R_y(\theta)\, R_z(\Psi)\,
    R_x(\Delta\phi)\, R_y(\Delta\theta)\, R_z(\Delta\Psi)\]</div>
<p>To transform detector <span class="math">\((q_x, q_y)\)</span> values into <span class="math">\((q_a, q_b, q_c)\)</span> for the
shape in its canonical orientation, use</p>
<div class="math">
\[[q_a, q_b, q_c]^T = R^{-1} \, [q_x, q_y, 0]^T\]</div>
<p>The inverse rotation is easily calculated by rotating the opposite directions
in the reverse order, so</p>
<div class="math">
\[R^{-1} = R_z(-\Delta\Psi)\, R_y(-\Delta\theta)\, R_x(-\Delta\phi)\,
         R_z(-\Psi)\, R_y(-\theta)\, R_z(-\phi)\]</div>
<p>The <span class="math">\(\theta\)</span> and <span class="math">\(\phi\)</span> orientation parameters for the cylinder only appear
when fitting 2d data. On introducing &#8220;Orientational Distribution&#8221; in the
angles, &#8220;distribution of theta&#8221; and &#8220;distribution of phi&#8221; parameters will
appear. These are actually rotations about the axes <span class="math">\(\delta_1\)</span> and <span class="math">\(\delta_2\)</span>
of the cylinder, which correspond to the <span class="math">\(b\)</span> and <span class="math">\(a\)</span> axes of the cylinder
cross section. (When <span class="math">\(\theta = \phi = 0\)</span> these are parallel to the <span class="math">\(Y\)</span> and
<span class="math">\(X\)</span> axes of the instrument.) The third orientation distribution, in <span class="math">\(\Psi\)</span>,
is about the <span class="math">\(c\)</span> axis of the particle. Some experimentation may be required
to understand the 2d patterns fully. A number of different shapes of
distribution are available, as described for size dispersity, see
<a class="reference internal" href="../pd/polydispersity.html#polydispersityhelp"><span class="std std-ref">Polydispersity &amp; Orientational Distributions</span></a>.</p>
<p>Given that the angular dispersion distribution is defined in cartesian space,
over a cube defined by</p>
<div class="math">
\[[-\Delta \theta, \Delta \theta] \times
[-\Delta \phi, \Delta \phi] \times
[-\Delta \Psi, \Delta \Psi]\]</div>
<p>but the orientation is defined over a sphere, we are left with a
<a class="reference external" href="https://en.wikipedia.org/wiki/List_of_map_projections">map projection</a>
problem, with different tradeoffs depending on how values in <span class="math">\(\Delta\theta\)</span>
and <span class="math">\(\Delta\phi\)</span> are translated into latitude/longitude on the sphere.</p>
<p>Sasmodels is using the
<a class="reference external" href="https://en.wikipedia.org/wiki/Equirectangular_projection">equirectangular projection</a>.
In this projection, square patches in angular dispersity become wedge-shaped
patches on the sphere. To correct for the changing point density, there is a
scale factor of <span class="math">\(\sin(\Delta\theta)\)</span> that applies to each point in the
integral. This is not enough, though. Consider a shape which is tumbling
freely around the <span class="math">\(b\)</span> axis, with <span class="math">\(\Delta\theta\)</span> uniform in <span class="math">\([-180, 180]\)</span>. At
<span class="math">\(\pm 90\)</span>, all points in <span class="math">\(\Delta\phi\)</span> map to the pole, so the jitter will have
a distinct angular preference. If the spin axis is along the beam (which
will be the case for <span class="math">\(\theta=90\)</span> and <span class="math">\(\Psi=90\)</span>) the scattering pattern
should be circularly symmetric, but it will go to zero at <span class="math">\(q_x = 0\)</span> due to the
<span class="math">\(\sin(\Delta\theta)\)</span> correction. This problem does not appear for a shape
that is tumbling freely around the <span class="math">\(a\)</span> axis, with <span class="math">\(\Delta\phi\)</span> uniform in
<span class="math">\([-180, 180]\)</span>, so swap the <span class="math">\(a\)</span> and <span class="math">\(b\)</span> axes so <span class="math">\(\Delta\theta &lt; \Delta\phi\)</span>
and adjust <span class="math">\(\Psi\)</span> by 90. This works with the current sasmodels shapes due to
symmetry.</p>
<p>Alternative projections were considered.
The <a class="reference external" href="https://en.wikipedia.org/wiki/Sinusoidal_projection">sinusoidal projection</a>
works by scaling <span class="math">\(\Delta\phi\)</span> as <span class="math">\(\Delta\theta\)</span> increases, and dropping those
points outside <span class="math">\([-180, 180]\)</span>. The distortions are a little less for middle
ranges of <span class="math">\(\Delta\theta\)</span>, but they are still severe for large <span class="math">\(\Delta\theta\)</span>
and the model is much harder to explain.
The <a class="reference external" href="https://en.wikipedia.org/wiki/Azimuthal_equidistant_projection">azimuthal equidistance projection</a>
also improves on the equirectangular projection by extending the range of
reasonable values for the <span class="math">\(\Delta\theta\)</span> range, with <span class="math">\(\Delta\phi\)</span> forming a
wedge that cuts to the opposite side of the sphere rather than cutting to the
pole. This projection has the nice property that distance from the center are
preserved, and that <span class="math">\(\Delta\theta\)</span> and <span class="math">\(\Delta\phi\)</span> act the same.
The <a class="reference external" href="https://en.wikipedia.org/wiki/Lambert_azimuthal_equal-area_projection">azimuthal equal area projection</a>
is like the azimuthal equidistance projection, but it preserves area instead
of distance. It also has the same behaviour for <span class="math">\(\Delta\theta\)</span> and <span class="math">\(\Delta\phi\)</span>.
The <a class="reference external" href="https://en.wikipedia.org/wiki/Guyou_hemisphere-in-a-square_projection">Guyou projection</a>
has an excellent balance with reasonable distortion in both <span class="math">\(\Delta\theta\)</span>
and <span class="math">\(\Delta\phi\)</span>, as well as preserving small patches. However, it requires
considerably more computational overhead, and we have not yet derived the
formula for the distortion correction, measuring the degree of stretch at
the point <span class="math">\((\Delta\theta, \Delta\phi)\)</span> on the map.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Note that the form factors for oriented particles are performing
numerical integrations over one or more variables, so care should be
taken, especially with very large particles or more extreme aspect
ratios. In such cases results may not be accurate, particularly at very
high Q, unless the model has been specifically coded to use limiting
forms of the scattering equations.</p>
<p class="last">For best numerical results keep the <span class="math">\(\theta\)</span> distribution narrower than
the <span class="math">\(\phi\)</span> distribution. Thus for asymmetric particles, such as
elliptical_cylinder, you may need to reorder the sizes of the three axes
to acheive the desired result. This is due to the issues of mapping a
rectanglar distribution onto the surface of a sphere.</p>
</div>
<p>Users can experiment with the values of <em>Npts</em> and <em>Nsigs</em>, the number of steps
used in the integration and the range spanned in number of standard deviations.
The standard deviation is entered in units of degrees. For a &#8220;rectangular&#8221;
distribution the full width should be <span class="math">\(\pm \sqrt(3)\)</span> ~ 1.73 standard deviations.
The new &#8220;uniform&#8221; distribution avoids this by letting you directly specify the
half width.</p>
<p>The angular distributions may be truncated outside of the range -180 to +180
degrees, so beware of using saying a broad Gaussian distribution with large
value of <em>Nsigs</em>, as the array of <em>Npts</em> may be truncated to many fewer
points than would give a good integration,as well as becoming rather
meaningless. (At some point in the future the actual dispersion arrays may be
made available to the user for inspection.)</p>
<p>Some more detailed technical notes are provided in the developer section of
this manual <a class="reference internal" href="../../../../../dev/sasmodels-dev/overview.html#orientation-developer"><span class="std std-ref">Orientation and Numerical Integration</span></a> .</p>
<p>This definition of orientation is new to SasView 4.2.  In earlier versions,
the orientation distribution appeared as a distribution of view angles.
This led to strange effects when <span class="math">\(c\)</span> was aligned with <span class="math">\(z\)</span>, where changes
to the <span class="math">\(\phi\)</span> angle served only to rotate the shape about <span class="math">\(c\)</span>, rather than
having a consistent interpretation as the pitch of the shape relative to
the flow field defining the reference orientation.  Prior to SasView 4.1,
the reference orientation was defined using a Tait-Bryan convention, making
it difficult to control.  Now, rotation in <span class="math">\(\theta\)</span> modifies the spacings
in the refraction pattern, and rotation in <span class="math">\(\phi\)</span> rotates it in the detector
plane.</p>
<p><em>Document History</em></p>
<div class="line-block">
<div class="line">2017-11-06 Richard Heenan</div>
<div class="line">2017-12-20 Paul Kienzle</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="../magnetism/magnetism.html"
                        title="previous chapter">Polarisation/Magnetic Scattering</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../optimizer.html"
                        title="next chapter">Optimizer Selection</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../../../_sources/user/sasgui/perspectives/fitting/orientation/orientation.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../optimizer.html" title="Optimizer Selection"
             >next</a> |</li>
        <li class="right" >
          <a href="../magnetism/magnetism.html" title="Polarisation/Magnetic Scattering"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../../index.html">SasView 4.2.0 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../../../user.html" >SasView User Documentation</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../../../analysis.html" >Fitting &amp; Other Analyses</a> &raquo;</li>
          <li class="nav-item nav-item-3"><a href="../fitting.html" >Fitting Documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2018, The SasView Project.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.1.
    </div>
  </body>
</html>